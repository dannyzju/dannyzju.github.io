<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dannyzhang.run","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Blogger&#x2F;Software Engineer&#x2F;Fitness Enthusiast">
<meta property="og:type" content="website">
<meta property="og:title" content="D.Z. Notes (Beta)">
<meta property="og:url" content="http://dannyzhang.run/page/5/index.html">
<meta property="og:site_name" content="D.Z. Notes (Beta)">
<meta property="og:description" content="Blogger&#x2F;Software Engineer&#x2F;Fitness Enthusiast">
<meta property="article:author" content="Danny Zhang">
<meta property="article:tag" content="Danny Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://dannyzhang.run/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false
  };
</script>

  <title>D.Z. Notes (Beta)</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-93834804-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-93834804-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?cf34824826b242e2f2924ceffd8bb1fb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">D.Z. Notes (Beta)</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Be insensitive, and keep a lifelong growth mindset.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section">Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section">Archives</a>

  </li>
        <li class="menu-item menu-item-technical">

    <a href="/technical" rel="section">technical</a>

  </li>
        <li class="menu-item menu-item-essays">

    <a href="/essays" rel="section">essays</a>

  </li>
        <li class="menu-item menu-item-readings">

    <a href="/readings" rel="section">readings</a>

  </li>
        <li class="menu-item menu-item-workout">

    <a href="/workout" rel="section">workout</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags" rel="section">Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about" rel="section">About</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/08/30/RxJavaIntro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/30/RxJavaIntro/" class="post-title-link" itemprop="url">RxJava极简入门</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-08-30 01:02:51 / Modified: 01:11:26" itemprop="dateCreated datePublished" datetime="2016-08-30T01:02:51-07:00">2016-08-30</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/08/30/RxJavaIntro/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/30/RxJavaIntro/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>RxJava是在Android开发者中非常热门的函数库。刚上手会感觉比较难理解，但一旦理解了它，你会感觉开启了一扇全新的大门。网上关于RxJava的文章很多，这里也只是略窥门径，对其有个最最基本的概念。</p>
<h3 id="1-RxJava是什么"><a href="#1-RxJava是什么" class="headerlink" title="1. RxJava是什么?"></a>1. RxJava是什么?</h3><p>先来看看别的开发者怎么说的：</p>
<blockquote>
<p>“RxJava is a library of code used to handle data using a push and pull mechanism. Just like a notification on your phone, some data will be pushed to a receiver of that data. It’s a different way to think about existing coding patterns you know.” </p>
</blockquote>
<p>RxJava官网上的定义:</p>
<blockquote>
<p>A library for composing asynchronous and event-based programs using observable sequences for the Java VM.</p>
</blockquote>
<h3 id="2-RxJava基本模型"><a href="#2-RxJava基本模型" class="headerlink" title="2. RxJava基本模型"></a>2. RxJava基本模型</h3><p>RxJava最核心的两个东西是Observables（被观察者，事件源）和Subscribers（观察者）。Observables发出一系列事件，Subscribers处理这些事件。这里的事件可以是任何你感兴趣的东西，如触摸事件，web接口调用返回的数据等等。<br>这里我们以一个简单的Todo List的app为例来解释RxJava的基本工作原理。<br>首先假设我们有一个todo list：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toDoList = &#123;<span class="string">"Sweep"</span>, <span class="string">"Mop"</span>, <span class="string">"Vacuum"</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>第一步先创建一个Observable: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(todoList)</span><br></pre></td></tr></table></figure>
<p>这里用了just方法创建了一个Observable，表示了Observable 每次会发(emit)出todoList中的一项。</p>
<p>接下来是subscribe Observer, 代码和注释如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Subscription s = Observable.just(todoList)</span><br><span class="line">.subscribe(<span class="keyword">new</span> Observer&lt;Todo&gt;() &#123; <span class="comment">//Type is the data type being emitted</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Todo t)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//onNext is called for each item emitted.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//onCompleted is called when the Observable has no more items to admit</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//onError is called if an error occurs.</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//It is important to note that onCompleted and onError are only ever called once.</span></span><br><span class="line">    <span class="comment">//And after they are called, onNext will not be called again.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>调用subscribe方法会返回一个Subscription的对象, 有了它我们可以在关闭app的时候unsubscribe, 比如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    s.unsubscribe();</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>以上就是RxJava的基本模型。</p>
<p>RxJava中包含了一些非常有用的类，可以使得在特定情况下代码写起来更简单。<br>比如说有时候我们并不需要onCompleted和onError的callback，只想知道Observable是否发出了item。这种情况下我们只需要在subscribe方法中传入一个Action1对象即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(todoList)</span><br><span class="line">.subscribe(<span class="keyword">new</span> Action1&lt;Todo&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Todo todo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Get called for each item emitted.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><ul>
<li><a href="https://github.com/ReactiveX/RxJava/wiki" target="_blank" rel="noopener">RxJava Home</a></li>
<li><a href="http://rxmarbles.com" target="_blank" rel="noopener">RxMarbles</a></li>
<li><a href="http://blog.danlew.net/2014/09/15/grokking-rxjava-part-1/" target="_blank" rel="noopener">Grokking RxJava, Part 1: The Basics</a></li>
<li><a href="http://blog.danlew.net/2014/09/22/grokking-rxjava-part-2/" target="_blank" rel="noopener">Grokking RxJava, Part 2: Operator, Operator</a></li>
<li><a href="http://blog.danlew.net/2014/09/30/grokking-rxjava-part-3/" target="_blank" rel="noopener">Grokking RxJava, Part 3: Reactive with Benefits</a></li>
<li><a href="http://blog.danlew.net/2014/10/08/grokking-rxjava-part-4/" target="_blank" rel="noopener">Grokking RxJava, Part 4: Reactive Android</a></li>
<li><a href="https://www.gitbook.com/book/asce1885/android-rd-senior-advanced/details" target="_blank" rel="noopener">更上一层楼－Android研发工程师高级进阶</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/08/25/androidThreads/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/25/androidThreads/" class="post-title-link" itemprop="url">Android中的Threads的实现</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-08-25 00:33:19 / Modified: 00:38:46" itemprop="dateCreated datePublished" datetime="2016-08-25T00:33:19-07:00">2016-08-25</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/08/25/androidThreads/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/25/androidThreads/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在Android想要创建后台任务时该怎么做呢？最简单粗暴的方法就是通过创建一个background thread来实现，这里我们以后台下载音乐为例。</p>
<p>首先建立一个Playlist的类，添加需要下载的曲目:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Playlist</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] songs = &#123;<span class="string">"He’s the Greatest Dancer"</span>, <span class="string">"Cut the Cake"</span>, <span class="string">"The Groove Line"</span>, <span class="string">"Stayin’ Alive"</span>, <span class="string">"Give Up the Funk"</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="1-通过Runnable实现"><a href="#1-通过Runnable实现" class="headerlink" title="1. 通过Runnable实现"></a>1. 通过Runnable实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mDownloadButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                downloadSong();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(runnable);</span><br><span class="line">        thread.setName(<span class="string">"DownloadThread"</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="2-通过继承Thread实现"><a href="#2-通过继承Thread实现" class="headerlink" title="2. 通过继承Thread实现"></a>2. 通过继承Thread实现</h3><p>首先创建一个DownloadThread如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        downloadSong();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再创建一个新的DownloadThread实例，调用start()方法即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mDownloadButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        DownloadThread thread = <span class="keyword">new</span> DownloadThread();</span><br><span class="line">        thread.setName(<span class="string">"DownloadThread"</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>通过以上两种形式，我们成功实现了在background thread下载歌曲。然而新的潜在问题是，若开始下载后Playlist中的曲目被误改，则很可能错误的曲目会被下载下来。那么如何避免这种情况呢？</p>
<h3 id="3-Handler-Looper和Message"><a href="#3-Handler-Looper和Message" class="headerlink" title="3. Handler, Looper和Message"></a>3. Handler, Looper和Message</h3><p>首先创建一个DownloadHandler类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">DownloadHandler</span> <span class="params">()</span> extends Handler </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        downloadSong(msg.obj.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downloadSong</span><span class="params">(String song)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis() + <span class="number">10</span> * <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">while</span> (System.currentTimeMillis() &lt; endTime) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Log.d(TAG, song + <span class="string">" downloaded!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其次修改DownloadThread中的run 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Looper;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> DownloadHandler mHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Looper.prepare();</span><br><span class="line">        mHandler = <span class="keyword">new</span> DownloadHandler();</span><br><span class="line">        Looper.loop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后在点击Button时把要下载的曲目通过Message的形式送到DownloadThread的handler中即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DownloadThread thread = <span class="keyword">new</span> DownloadThread();</span><br><span class="line">thread.setName(<span class="string">"DownloadThread"</span>);</span><br><span class="line">thread.start();</span><br><span class="line">mDownloadButton = (Button) findViewById(R.id.downloadButton);</span><br><span class="line">mDownloadButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String song : Playlist.songs) &#123;</span><br><span class="line">            Message message = Message.obtain();</span><br><span class="line">            message.obj = song;</span><br><span class="line">            thread.mHandler.sendMessage(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当app被关掉之后，我们创建的DownloadThread也就同时被kill了。但如果我们想要在app被关闭之还能在后台继续下载歌曲怎么办呢？这就要引入Android Service了，且看下回分解。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/08/15/androidTestSummary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/15/androidTestSummary/" class="post-title-link" itemprop="url">Android 测试专题笔记</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-15 00:11:49" itemprop="dateCreated datePublished" datetime="2016-08-15T00:11:49-07:00">2016-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-08-25 00:35:53" itemprop="dateModified" datetime="2016-08-25T00:35:53-07:00">2016-08-25</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/08/15/androidTestSummary/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/15/androidTestSummary/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>敢为常语谈何易，百炼工纯始自然。在软件开发中，完备的测试是防御软件缺陷的第一道也是最好的一道防线。</p>
<h2 id="1-Test-Types"><a href="#1-Test-Types" class="headerlink" title="1. Test Types"></a>1. Test Types</h2><h3 id="1-1-Based-on-Running-Platform"><a href="#1-1-Based-on-Running-Platform" class="headerlink" title="1.1. Based on Running Platform"></a>1.1. Based on Running Platform</h3><h4 id="1-1-1-Local-Unit-Tests"><a href="#1-1-1-Local-Unit-Tests" class="headerlink" title="1.1.1. Local Unit Tests"></a>1.1.1. Local Unit Tests</h4><p>Located at <code>module-name/src/test/java/</code><br>These tests run on the local JVM and do not have access to functional Android framework APIs.</p>
<h4 id="1-1-2-Instrumented-Tests"><a href="#1-1-2-Instrumented-Tests" class="headerlink" title="1.1.2. Instrumented Tests"></a>1.1.2. Instrumented Tests</h4><p>Located at <code>module-name/src/androidTest/java/</code><br>These are all tests that must run on an Android hardware device or an Android emulator.</p>
<ul>
<li><strong>Instrumented Unit Test:</strong> Build complex unit tests with Android dependencies that cannot be satisfied with mock objects.</li>
<li><strong>User Interface Tests:</strong> Create tests to verify that the user interface behaves correctly for user interactions within a single app or for interactions across multiple apps.</li>
<li><strong>App Component Integrations Test:</strong> Verify the behavior of components that users do not directly interact with, such as a Service or a Content Provider.</li>
</ul>
<h3 id="1-2-Based-on-Real-Testing-Types"><a href="#1-2-Based-on-Real-Testing-Types" class="headerlink" title="1.2. Based on Real Testing Types"></a>1.2. Based on Real Testing Types</h3><h4 id="1-2-1-Unit-Tests"><a href="#1-2-1-Unit-Tests" class="headerlink" title="1.2.1. Unit Tests"></a>1.2.1. Unit Tests</h4><ul>
<li><strong>Local Unit Tests:</strong>  Unit tests that run locally on the Java Virtual Machine (JVM). Use these tests to minimize execution time when your tests have no Android framework dependencies or when you can mock the Android framework dependencies.</li>
<li><strong>Instrumented Unit Tests:</strong> Unit tests that run on an Android device or emulator. These tests have access to Instrumentation information, such as the Context of the app you are testing. Use these tests when your tests have Android dependencies that mock objects cannot satisfy.</li>
</ul>
<h4 id="1-2-2-Integration-Tests"><a href="#1-2-2-Integration-Tests" class="headerlink" title="1.2.2. Integration Tests"></a>1.2.2. Integration Tests</h4><ul>
<li><strong>Components within your app only:</strong> This type of test verifies that the target app behaves as expected when a user performs a specific action or enters a specific input in its activities. Supported by <a href="https://developer.android.com/tools/testing-support-library/index.html#Espresso" target="_blank" rel="noopener">Espresso</a>.</li>
<li><strong>Cross-app Components:</strong> This type of test verifies the correct behavior of interactions between different user apps or between user apps and system apps. Supported by <a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#UIAutomator" target="_blank" rel="noopener">UI Automator</a>.</li>
</ul>
<h2 id="2-Set-Up-Testing-Environment"><a href="#2-Set-Up-Testing-Environment" class="headerlink" title="2. Set Up Testing Environment"></a>2. Set Up Testing Environment</h2><h3 id="2-1-Local-Unit-Tests"><a href="#2-1-Local-Unit-Tests" class="headerlink" title="2.1. Local Unit Tests"></a>2.1. Local Unit Tests</h3><p>In your app’s top-level <code>build.gradle</code> file, you need to specify theres libraries as dependencies:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    &#x2F;&#x2F; Required -- JUnit 4 framework</span><br><span class="line">    testCompile &#39;junit:junit:4.12&#39;</span><br><span class="line">    &#x2F;&#x2F; Optional -- Mockito framework</span><br><span class="line">    testCompile &#39;org.mockito:mockito-core:1.10.19&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Instrumented-Tests"><a href="#2-2-Instrumented-Tests" class="headerlink" title="2.2. Instrumented Tests"></a>2.2. Instrumented Tests</h3><p>In your app’s top-level build.gradle file, you need to specify these libraries as dependencies:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    androidTestCompile &#39;com.android.support:support-annotations:24.0.0&#39;</span><br><span class="line">    androidTestCompile &#39;com.android.support.test:runner:0.5&#39;</span><br><span class="line">    androidTestCompile &#39;com.android.support.test:rules:0.5&#39;</span><br><span class="line">    &#x2F;&#x2F; Optional -- Hamcrest library</span><br><span class="line">    androidTestCompile &#39;org.hamcrest:hamcrest-library:1.3&#39;</span><br><span class="line">    &#x2F;&#x2F; Optional -- UI testing with Espresso</span><br><span class="line">    androidTestCompile &#39;com.android.support.test.espresso:espresso-core:2.2.2&#39;</span><br><span class="line">    &#x2F;&#x2F; Optional -- UI testing with UI Automator</span><br><span class="line">    androidTestCompile &#39;com.android.support.test.uiautomator:uiautomator-v18:2.1.2&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To use JUnit 4 test classes, make sure to specify AndroidJUnitRunner as the default test instrumentation runner in your project by including the following setting in your app’s module-level build.gradle file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Create-Test-Casese"><a href="#3-Create-Test-Casese" class="headerlink" title="3. Create Test Casese"></a>3. Create Test Casese</h2><h3 id="3-1-Local-Unit-Test-Class"><a href="#3-1-Local-Unit-Test-Class" class="headerlink" title="3.1. Local Unit Test Class"></a>3.1. Local Unit Test Class</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import java.util.regex.Pattern;</span><br><span class="line">import static org.junit.Assert.assertFalse;</span><br><span class="line">import static org.junit.Assert.assertTrue;</span><br><span class="line"></span><br><span class="line">public class EmailValidatorTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void emailValidator_CorrectEmailSimple_ReturnsTrue() &#123;</span><br><span class="line">        assertThat(EmailValidator.isValidEmail(&quot;name@email.com&quot;), is(true));</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To test that components in your app return the expected results, use the junit.Assert methods to perform validation checks (or assertions) to compare the state of the component under test against some expected value. To make tests more readable, you can use Hamcrest matchers (such as the is() and equalTo() methods) to match the returned result against the expected result.</p>
<p><strong>Mock Android dependencies</strong><br>You can use a mocking framework to stub out external dependencies in your code, to easily test that your component interacts with a dependency in an expected way. By substituting Android dependencies with mock objects, you can isolate your unit test from the rest of the Android system while verifying that the correct methods in those dependencies are called. </p>
<p>The <a href="https://github.com/mockito/mockito" target="_blank" rel="noopener">Mockito</a> mocking framework for Java (version 1.9.5 and higher) offers compatibility with Android unit testing. With Mockito, you can configure mock objects to return some specific value when invoked.</p>
<p>Steps to add a mock object to your local unit test:</p>
<ol>
<li>Include the Mockito library dependency in your build.gradle file, as described in Section 2.1.</li>
<li>At the beginning of your unit test class definition, add the <code>@RunWith(MockitoJUnitRunner.class)</code> annotation. This annotation tells the Mockito test runner to validate that your usage of the framework is correct and simplifies the initialization of your mock objects.</li>
<li>To create a mock object for an Android dependency, add the <code>@Mock</code> annotation before the field declaration.</li>
<li>To stub the behavior of the dependency, you can specify a condition and return value when the condition is met by using the <code>when()</code> and <code>thenReturn()</code> methods.</li>
</ol>
<p><strong><em>Code Example:</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(MockitoJUnitRunner.class)</span><br><span class="line">public class UnitTestSample &#123;</span><br><span class="line"></span><br><span class="line">    private static final String FAKE_STRING &#x3D; &quot;HELLO WORLD&quot;;</span><br><span class="line"></span><br><span class="line">    @Mock</span><br><span class="line">    Context mMockContext;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void readStringFromContext_LocalizedString() &#123;</span><br><span class="line">        &#x2F;&#x2F; Given a mocked Context injected into the object under test...</span><br><span class="line">        when(mMockContext.getString(R.string.hello_word))</span><br><span class="line">                .thenReturn(FAKE_STRING);</span><br><span class="line">        ClassUnderTest myObjectUnderTest &#x3D; new ClassUnderTest(mMockContext);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; ...when the string is returned from the object under test...</span><br><span class="line">        String result &#x3D; myObjectUnderTest.getHelloWorldString();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; ...then the result should be the expected one.</span><br><span class="line">        assertThat(result, is(FAKE_STRING));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-Instrumented-Unit-Test-Class"><a href="#3-2-Instrumented-Unit-Test-Class" class="headerlink" title="3.2.  Instrumented Unit Test Class"></a>3.2.  Instrumented Unit Test Class</h3><p>To create an instrumented JUnit 4 test class, add the <code>@RunWith(AndroidJUnit4.class)</code> annotation at the beginning of your test class definition. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import android.os.Parcel;</span><br><span class="line">import android.support.test.runner.AndroidJUnit4;</span><br><span class="line">import android.util.Pair;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import java.util.List;</span><br><span class="line">import static org.hamcrest.Matchers.is;</span><br><span class="line">import static org.junit.Assert.assertThat;</span><br><span class="line"></span><br><span class="line">@RunWith(AndroidJUnit4.class)</span><br><span class="line">@SmallTest</span><br><span class="line">public class LogHistoryAndroidUnitTest &#123;</span><br><span class="line"></span><br><span class="line">    public static final String TEST_STRING &#x3D; &quot;This is a string&quot;;</span><br><span class="line">    public static final long TEST_LONG &#x3D; 12345678L;</span><br><span class="line">    private LogHistory mLogHistory;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void createLogHistory() &#123;</span><br><span class="line">        mLogHistory &#x3D; new LogHistory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void logHistory_ParcelableWriteRead() &#123;</span><br><span class="line">        &#x2F;&#x2F; Set up the Parcelable object to send and receive.</span><br><span class="line">        mLogHistory.addEntry(TEST_STRING, TEST_LONG);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Write the data.</span><br><span class="line">        Parcel parcel &#x3D; Parcel.obtain();</span><br><span class="line">        mLogHistory.writeToParcel(parcel, mLogHistory.describeContents());</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; After you&#39;re done with writing, you need to reset the parcel for reading.</span><br><span class="line">        parcel.setDataPosition(0);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Read the data.</span><br><span class="line">        LogHistory createdFromParcel &#x3D; LogHistory.CREATOR.createFromParcel(parcel);</span><br><span class="line">        List&lt;Pair&lt;String, Long&gt;&gt; createdFromParcelData &#x3D; createdFromParcel.getData();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Verify that the received data is correct.</span><br><span class="line">        assertThat(createdFromParcelData.size(), is(1));</span><br><span class="line">        assertThat(createdFromParcelData.get(0).first, is(TEST_STRING));</span><br><span class="line">        assertThat(createdFromParcelData.get(0).second, is(TEST_LONG));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-Create-an-Espresso-Test-Class"><a href="#3-3-Create-an-Espresso-Test-Class" class="headerlink" title="3.3.  Create an Espresso Test Class"></a>3.3.  Create an Espresso Test Class</h3><p>The following code snippet shows how your test class might invoke this basic workflow:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onView(withId(R.id.my_view))            &#x2F;&#x2F; withId(R.id.my_view) is a ViewMatcher</span><br><span class="line">        .perform(click())               &#x2F;&#x2F; click() is a ViewAction</span><br><span class="line">        .check(matches(isDisplayed())); &#x2F;&#x2F; matches(isDisplayed()) is a ViewAssertion</span><br></pre></td></tr></table></figure>
<h4 id="Using-Espresso-with-ActivityTestRule"><a href="#Using-Espresso-with-ActivityTestRule" class="headerlink" title="Using Espresso with ActivityTestRule"></a>Using Espresso with ActivityTestRule</h4><p>By using ActivityTestRule, the testing framework launches the activity under test before each test method annotated with @Test and before any method annotated with @Before. The framework handles shutting down the activity after the test finishes and all methods annotated with @After are run.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">@RunWith(AndroidJUnit4.class)</span><br><span class="line">@LargeTest</span><br><span class="line">public class ChangeTextBehaviorTest &#123;</span><br><span class="line">    public static final String STRING_TO_BE_TYPED &#x3D; &quot;Espresso&quot;;</span><br><span class="line">    @Rule</span><br><span class="line">    public ActivityTestRule&lt;MainActivity&gt; mActivityRule &#x3D; new ActivityTestRule&lt;&gt;(</span><br><span class="line">            MainActivity.class);</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void changeText_sameActivity() &#123;</span><br><span class="line">        &#x2F;&#x2F; Type text and then press the button.</span><br><span class="line">        onView(withId(R.id.editTextUserInput))</span><br><span class="line">                .perform(typeText(STRING_TO_BE_TYPED), closeSoftKeyboard());</span><br><span class="line">        onView(withId(R.id.changeTextBt)).perform(click());</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Check that the text was changed.</span><br><span class="line">        onView(withId(R.id.textToBeChanged)).check(matches(withText(STRING_TO_BE_TYPED)));</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-Create-an-UI-Automator-Test-Class"><a href="#3-4-Create-an-UI-Automator-Test-Class" class="headerlink" title="3.4. Create an UI Automator Test Class"></a>3.4. Create an UI Automator Test Class</h3><p>… …</p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><ul>
<li><a href="https://developer.android.com/training/testing/start/index.html" target="_blank" rel="noopener">Getting Started with Testing | Android Developers</a></li>
<li><a href="https://developer.android.com/training/testing/unit-testing/index.html" target="_blank" rel="noopener">Building Effective Unit Tests | Android Developers</a></li>
<li><a href="https://developer.android.com/training/testing/ui-testing/index.html" target="_blank" rel="noopener">Automating User Interface Tests | Android Developers</a></li>
<li><a href="https://www.youtube.com/playlist?list=PLWz5rJ2EKKc-6HWg_jyP0U1zrVLHn65b2" target="_blank" rel="noopener">Android Testing Patterns  - YouTube</a></li>
<li><a href="https://google.github.io/android-testing-support-library/docs/index.html" target="_blank" rel="noopener">Espresso Documentation</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/08/14/%E7%8F%8D%E6%83%9C%E5%BD%93%E4%B8%8B%EF%BC%8C%E8%8E%AB%E8%B4%9F%E9%9F%B6%E5%8D%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/14/%E7%8F%8D%E6%83%9C%E5%BD%93%E4%B8%8B%EF%BC%8C%E8%8E%AB%E8%B4%9F%E9%9F%B6%E5%8D%8E/" class="post-title-link" itemprop="url">珍惜当下，莫负韶华</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-08-14 00:53:24 / Modified: 00:56:36" itemprop="dateCreated datePublished" datetime="2016-08-14T00:53:24-07:00">2016-08-14</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/08/14/%E7%8F%8D%E6%83%9C%E5%BD%93%E4%B8%8B%EF%BC%8C%E8%8E%AB%E8%B4%9F%E9%9F%B6%E5%8D%8E/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/14/珍惜当下，莫负韶华/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>“魏延政，毕业于北大计算机系，前华为高管，2010年结婚，11年诊断出绝症，同时老婆怀孕，在与病魔对抗五年后，于2016年8月8日逝世，享年41岁。”</p>
<p>年轻时，总是觉得有大把的时间，可以肆意的挥霍，人生长路漫漫，终点那么遥不可及。</p>
<p>但你永远不知道在未来的某一个时间节点，一个不经意的命运转折就能瞬间摧毁你。</p>
<p>你以为的未来是岁月静好安享百年，可事实也许就是英年早逝红颜薄命。在游戏里大侠还可以重新来过，可在真实的世界里，你就直接Game Over 万劫不复。</p>
<p>生命太脆弱，可这也更显其弥足珍贵。</p>
<p>珍惜当下，莫负韶华。</p>
<p><img src="/content/images/2016/lifeIsABitch.jpg" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/07/30/Techmon-Go-Union-Find/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/30/Techmon-Go-Union-Find/" class="post-title-link" itemprop="url">Data Structure & Algorithms Notes: Union Find</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-07-30 13:37:32 / Modified: 14:23:56" itemprop="dateCreated datePublished" datetime="2016-07-30T13:37:32-07:00">2016-07-30</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/30/Techmon-Go-Union-Find/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/30/Techmon-Go-Union-Find/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-Union-Find-Definition"><a href="#1-Union-Find-Definition" class="headerlink" title="1. Union Find Definition"></a>1. Union Find Definition</h2><p>In computer science, a disjoint-set data structure, also called a union–find data structure or merge–find set, is a data structure that keeps track of a set of elements partitioned into a number of disjoint (nonoverlapping) subsets. It supports two useful operations:</p>
<ul>
<li>Find: Determine which subset a particular element is in. Find typically returns an item from this set that serves as its “representative”; by comparing the result of two Find operations, one can determine whether two elements are in the same subset.</li>
<li>Union: Join two subsets into a single subset.<br><img src="/content/images/2016/unionFindAbstractions.png" alt="Union Find Abstractions"></li>
</ul>
<p><img src="/content/images/2016/unionFindRepresentation.png" alt="Union Find Representation"></p>
<h2 id="2-Union-Find-Implementation"><a href="#2-Union-Find-Implementation" class="headerlink" title="2. Union Find Implementation"></a>2. Union Find Implementation</h2><h3 id="2-1-Quick-find-apporach"><a href="#2-1-Quick-find-apporach" class="headerlink" title="2. 1. Quick-find apporach"></a>2. 1. Quick-find apporach</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickFindUF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id; <span class="comment">// id[i] is component id for object i</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QuickFindUF</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">            id[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id[p] == id[q];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pid = id[p];</span><br><span class="line">        <span class="keyword">int</span> qid = id[q];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; id.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (id[i] == pid) id[i] = qid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Time Complexity:</p>
<ul>
<li>Find: O(1)</li>
<li>Unite: O(N)</li>
</ul>
<p><code>Quick-find algorithm is too slow, it may take ~MN steps to process M union commands on N objects.</code></p>
<h3 id="2-2-Quick-union-approach"><a href="#2-2-Quick-union-approach" class="headerlink" title="2.2. Quick-union approach"></a>2.2. Quick-union approach</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickUnionUF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id; <span class="comment">// id[i] is parent of i</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QuickUnionUF</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">            id[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">root</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (i != id[i]) &#123;</span><br><span class="line">            <span class="comment">//id[i] = id[id[i]];</span></span><br><span class="line">            i = id[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root(p) == root(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = root(p);</span><br><span class="line">        <span class="keyword">int</span> j = root(q);</span><br><span class="line">        id[i] = j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Quick-find defect</p>
<ul>
<li>Union too expensive (N steps)</li>
<li>Trees are flat, but too expensive to keep then flat</li>
</ul>
<p>Quick-union defect</p>
<ul>
<li>Trees can get tall</li>
<li>Find too expensive (could be N steps)</li>
<li>Need to do find to do union</li>
</ul>
<p><code>Quick-union is also too slow</code></p>
<h3 id="2-3-Weighted-quick-union-with-path-compression"><a href="#2-3-Weighted-quick-union-with-path-compression" class="headerlink" title="2.3. Weighted quick-union with path compression"></a>2.3. Weighted quick-union with path compression</h3><p>Improvement 1: Weighting</p>
<ul>
<li>Modify quick-union to avoid tall trees.</li>
<li>Keep track of size of each component.</li>
<li>Balance by linking small tree below larget one.</li>
</ul>
<p>Analysis:</p>
<ul>
<li>Find: takes time proportional to depth of p and q.</li>
<li>Union: takes constant time, given roots.</li>
<li>Fact: depth is at most lg N. [needs proof, remember it here.]</li>
</ul>
<p>Improvement 2: Path compression</p>
<ul>
<li>Just after computing the root of i, set the id of each examined node to root(i).</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id;</span><br><span class="line">    <span class="keyword">int</span> size[];</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UF</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">            id[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">root</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (i != id[i]) &#123;</span><br><span class="line">            id[i] = id[id[i]];</span><br><span class="line">            i = id[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i; h</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root(p) == root(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = root(p);</span><br><span class="line">        <span class="keyword">int</span> j = root(q);</span><br><span class="line">        <span class="keyword">if</span> (size[i] &lt; size[j]) &#123;</span><br><span class="line">            id[i] = j;</span><br><span class="line">            size[j] += size[i];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            id[j] = i;</span><br><span class="line">            size[i] += size[j];</span><br><span class="line">        &#125;</span><br><span class="line">        id[i] = j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Union-Find-Problems"><a href="#3-Union-Find-Problems" class="headerlink" title="3. Union Find Problems"></a>3. Union Find Problems</h2><h3 id="3-1-Number-of-Islands"><a href="#3-1-Number-of-Islands" class="headerlink" title="3.1. Number of Islands"></a>3.1. Number of Islands</h3><p>Given a 2d grid map of ‘1’s (land) and ‘0’s (water), count the number of islands. An island is surrounded by water and is formed by connecting adjacent lands horizontally or vertically. You may assume all four edges of the grid are all surrounded by water.</p>
<p><strong><em>Example 1:</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">11110</span><br><span class="line">11010</span><br><span class="line">11000</span><br><span class="line">00000</span><br></pre></td></tr></table></figure>
<p>Answer: 1</p>
<p><strong><em>Example 2:</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">11000</span><br><span class="line">11000</span><br><span class="line">00100</span><br><span class="line">00011</span><br></pre></td></tr></table></figure>
<p>Answer: 3</p>
<p><strong>Solution 1: Depth First Search</strong><br>This problem can be solved with both depth-frist search and breath-first search, the following code is an example of depth-first search.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numIslands</span><span class="params">(<span class="keyword">char</span>[][] grid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (grid == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> height = grid.length;</span><br><span class="line">        <span class="keyword">if</span> (height == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> len = grid[<span class="number">0</span>].length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (len == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; height; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (grid[i][j] == <span class="string">'1'</span>) &#123;</span><br><span class="line">                    sum++;</span><br><span class="line">                    helper(grid, i, j, height, len);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">helper</span><span class="params">(<span class="keyword">char</span>[][] grid, <span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> height, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        grid[i][j] = <span class="string">'x'</span>;</span><br><span class="line">        <span class="keyword">if</span> (i - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; grid[i - <span class="number">1</span>][j] == <span class="string">'1'</span>) &#123;</span><br><span class="line">            helper(grid, i - <span class="number">1</span>, j, height, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">1</span> &lt; height &amp;&amp; grid[i + <span class="number">1</span>][j] == <span class="string">'1'</span>) &#123;</span><br><span class="line">            helper(grid, i + <span class="number">1</span>, j, height, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (j - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; grid[i][j - <span class="number">1</span>] == <span class="string">'1'</span>) &#123;</span><br><span class="line">            helper(grid, i, j - <span class="number">1</span>, height, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (j + <span class="number">1</span> &lt; len &amp;&amp; grid[i][j + <span class="number">1</span>] == <span class="string">'1'</span>) &#123;</span><br><span class="line">            helper(grid, i, j + <span class="number">1</span>, height, len);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Solution 2: Union Find</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numIslands</span><span class="params">(<span class="keyword">char</span>[][] grid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (grid == <span class="keyword">null</span> || grid.length == <span class="number">0</span> || grid[<span class="number">0</span>].length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> m = grid.length, n = grid[<span class="number">0</span>].length;</span><br><span class="line">        UF uf = <span class="keyword">new</span> UF(m, n, grid);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (grid[i][j] == <span class="string">'0'</span>) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">int</span> p = i * n + j;</span><br><span class="line">                <span class="keyword">int</span> q;</span><br><span class="line">                <span class="comment">// check up</span></span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; grid[i - <span class="number">1</span>][j] == <span class="string">'1'</span>) &#123;</span><br><span class="line">                    q = p - n;</span><br><span class="line">                    uf.union(p, q);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// check down</span></span><br><span class="line">                <span class="keyword">if</span> (i &lt; m - <span class="number">1</span> &amp;&amp; grid[i + <span class="number">1</span>][j] == <span class="string">'1'</span>) &#123;</span><br><span class="line">                    q = p + n;</span><br><span class="line">                    uf.union(p, q);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// check left</span></span><br><span class="line">                <span class="keyword">if</span> (j &gt; <span class="number">0</span> &amp;&amp; grid[i][j - <span class="number">1</span>] == <span class="string">'1'</span>) &#123;</span><br><span class="line">                    q = p - <span class="number">1</span>;</span><br><span class="line">                    uf.union(p, q);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// check right</span></span><br><span class="line">                <span class="keyword">if</span> (j &lt; n - <span class="number">1</span> &amp;&amp; grid[i][j + <span class="number">1</span>] == <span class="string">'1'</span>) &#123;</span><br><span class="line">                    q = p + <span class="number">1</span>;</span><br><span class="line">                    uf.union(p, q);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uf.count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">UF</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] id;</span><br><span class="line">        <span class="keyword">int</span>[] sz;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">UF</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n, <span class="keyword">char</span>[][] grid)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                    <span class="comment">// When creating the UF object, count the number of '1's.</span></span><br><span class="line">                    <span class="keyword">if</span> (grid[i][j] == <span class="string">'1'</span>) count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            id = <span class="keyword">new</span> <span class="keyword">int</span>[m * n];</span><br><span class="line">            sz = <span class="keyword">new</span> <span class="keyword">int</span>[m * n];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m * n; i++) &#123;</span><br><span class="line">                id[i] = i;</span><br><span class="line">                sz[i] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">root</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (id[k] != k) &#123;</span><br><span class="line">                id[k] = id[id[k]];</span><br><span class="line">                k = id[k];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> root(p) == root(q);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> x = root(p);</span><br><span class="line">            <span class="keyword">int</span> y = root(q);</span><br><span class="line">            <span class="keyword">if</span> (x == y) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span> (sz[x] &lt; sz[y]) &#123;</span><br><span class="line">                id[x] = y;</span><br><span class="line">                sz[y] += sz[x];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                id[y] = x;</span><br><span class="line">                sz[x] += sz[y];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Whenever do a union, reduce count by 1.</span></span><br><span class="line">            count--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h3 id="3-2-Number-of-Islands-II"><a href="#3-2-Number-of-Islands-II" class="headerlink" title="3.2. Number of Islands II"></a>3.2. Number of Islands II</h3><p>A 2d grid map of m rows and n columns is initially filled with water. We may perform an addLand operation which turns the water at position (row, col) into a land. Given a list of positions to operate, count the number of islands after each addLand operation. An island is surrounded by water and is formed by connecting adjacent lands horizontally or vertically. You may assume all four edges of the grid are all surrounded by water.</p>
<p><strong><em>Example:</em></strong><br>Given m = 3, n = 3, positions = [[0,0], [0,1], [1,2], [2,1]].<br>Initially, the 2d grid grid is filled with water. (Assume 0 represents water and 1 represents land).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0 0 0</span><br><span class="line">0 0 0</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure>
<p>Operation #1: addLand(0, 0) turns the water at grid[0][0] into a land.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 0 0</span><br><span class="line">0 0 0   Number of islands &#x3D; 1</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure>
<p>Operation #2: addLand(0, 1) turns the water at grid[0][1] into a land.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 1 0</span><br><span class="line">0 0 0   Number of islands &#x3D; 1</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure>
<p>Operation #3: addLand(1, 2) turns the water at grid[1][2] into a land.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 1 0</span><br><span class="line">0 0 1   Number of islands &#x3D; 2</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure>
<p>Operation #4: addLand(2, 1) turns the water at grid[2][1] into a land.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 1 0</span><br><span class="line">0 0 1   Number of islands &#x3D; 3</span><br><span class="line">0 1 0</span><br></pre></td></tr></table></figure>
<p>We return the result as an array: [1, 1, 2, 3]</p>
<p><strong>Challenge</strong><br>Can you do it in time complexity O(k log mn), where k is the length of the positions?</p>
<p><strong>Solution</strong><br>The most straightforward solution is to put all positions into the map, and use the same approach as the <strong>3.1. Number of Islands</strong>. However, since it requires solving the problem in O(k logmn) time complexity, the union find approach becomes the only option.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">numIslands2</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n, <span class="keyword">int</span>[][] positions)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">if</span> (m &lt;= <span class="number">0</span> || n &lt;= <span class="number">0</span> || positions == <span class="keyword">null</span> || positions.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span>[][] grid = <span class="keyword">new</span> <span class="keyword">int</span>[m][n];</span><br><span class="line">        UF uf = <span class="keyword">new</span> UF(m, n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; positions.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span>[] position = positions[i];</span><br><span class="line">            <span class="keyword">int</span> x = position[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">int</span> y = position[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (grid[x][y] == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            grid[x][y] = <span class="number">1</span>;</span><br><span class="line">            uf.count++;</span><br><span class="line">            <span class="keyword">if</span> (x &gt; <span class="number">0</span> &amp;&amp; grid[x - <span class="number">1</span>][y] == <span class="number">1</span>) &#123;</span><br><span class="line">                uf.union((x - <span class="number">1</span>) * n + y, x * n + y);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (x &lt; m - <span class="number">1</span> &amp;&amp; grid[x + <span class="number">1</span>][y] == <span class="number">1</span>) &#123;</span><br><span class="line">                uf.union((x + <span class="number">1</span>) * n + y, x * n + y);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (y &gt; <span class="number">0</span> &amp;&amp; grid[x][y - <span class="number">1</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">                uf.union(x * n + y - <span class="number">1</span>, x * n + y);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (y &lt; n - <span class="number">1</span> &amp;&amp; grid[x][y + <span class="number">1</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">                uf.union(x * n + y + <span class="number">1</span>, x * n + y);</span><br><span class="line">            &#125;</span><br><span class="line">            res.add(uf.count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UF</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] ids;</span><br><span class="line">        <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">UF</span> <span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">            ids = <span class="keyword">new</span> <span class="keyword">int</span>[m * n];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m * n; i++) &#123;</span><br><span class="line">                ids[i] = i;</span><br><span class="line">            &#125;</span><br><span class="line">            count = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">root</span> <span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (p != ids[p]) &#123;</span><br><span class="line">                ids[p] = ids[ids[p]];</span><br><span class="line">                p = ids[p];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> pParent = root(p);</span><br><span class="line">            <span class="keyword">int</span> qParent = root(q);</span><br><span class="line">            <span class="keyword">if</span> (pParent == qParent) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ids[qParent] = pParent;</span><br><span class="line">            count--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-Surrounded-Regions"><a href="#3-3-Surrounded-Regions" class="headerlink" title="3.3. Surrounded Regions"></a>3.3. Surrounded Regions</h3><p>Given a 2D board containing ‘X’ and ‘O’ (the letter O), capture all regions surrounded by ‘X’.<br>A region is captured by flipping all ‘O’s into ‘X’s in that surrounded region.<br>For example,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">X X X X</span><br><span class="line">X O O X</span><br><span class="line">X X O X</span><br><span class="line">X O X X</span><br></pre></td></tr></table></figure>
<p>After running your function, the board should be:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">X X X X</span><br><span class="line">X X X X</span><br><span class="line">X X X X</span><br><span class="line">X O X X</span><br></pre></td></tr></table></figure>

<p><strong>Solution1: Breath First Search</strong><br>Use BFS to find all ‘O’ positions that are not surrounded by ‘X’, and change them to ‘.’ from ‘O’, then replace all remaing ‘O’ to ‘X’, and ‘.’ to ‘O’</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">char</span>[][] board)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (board == <span class="keyword">null</span> || board.length &lt;= <span class="number">2</span> || board[<span class="number">0</span>].length &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Step1: change all invalid 'O's to '.';</span></span><br><span class="line">        <span class="keyword">int</span> rows = board.length;</span><br><span class="line">        <span class="keyword">int</span> cols = board[<span class="number">0</span>].length;</span><br><span class="line">        Queue&lt;Integer&gt; queue = <span class="keyword">new</span> LinkedList&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (board[i][<span class="number">0</span>] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[i][<span class="number">0</span>] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer(i * cols);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (board[i][cols - <span class="number">1</span>] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[i][cols - <span class="number">1</span>] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer(i * cols + cols - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; cols - <span class="number">1</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (board[<span class="number">0</span>][j] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[<span class="number">0</span>][j] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer(j);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (board[rows - <span class="number">1</span>][j] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[rows - <span class="number">1</span>][j] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer((rows - <span class="number">1</span>) * cols + j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> num = queue.poll();</span><br><span class="line">            <span class="keyword">int</span> row = num / cols;</span><br><span class="line">            <span class="keyword">int</span> col = num % cols;</span><br><span class="line">            <span class="keyword">if</span> (row &lt; rows - <span class="number">1</span> &amp;&amp; board[row + <span class="number">1</span>][col] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[row + <span class="number">1</span>][col] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer((row + <span class="number">1</span>) * cols + col);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (row &gt; <span class="number">0</span> &amp;&amp; board[row - <span class="number">1</span>][col] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[row - <span class="number">1</span>][col] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer((row - <span class="number">1</span>) * cols + col);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (col &lt; cols - <span class="number">1</span> &amp;&amp; board[row][col + <span class="number">1</span>] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[row][col + <span class="number">1</span>] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer(row * cols + col + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (col &gt; <span class="number">0</span> &amp;&amp; board[row][col - <span class="number">1</span>] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[row][col - <span class="number">1</span>] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer(row * cols + col - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step2: Change all 'O' to 'X', and '.' to 'O';</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; cols; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">'.'</span>) &#123;</span><br><span class="line">                    board[i][j] = <span class="string">'O'</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (board[i][j] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                    board[i][j] = <span class="string">'X'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Solution2: Union Find</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] id;</span><br><span class="line">    <span class="keyword">boolean</span>[] hasEdge;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">char</span>[][] board)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (board == <span class="keyword">null</span> || board.length &lt;= <span class="number">2</span> || board[<span class="number">0</span>].length &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> m = board.length, n = board[<span class="number">0</span>].length;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[m * n];</span><br><span class="line">        hasEdge = <span class="keyword">new</span> <span class="keyword">boolean</span>[m * n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m * n; i++) &#123;</span><br><span class="line">            id[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// check the O in boundary</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m * n; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = i / n, y = i % n;</span><br><span class="line">            hasEdge[i] = (board[x][y] == <span class="string">'O'</span> &amp;&amp; (x == <span class="number">0</span> || x == m - <span class="number">1</span> || y == <span class="number">0</span> || y == n - <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//union all the Os</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m * n; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = i / n, y = i % n, up = x - <span class="number">1</span>, left = y - <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// union itself with up if possible</span></span><br><span class="line">            <span class="keyword">if</span> (up &gt;= <span class="number">0</span> &amp;&amp; board[x][y] == <span class="string">'O'</span> &amp;&amp; board[up][y] == <span class="string">'O'</span>) union( i - n, i);</span><br><span class="line">            <span class="comment">// union itself with left if possible</span></span><br><span class="line">            <span class="keyword">if</span> (left &gt;= <span class="number">0</span> &amp;&amp; board[x][y] == <span class="string">'O'</span> &amp;&amp; board[x][left] == <span class="string">'O'</span>) union(i - <span class="number">1</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; id.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = i / n, y = i % n;</span><br><span class="line">            <span class="keyword">int</span> root_i = root(i);</span><br><span class="line">            <span class="keyword">if</span> (!hasEdge[root_i] &amp;&amp; board[x][y] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[x][y] = <span class="string">'X'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = root(i);</span><br><span class="line">        <span class="keyword">int</span> y = root(j);</span><br><span class="line">        id[y] = x;</span><br><span class="line">        hasEdge[x] = hasEdge[x] || hasEdge[y];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">root</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (id[i] != i) &#123;</span><br><span class="line">            id[i] = id[id[i]];</span><br><span class="line">            i = id[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-Graph-Valid-Tree"><a href="#3-4-Graph-Valid-Tree" class="headerlink" title="3.4. Graph Valid Tree"></a>3.4. Graph Valid Tree</h3><p>Given n nodes labeled from 0 to n - 1 and a list of undirected edges (each edge is a pair of nodes), write a function to check whether these edges make up a valid tree.<br>For example:</p>
<p>Given n = 5 and edges = [[0, 1], [0, 2], [0, 3], [1, 4]], return true.<br>Given n = 5 and edges = [[0, 1], [1, 2], [2, 3], [1, 3], [1, 4]], return false.</p>
<p><strong>Solution: Union Find</strong><br>Union the two nodes if they are connected by edge,  the tree is invalid if a new edge comes to connect two nodes that are already connected.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">validTree</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span>[][] edges)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> n == <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span>[] roots = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; roots.length; i++) &#123;</span><br><span class="line">            roots[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] edge : edges) &#123;</span><br><span class="line">            <span class="keyword">int</span> root0 = findRoot(edge[<span class="number">0</span>], roots);</span><br><span class="line">            <span class="keyword">int</span> root1 = findRoot(edge[<span class="number">1</span>], roots);</span><br><span class="line">            <span class="keyword">if</span> (root0 != root1) &#123;</span><br><span class="line">                roots[root0] = roots[root1];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> edges.length == n-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">findRoot</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span>[] roots)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (roots[index] != index) &#123;</span><br><span class="line">            roots[index] = roots[roots[index]];</span><br><span class="line">            index = roots[index];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Question:</strong> can union find be applied to solving graph issue? Like finding circle in graph.</p>
<h3 id="3-5-Number-of-Connected-Components-in-an-Undirected-Graph"><a href="#3-5-Number-of-Connected-Components-in-an-Undirected-Graph" class="headerlink" title="3.5. Number of Connected Components in an Undirected Graph"></a>3.5. Number of Connected Components in an Undirected Graph</h3><p>Given n nodes labeled from 0 to n - 1 and a list of undirected edges (each edge is a pair of nodes), write a function to find the number of connected components in an undirected graph.<br><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0          3</span><br><span class="line">|          |</span><br><span class="line">1 --- 2    4</span><br></pre></td></tr></table></figure>
<p>Given n = 5 and edges = [[0, 1], [1, 2], [3, 4]], return 2.</p>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0           4</span><br><span class="line">|           |</span><br><span class="line">1 --- 2 --- 3</span><br></pre></td></tr></table></figure>
<p>Given n = 5 and edges = [[0, 1], [1, 2], [2, 3], [3, 4]], return 1.</p>
<p><strong>Solution:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countComponents</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span>[][] edges)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] roots = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; roots.length; i++) &#123;</span><br><span class="line">            roots[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] edge : edges) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = findRoot(edge[<span class="number">0</span>], roots);</span><br><span class="line">            <span class="keyword">int</span> y = findRoot(edge[<span class="number">1</span>], roots);</span><br><span class="line">            <span class="keyword">if</span> (x != y) &#123;</span><br><span class="line">                roots[x] = y;</span><br><span class="line">                n--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">findRoot</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span>[] roots)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (i != roots[i]) &#123;</span><br><span class="line">            roots[i] = roots[roots[i]];</span><br><span class="line">            i = roots[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-References"><a href="#4-References" class="headerlink" title="4. References"></a>4. References</h2><ul>
<li><a href="https://www.cs.princeton.edu/~rs/AlgsDS07/01UnionFind.pdf" target="_blank" rel="noopener">Princeton Algorithms: Union Find</a></li>
<li><a href="https://www.youtube.com/watch?v=ID00PMy0-vE" target="_blank" rel="noopener">Tushar Roy’s Video: Disjoint Sets using union by rank and path compression Graph Algorithm</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/07/17/Techmon-Go-3-Segment-Tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/17/Techmon-Go-3-Segment-Tree/" class="post-title-link" itemprop="url">Data Structure & Algorithms Notes: Segment Tree</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-17 23:21:47" itemprop="dateCreated datePublished" datetime="2016-07-17T23:21:47-07:00">2016-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-07-30 14:23:56" itemprop="dateModified" datetime="2016-07-30T14:23:56-07:00">2016-07-30</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/17/Techmon-Go-3-Segment-Tree/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/17/Techmon-Go-3-Segment-Tree/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-Segment-Tree-Definition"><a href="#1-Segment-Tree-Definition" class="headerlink" title="1. Segment Tree Definition"></a>1. Segment Tree Definition</h2><p>In computer science, a segment tree is a tree data structure for storing intervals, or segments. It allows querying which of the stored segments contain a given point.</p>
<p><img src="/content/images/2016/illustrationOfSegmentTree.png" alt="Illustration of Segment tree"></p>
<p>Segment tree could be implemented using either an array or a tree. For an array implementation, if the element at index i is not a leaf, its left and right child are stored at index 2i and 2i+1 respectively. </p>
<h2 id="2-Segment-Tree-Problems"><a href="#2-Segment-Tree-Problems" class="headerlink" title="2. Segment Tree Problems"></a>2. Segment Tree Problems</h2><h3 id="2-1-Range-Sum-Query-Mutable"><a href="#2-1-Range-Sum-Query-Mutable" class="headerlink" title="2.1. Range Sum Query  - Mutable"></a>2.1. Range Sum Query  - Mutable</h3><p>Given an integer array nums, find the sum of the elements between indices i and j (i ≤ j), inclusive.</p>
<p>The update(i, val) function modifies nums by updating the element at index i to val.</p>
<p><strong>Example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Given nums &#x3D; [1, 3, 5]</span><br><span class="line">sumRange(0, 2) -&gt; 9</span><br><span class="line">update(1, 2)</span><br><span class="line">sumRange(0, 2) -&gt; 8</span><br></pre></td></tr></table></figure>

<p>This is a classic segment tree problem, and we can break it down to the three following steps:</p>
<ol>
<li>Build the segment tree;</li>
<li>Update the segment tree when an element is modified;</li>
<li>Calculate the range sum query using the segment tree.</li>
</ol>
<h4 id="2-1-1-Build-segment-tree"><a href="#2-1-1-Build-segment-tree" class="headerlink" title="2.1.1. Build segment tree"></a>2.1.1. Build segment tree</h4><p>Here, we use array implementation as example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] tree;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NumArray</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (nums.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        n = nums.length;</span><br><span class="line">        tree = <span class="keyword">new</span> <span class="keyword">int</span>[n * <span class="number">2</span>];</span><br><span class="line">        buildTree(nums);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n, j = <span class="number">0</span>;  i &lt; <span class="number">2</span> * n; i++,  j++)</span><br><span class="line">        tree[i] = nums[j]; <span class="comment">//Give values for the leaf nodes.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt; <span class="number">0</span>; --i)</span><br><span class="line">        tree[i] = tree[i * <span class="number">2</span>] + tree[i * <span class="number">2</span> + <span class="number">1</span>]; <span class="comment">//Update the parents' value with a bottom-up approach.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Complexity Analysis:</strong><br>The total amount of nodes is:<br>n + n/2 + n/4 + n/8 + … + 1 ~= 2n</p>
<ul>
<li>Time complexity: O(n)</li>
<li>Space complexity: O(n)</li>
</ul>
<h4 id="2-1-2-Update-segment-tree"><a href="#2-1-2-Update-segment-tree" class="headerlink" title="2.1.2. Update segment tree"></a>2.1.2. Update segment tree</h4><p>When updating the array at i, we need to rebuild the segment tree as well. Here, we use a bottom-up approach. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    pos += n;</span><br><span class="line">    tree[pos] = val;</span><br><span class="line">    <span class="keyword">while</span> (pos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> left = pos;</span><br><span class="line">        <span class="keyword">int</span> right = pos;</span><br><span class="line">        <span class="keyword">if</span> (pos % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">// pos tands for left node.</span></span><br><span class="line">            right = pos + <span class="number">1</span>; </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// pos stands for right node.</span></span><br><span class="line">            left = pos - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// parent is updated after child is updated</span></span><br><span class="line">        tree[pos / <span class="number">2</span>] = tree[left] + tree[right];</span><br><span class="line">        pos /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Complexity Analysis</strong></p>
<ul>
<li>Time Complexity: O(log n);</li>
<li>Space complexity: O(1);</li>
</ul>
<h4 id="2-1-3-Range-Sum-Query"><a href="#2-1-3-Range-Sum-Query" class="headerlink" title="2.1.3. Range Sum Query"></a>2.1.3. Range Sum Query</h4><ul>
<li>Loop till l &lt;= r<ul>
<li>Check if l is right child of its parent P<ul>
<li>l is right child of P. Then P contains sum of range of l and another child which is outside the range and we dont’t need parent P sum. Add l to sum without its parent and set l to the next node on the same level.</li>
<li>l is not right child of P. Then parent P contains sum of range which lies in [l, r]. Add P to sum and set l to point to the parent of P</li>
</ul>
</li>
<li>Check if r is left child of its parent P<ul>
<li>r is left child of P: Then P contains sum of range of r and another child which is out side the range and we don’t need parent P sum. Add r to sum without its parent and set r to the previous node on the same level</li>
<li>r is not left child of P. Then parent P contains sum of range which lies in [l, r]. Add P to sum and set r to point to the parent of P.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Drawing a graph by yourself will help a lot!</strong></p>
<p>Here’s the code.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sumRange</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// get leaf with value 'l'</span></span><br><span class="line">    l += n;</span><br><span class="line">    <span class="comment">// get leaf with value 'r'</span></span><br><span class="line">    r += n;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((l % <span class="number">2</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">           sum += tree[l];</span><br><span class="line">           l++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((r % <span class="number">2</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">           sum += tree[r];</span><br><span class="line">           r--;</span><br><span class="line">        &#125;</span><br><span class="line">        l /= <span class="number">2</span>;</span><br><span class="line">        r /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Complexity Analysis</strong></p>
<ul>
<li>Time complexity: O(log n)</li>
<li>Space complexity: O(1)</li>
</ul>
<h3 id="2-2-Range-Sum-Query-2D"><a href="#2-2-Range-Sum-Query-2D" class="headerlink" title="2.2. Range Sum Query 2D"></a>2.2. Range Sum Query 2D</h3><p><code>TODO</code></p>
<h3 id="2-3-The-Skyline-Problem"><a href="#2-3-The-Skyline-Problem" class="headerlink" title="2.3. The Skyline Problem"></a>2.3. The Skyline Problem</h3><p>Suppose you are given the locations and height of all the buildings as shown on a cityscape photo (Figure A), write a program to output the skyline formed by these buildings collectively (Figure B).<br><img src="/content/images/2016/skylineProblem.png" alt="Illustration of the Skyline Problem "></p>
<p>For instance, the dimensions of all buildings in Figure A are recorded as:<br> <code>[[2 9 10], [3 7 15], [5 12 12], [15 20 10], [19 24 8]]</code></p>
<p>The skyline in Figure B should be represented as:<br><code>[[2 10], [3 15], [7 12], [12 0], [15 10], [20 8], [24, 0]]</code>.</p>
<h4 id="2-3-1-Solution-without-segment-tree"><a href="#2-3-1-Solution-without-segment-tree" class="headerlink" title="2.3.1. Solution without segment tree"></a>2.3.1. Solution without segment tree</h4><p>The idea is very straightforward and can be divided into the following 4 steps:</p>
<ol>
<li>Create a list of all the nodes that sorted by the position in x axis;</li>
<li>Create a height array with the size of all nodes, and map the position in x axis to the array index;</li>
<li>Iterate all the buildings and update the height values in array.</li>
<li>Iterate the array and generate the final result.</li>
</ol>
<p>Here’s the complet code.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="keyword">int</span>[]&gt; getSkyline(<span class="keyword">int</span>[][] buildings) &#123;</span><br><span class="line">        List&lt;<span class="keyword">int</span>[]&gt; res = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">int</span>[]&gt;();</span><br><span class="line">        <span class="keyword">if</span> (buildings == <span class="keyword">null</span> || buildings.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step1: create a list of all nodes;</span></span><br><span class="line">        Set&lt;Integer&gt; nodesSet = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] building : buildings) &#123;</span><br><span class="line">            nodesSet.add(building[<span class="number">0</span>]);</span><br><span class="line">            nodesSet.add(building[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; nodes = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(nodesSet);</span><br><span class="line">        Collections.sort(nodes);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step2: put all nodes into an array, and build hashmap to map the x axis position to the index in array.</span></span><br><span class="line">        <span class="keyword">int</span> nodesLen = nodes.size();</span><br><span class="line">        <span class="keyword">int</span>[] nodesHeight = <span class="keyword">new</span> <span class="keyword">int</span> [nodesLen];</span><br><span class="line">        Map&lt;Integer, Integer&gt; nodesMap = <span class="keyword">new</span> HashMap&lt;Integer, Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodesLen; i++) &#123;</span><br><span class="line">            nodesMap.put(nodes.get(i), i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step3: update the array</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] building : buildings) &#123;</span><br><span class="line">            <span class="keyword">int</span> startIndex = nodesMap.get(building[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">int</span> endIndex = nodesMap.get(building[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">int</span> height = building[<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = startIndex; j &lt; endIndex; j++) &#123;</span><br><span class="line">                nodesHeight[j] = Math.max(nodesHeight[j], height);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Step4: generate the result.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodesLen ; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nodesHeight[i] == nodesHeight[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span>[] r = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">            r[<span class="number">0</span>] = nodes.get(i);</span><br><span class="line">            r[<span class="number">1</span>] = nodesHeight[i];</span><br><span class="line">            res.add(r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-3-2-Solution-with-segment-tree"><a href="#2-3-2-Solution-with-segment-tree" class="headerlink" title="2.3.2 Solution with segment tree"></a>2.3.2 Solution with segment tree</h4><p>Do we have better solution? Yes! Now we are going to use the segment tree approach to solve it.</p>
<p>In this case, since more than one value needs to be saved for each node: height, start and end, so it’s better to use the tree node implementation instead of the array implementation.</p>
<p>Comparing wiht the solution without segment tree, when we update the nodes’ height values, if we reach a tree node with an equal or higher height values, we can just ignore this building and continue to the next one. This makes the solution more efficient.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> start; <span class="comment">//Inclusive</span></span><br><span class="line">        <span class="keyword">int</span> end; <span class="comment">//Exclusive</span></span><br><span class="line">        <span class="keyword">int</span> height;</span><br><span class="line">        TreeNode left;</span><br><span class="line">        TreeNode right;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TreeNode</span> <span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.start = start;</span><br><span class="line">            <span class="keyword">this</span>.end = end;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="keyword">int</span>[]&gt; getSkyline(<span class="keyword">int</span>[][] buildings) &#123;</span><br><span class="line">        List&lt;<span class="keyword">int</span>[]&gt; res = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">int</span>[]&gt;();</span><br><span class="line">        <span class="keyword">if</span> (buildings == <span class="keyword">null</span> || buildings.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step1: create a list of all nodes;</span></span><br><span class="line">        Set&lt;Integer&gt; nodesSet = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] building : buildings) &#123;</span><br><span class="line">            nodesSet.add(building[<span class="number">0</span>]);</span><br><span class="line">            nodesSet.add(building[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; nodes = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(nodesSet);</span><br><span class="line">        Collections.sort(nodes);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step2: put all nodes into an array, and build hashmap to map the(x position, index in array</span></span><br><span class="line">        <span class="keyword">int</span> nodesLen = nodes.size();</span><br><span class="line">        Map&lt;Integer, Integer&gt; nodesMap = <span class="keyword">new</span> HashMap&lt;Integer, Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodesLen; i++) &#123;</span><br><span class="line">            nodesMap.put(nodes.get(i), i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step3: build the segment tree</span></span><br><span class="line">        TreeNode root = buildTree(<span class="number">0</span>, nodesLen - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step4: update the height value</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] building : buildings) &#123;</span><br><span class="line">            <span class="keyword">int</span> startIndex = nodesMap.get(building[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">int</span> endIndex = nodesMap.get(building[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">int</span> height = building[<span class="number">2</span>];</span><br><span class="line">            updateHeight(startIndex, endIndex, height, root);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step5: generate the result.</span></span><br><span class="line">        generateResult(res, root, nodes);</span><br><span class="line">        <span class="keyword">if</span> (nodes.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span>[] last = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">            last[<span class="number">0</span>] = nodes.get(nodes.size() - <span class="number">1</span>);</span><br><span class="line">            last[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            res.add(last);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TreeNode <span class="title">buildTree</span> <span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (start &gt;= end) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        TreeNode node = <span class="keyword">new</span> TreeNode (start, end);</span><br><span class="line">        <span class="keyword">if</span> (start + <span class="number">1</span> &lt; end) &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = start + (end - start) / <span class="number">2</span>;</span><br><span class="line">            node.left = buildTree(start, mid);</span><br><span class="line">            node.right = buildTree(mid, end);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateHeight</span> <span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end, <span class="keyword">int</span> height, TreeNode node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span> || start &gt;= node.end || end &lt;= node.start || height &lt;= node.height) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (node.left == <span class="keyword">null</span> &amp;&amp; node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">            node.height = height;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//We don't need to change the start and end value, just the same.</span></span><br><span class="line">            updateHeight (start, end, height, node.left);</span><br><span class="line">            updateHeight (start, end, height, node.right);</span><br><span class="line">            <span class="keyword">int</span> leftHeight = (node.left == <span class="keyword">null</span>) ? <span class="number">0</span> : node.left.height;</span><br><span class="line">            <span class="keyword">int</span> rightHeight = (node.right == <span class="keyword">null</span>) ? <span class="number">0</span> : node.right.height;</span><br><span class="line">            node.height = Math.min(leftHeight, rightHeight);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">generateResult</span> <span class="params">(List&lt;<span class="keyword">int</span>[]&gt; res, TreeNode root, List&lt;Integer&gt; nodes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//We only need the value from the leaf nodes</span></span><br><span class="line">        <span class="keyword">if</span> (root.left == <span class="keyword">null</span> &amp;&amp; root.right == <span class="keyword">null</span> &amp;&amp; (res.size() == <span class="number">0</span> || res.get(res.size() - <span class="number">1</span>)[<span class="number">1</span>] !=  root.height)) &#123;</span><br><span class="line">            <span class="keyword">int</span>[] r = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">            r[<span class="number">0</span>] = nodes.get(root.start);</span><br><span class="line">            r[<span class="number">1</span>] = root.height;</span><br><span class="line">            res.add(r);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            generateResult(res, root.left, nodes);</span><br><span class="line">            generateResult(res, root.right, nodes);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Count-of-Smaller-Numbers-After-Self"><a href="#2-4-Count-of-Smaller-Numbers-After-Self" class="headerlink" title="2.4. Count of Smaller Numbers After Self"></a>2.4. Count of Smaller Numbers After Self</h3><p><code>TODO</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/07/16/Techmon-Go-2-Topological-Sort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/16/Techmon-Go-2-Topological-Sort/" class="post-title-link" itemprop="url">Data Structure & Algorithms Notes: Topological Sort</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-16 20:39:07" itemprop="dateCreated datePublished" datetime="2016-07-16T20:39:07-07:00">2016-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-07-30 14:23:56" itemprop="dateModified" datetime="2016-07-30T14:23:56-07:00">2016-07-30</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/16/Techmon-Go-2-Topological-Sort/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/16/Techmon-Go-2-Topological-Sort/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="I-Topological-Sort-Definition"><a href="#I-Topological-Sort-Definition" class="headerlink" title="I. Topological Sort Definition"></a>I. Topological Sort Definition</h3><p>First of all, what is topological Sort? Here is the definition from WikiPedia</p>
<blockquote>
<p>In the field of computer science, <strong>a topological sort</strong> or <strong>topological</strong> ordering of a directed graph is a linear ordering of its vertices such that for every directed edge uv from vertex u to vertex v, u comes before v in the ordering.</p>
</blockquote>
<p>Originally, say we have a graph like this.<br><img src="/content/images/2016/graph.png" alt="Original Graph"></p>
<p>After the topological sort, we will get a list like this:<br><img src="/content/images/2016/sortedGraph.png" alt="Sorted Graph"></p>
<h3 id="II-Topological-Sort-Algorithm"><a href="#II-Topological-Sort-Algorithm" class="headerlink" title="II. Topological Sort Algorithm"></a>II. Topological Sort Algorithm</h3><p><img src="/content/images/2016/topologicalSort1.png" alt="Topological Sort Algorithm"><br><img src="/content/images/2016/topologicalSort2.png" alt="Topological Sort Algorithm Explanation"></p>
<h3 id="III-Topological-Sort-Problems"><a href="#III-Topological-Sort-Problems" class="headerlink" title="III. Topological Sort Problems"></a>III. Topological Sort Problems</h3><h4 id="1-Alien-Dictionary"><a href="#1-Alien-Dictionary" class="headerlink" title="1. Alien Dictionary"></a>1. Alien Dictionary</h4><p>There is a new alien language which uses the latin alphabet. However, the order among letters are unknown to you. You receive a list of words from the dictionary, where words are sorted lexicographically by the rules of this new language. Derive the order of letters in this language.</p>
<p>For example,<br>Given the following words in dictionary,<br><code>[&quot;wrt&quot;, &quot;wrf&quot;, &quot;er&quot;, &quot;ett&quot;, &quot;rftt&quot;]</code></p>
<p>The correct order is: <code>&quot;wertf&quot;</code>.</p>
<p>思路：可以通过一定的转换，把这个问题转化为Topological Sort的问题。此外，在基本的拓扑排序算法之外，这里还需要考虑是否会有循环产生的情况，如果发生循环，则数据无效，返回空字符串。具体代码和注释如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> index;</span><br><span class="line">    <span class="keyword">char</span>[] results;</span><br><span class="line">    Map&lt;Character, Integer&gt; visitedMap;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">alienOrder</span><span class="params">(String[] words)</span> </span>&#123;</span><br><span class="line">        Map&lt;Character, GraphNode&gt; map = <span class="keyword">new</span> HashMap&lt;Character, GraphNode&gt;();</span><br><span class="line">        <span class="keyword">int</span> nodeCount = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//Step1: Create all graph nodes;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; words.length; i++) &#123;</span><br><span class="line">            String word = words[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; word.length(); j++) &#123;</span><br><span class="line">                <span class="keyword">char</span> c = word.charAt(j);</span><br><span class="line">                <span class="keyword">if</span> (!map.containsKey(c)) &#123;</span><br><span class="line">                    map.put(c, <span class="keyword">new</span> GraphNode(c));</span><br><span class="line">                    nodeCount++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step2: Create the connections between different nodes.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; words.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            String word1 = words[i];</span><br><span class="line">            String word2 = words[i + <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (j &lt; word1.length() &amp;&amp; j &lt; word2.length()) &#123;</span><br><span class="line">                <span class="keyword">char</span> c1 = word1.charAt(j);</span><br><span class="line">                <span class="keyword">char</span> c2 = word2.charAt(j);</span><br><span class="line">                <span class="keyword">if</span> (c1 != c2) &#123;</span><br><span class="line">                    map.get(c1).neighbors.add(map.get(c2));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step3: Topological Sorting.</span></span><br><span class="line">        visitedMap = <span class="keyword">new</span> HashMap&lt;Character, Integer&gt;();</span><br><span class="line">        results = <span class="keyword">new</span> <span class="keyword">char</span>[nodeCount];</span><br><span class="line">        index = nodeCount;</span><br><span class="line">        <span class="keyword">for</span> (GraphNode node : map.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (visitedMap.containsKey(node.c)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!sortHelper (node)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(results);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">sortHelper</span><span class="params">(GraphNode node)</span> </span>&#123;</span><br><span class="line">        visitedMap.put(node.c, -<span class="number">1</span>); <span class="comment">//-1 代表该点正在被访问，用于避免循环的情况出现.</span></span><br><span class="line">        Iterator it = node.neighbors.iterator();</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">            GraphNode neighbor = (GraphNode)it.next();</span><br><span class="line">            <span class="keyword">if</span> (visitedMap.containsKey(neighbor.c)) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (visitedMap.get(neighbor.c) == -<span class="number">1</span>) &#123; <span class="comment">//如果循环发生，则返回false</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (visitedMap.get(neighbor.c) == <span class="number">1</span>) &#123;  <span class="comment">//如果已经被访问过，则跳过</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; chua</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!sortHelper(neighbor)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        visitedMap.put(node.c, <span class="number">1</span>); <span class="comment">//完成该节点访问，状态变1</span></span><br><span class="line">        results[--index] = node.c;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GraphNode</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        Set&lt;GraphNode&gt; neighbors;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">GraphNode</span> <span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.c = c;</span><br><span class="line">            <span class="keyword">this</span>.neighbors = <span class="keyword">new</span> HashSet&lt;GraphNode&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外，可以用Topological Sort解决的问题还有：</p>
<ul>
<li><a href="https://leetcode.com/problems/course-schedule-ii/" target="_blank" rel="noopener">LeetCode 210. Course Schedule II</a></li>
<li><a href="https://leetcode.com/problems/longest-increasing-path-in-a-matrix/" target="_blank" rel="noopener">LeetCode 329. Longest Increasing Path in a Matrix</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/07/14/Techmon-Go-1-Hash/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/14/Techmon-Go-1-Hash/" class="post-title-link" itemprop="url">Data Structure & Algorithms Notes: Hash</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-14 21:57:32" itemprop="dateCreated datePublished" datetime="2016-07-14T21:57:32-07:00">2016-07-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-07-30 14:23:56" itemprop="dateModified" datetime="2016-07-30T14:23:56-07:00">2016-07-30</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/14/Techmon-Go-1-Hash/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/14/Techmon-Go-1-Hash/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="I-Hash-Function"><a href="#I-Hash-Function" class="headerlink" title="I. Hash Function"></a>I. Hash Function</h3><h5 id="a-31"><a href="#a-31" class="headerlink" title="a. 31"></a>a. 31</h5><p>In Java, the hash code for a String object is computed as</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]</span><br></pre></td></tr></table></figure>

<p>The value 31 was chosen because it is an odd prime. If it were even and the multiplication overflowed, information would be lost, as multiplication by 2 is equivalent to shifting. The advantage of using a prime is less clear, but it is traditional. A nice property of 31 is that the multiplication can be replaced by a shift and a subtraction for better performance: 31 * i == (i &lt;&lt; 5) - i. Modern VMs do this sort of optimization automatically.</p>
<h5 id="b-31-mod-n"><a href="#b-31-mod-n" class="headerlink" title="b. 31 mod n"></a>b. 31 mod n</h5><p>Based on 31, mod the result with n, n stands for capacity.</p>
<h5 id="c-rolling-hash"><a href="#c-rolling-hash" class="headerlink" title="c. rolling hash"></a>c. rolling hash</h5><p>This is used to find if str1 contains str2:</p>
<pre><code>index = 0123456789
str1 = &quot;fsaabcdefg&quot;
str2 = &quot;abc&quot;
...
result1 = str1[3] * 31 ^ 0 + str1[4] * 31 ^ 1 + str1[5] * 31 ^ 2
...
result2 = str2[0] * 31 ^ 0 + str2[1] * 31 ^ 1 + str2[2] * 31 ^ 2</code></pre><h3 id="II-Hash-Families"><a href="#II-Hash-Families" class="headerlink" title="II. Hash Families"></a>II. Hash Families</h3><p>Hashtable: thread safe, but deprecated.<br>ConcurrentHashMap: an advanced version of Hashtable;<br>HashMap: not thread safe.<br>TreeMap: <a href="https://docs.oracle.com/javase/7/docs/api/java/util/TreeMap.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/7/docs/api/java/util/TreeMap.html</a></p>
<h3 id="III-Implement-hashCode-and-equals-methods"><a href="#III-Implement-hashCode-and-equals-methods" class="headerlink" title="III. Implement hashCode and equals methods"></a>III. Implement hashCode and equals methods</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String str;</span><br><span class="line">    <span class="keyword">public</span> Integer inter;</span><br><span class="line">    <span class="keyword">public</span> Object obj;</span><br><span class="line">    <span class="keyword">public</span> Integer inter1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> prime = <span class="number">31</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> N = <span class="number">345678</span>;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">        result = result * prime + str.hashCode();</span><br><span class="line">        result = result * prime + inter;</span><br><span class="line">        result = result * prime + obj.hashCode();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == obj) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (getClass() != obj.getClass()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Item other = (Item) obj;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (str == <span class="keyword">null</span> &amp;&amp; other.str != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!str.equals(other.str)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="IV-Probabilities"><a href="#IV-Probabilities" class="headerlink" title="IV. Probabilities"></a>IV. Probabilities</h3><p>a. n elements, n cells, question: for any particular cell, the prob of<br>    the number of elements is equal to k.<br>    Ans: prob = C(n, k) * (1/n)^k * (1-1/n)^(n-k)</p>
<p>b. N people with everyone of different birthday<br>    Ans: p(n) = 365/365 * 364/365 * .. * (365-n)/365 &lt; 50%</p>
<p>c. More probability questions<br><a href="https://www.careercup.com/page?pid=probability-interview-questions" target="_blank" rel="noopener">https://www.careercup.com/page?pid=probability-interview-questions</a></p>
<h3 id="V-Further-Readings"><a href="#V-Further-Readings" class="headerlink" title="V. Further Readings"></a>V. Further Readings</h3><p>a. Java Knowledge<br>    1. Annotation;</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/06/27/python-basics-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/06/27/python-basics-notes/" class="post-title-link" itemprop="url">Learn Python Basics Learning Notes I</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-06-27 23:07:30" itemprop="dateCreated datePublished" datetime="2016-06-27T23:07:30-07:00">2016-06-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-03-21 08:57:48" itemprop="dateModified" datetime="2017-03-21T08:57:48-07:00">2017-03-21</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/06/27/python-basics-notes/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/06/27/python-basics-notes/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="I-Python-for-Beginners"><a href="#I-Python-for-Beginners" class="headerlink" title="I. Python for Beginners"></a>I. Python for Beginners</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Python is a language with widespread adoption and lots of uses.</p>
<h3 id="Python-Variable"><a href="#Python-Variable" class="headerlink" title="Python Variable"></a>Python Variable</h3><p>Example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">"Danny"</span></span><br></pre></td></tr></table></figure>

<h3 id="Fuctions-and-Objects"><a href="#Fuctions-and-Objects" class="headerlink" title="Fuctions and Objects"></a>Fuctions and Objects</h3><p>Example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_function_name</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"this is the function body"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Syntax-and-Style"><a href="#Syntax-and-Style" class="headerlink" title="Syntax and Style"></a>Syntax and Style</h3><p>Every programming language has specific words and rules for using them which we call syntax. Some languages also have rules about how the code should look. Python has both of these!<br>Blocks are indented one extra step.Each indentation step should be four spaces (just hit tab)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">answer_the_phone</span><span class="params">()</span>:</span></span><br><span class="line">    greeting = <span class="string">"Hi, this is Kenneth. Who is this?"</span></span><br><span class="line">    print(greeting)</span><br></pre></td></tr></table></figure>

<h3 id="The-Python-Shell"><a href="#The-Python-Shell" class="headerlink" title="The Python Shell"></a>The Python Shell</h3><p>In Mac, just type “python” in terminal to enter python shell, and type “exit()” to quit.</p>
<h3 id="Running-Python-Scripts"><a href="#Running-Python-Scripts" class="headerlink" title="Running Python Scripts"></a>Running Python Scripts</h3><p>Example to run a python script in python shell:<br>treehouse:~/workspace$ python hello_world.py</p>
<h3 id="Errors"><a href="#Errors" class="headerlink" title="Errors:"></a>Errors:</h3><p>*<em>NameError: *</em><br>Example: 5 + x<br>Got the error because the x is not defined.</p>
<p><strong>TypeError: 5 + ‘a’</strong><br>Got the error because 5 and ‘a’ are different types, and can not be added.</p>
<p><strong>SyntaxError:</strong><br>Example: print(“Hello)<br>Got the error because of missing the syntax “</p>
<h2 id="II-Python-Data-Types"><a href="#II-Python-Data-Types" class="headerlink" title="II. Python Data Types"></a>II. Python Data Types</h2><p>TBD</p>
<h2 id="III-Logic-in-Python"><a href="#III-Logic-in-Python" class="headerlink" title="III. Logic in Python"></a>III. Logic in Python</h2><p>TBD</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/04/25/build-api-in-spark/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/04/25/build-api-in-spark/" class="post-title-link" itemprop="url">Build a REST API in Spark Summary</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-04-25 20:46:16 / Modified: 20:49:56" itemprop="dateCreated datePublished" datetime="2016-04-25T20:46:16-07:00">2016-04-25</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/04/25/build-api-in-spark/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/04/25/build-api-in-spark/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>In the last several days, I built a REST service by myself for the first time. It’s pretty cool to know the concepts of building REST service and make it working!  :)</p>
<h4 id="I-Intro"><a href="#I-Intro" class="headerlink" title="I. Intro"></a>I. Intro</h4><p> This project provides the following REST endpoints:</p>
<ul>
<li><strong>/courses</strong><ul>
<li>POST: add a course to server;</li>
<li>GET: get all courses from server.</li>
</ul>
</li>
<li><strong>/courses/{id}</strong><ul>
<li>GET: get a specific course from server.</li>
</ul>
</li>
<li><strong>/courses/{id}/reviews</strong><ul>
<li>POST: add a review to a specific course;</li>
<li>GET: get the reviews of a specific course.</li>
</ul>
</li>
</ul>
<h4 id="II-Topics"><a href="#II-Topics" class="headerlink" title="II. Topics"></a>II. Topics</h4><p>From this project, besides knowing the basic steps to build REST service, you can also get familiar with the following topics.</p>
<p><strong>IntelliJ IDEA</strong><br>The IDE used in this project, one of the most popular Java IDE.</p>
<p><strong>Gradle</strong><br>One of the most popular java building tools.  There are also other java building tools like Maven, Ant, etc.<br><a href="https://technologyconversations.com/2014/06/18/build-tools/" target="_blank" rel="noopener">Java Build Tools: Ant vs Maven vs Gradle</a></p>
<p><strong>Spark</strong><br>A micro framework for creating web applications in Java 8 with minimal effort, <strong>NOT</strong> the well known Apache Spark. Spark is built around Java 8’s lambda philosophy, which makes a typical Spark application a lot less verbose than most application written in other Java web frameworks.<br><a href="http://sparkjava.com" target="_blank" rel="noopener">Spark Homepage</a></p>
<p><strong>Dao:</strong><br>Data Access Object is an object that provides an abstract interface to some type of database or other persistence mechanism. By mapping application calls to the persistence layer, DAO provide some specific data operations without exposing details of the database.</p>
<p><strong>Serialization</strong><br>Serialization is usually used When the need arises to send your data over network or stored in files. By data I mean objects and not text.<br>Now the problem is your Network infrastructure and your Hard disk are hardware components that understand bits and bytes but not JAVA objects.<br>Serialization is the translation of your Java object’s values/states to bytes to send it over network or save it.<br>This is analogous to how your voice is transmitted over PSTN telephone lines.</p>
<p><strong>GSON</strong><br>A Java serialization/deserialization library that can convert Java Objects into JSON and back. Created by google.<br><a href="https://github.com/google/gson" target="_blank" rel="noopener">GSON Homepage</a></p>
<p><strong>Sql2o</strong><br>Sql2o is a small java framework that makes it easy to execute sql statements on your JDBC compliant database from java.<br><a href="http://www.sql2o.org" target="_blank" rel="noopener">Sql2o Homepage</a></p>
<p><strong>Lambda Expression</strong><br>Introduced in Java 8. It is an <strong>anonymous function</strong> that you can use to create delegates or expression tree types. By using lambda expressions, you can write local functions that can be passed as arguments or returned as the value of function calls. </p>
<p><strong>Test cases</strong><br>There are some test cases example included in the project, clone the code and check them out! :)</p>
<h4 id="III-References"><a href="#III-References" class="headerlink" title="III References"></a>III References</h4><ul>
<li><a href="https://teamtreehouse.com/library/build-a-rest-api-in-spark" target="_blank" rel="noopener">Treehouse Tutorial</a></li>
<li><a href="https://github.com/dannyzju/course-review-rest-api" target="_blank" rel="noopener">Github Repository</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Danny Zhang</p>
  <div class="site-description" itemprop="description">Blogger/Software Engineer/Fitness Enthusiast</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags">
          
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Danny Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.2
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://dannyzhang-run.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
