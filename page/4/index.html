<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dannyzhang.run","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Blogger&#x2F;Software Engineer&#x2F;Fitness Enthusiast">
<meta property="og:type" content="website">
<meta property="og:title" content="D.Z. Notes (Beta)">
<meta property="og:url" content="http://dannyzhang.run/page/4/index.html">
<meta property="og:site_name" content="D.Z. Notes (Beta)">
<meta property="og:description" content="Blogger&#x2F;Software Engineer&#x2F;Fitness Enthusiast">
<meta property="article:author" content="Danny Zhang">
<meta property="article:tag" content="Danny Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://dannyzhang.run/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false
  };
</script>

  <title>D.Z. Notes (Beta)</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">D.Z. Notes (Beta)</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Be insensitive, and keep a lifelong growth mindset.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section">Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section">Archives</a>

  </li>
        <li class="menu-item menu-item-technical">

    <a href="/technical" rel="section">technical</a>

  </li>
        <li class="menu-item menu-item-essays">

    <a href="/essays" rel="section">essays</a>

  </li>
        <li class="menu-item menu-item-readings">

    <a href="/readings" rel="section">readings</a>

  </li>
        <li class="menu-item menu-item-workout">

    <a href="/workout" rel="section">workout</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags" rel="section">Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about" rel="section">About</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2017/02/25/Cloud-Computing-Concepts-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/25/Cloud-Computing-Concepts-1/" class="post-title-link" itemprop="url">Orientation, Introduction to Clouds, MapReduce</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-25 21:21:37" itemprop="dateCreated datePublished" datetime="2017-02-25T21:21:37-08:00">2017-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-03-21 08:57:46" itemprop="dateModified" datetime="2017-03-21T08:57:46-07:00">2017-03-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Class notes 1 for Cloud Computing Concepts by Indranil Gupta @ Coursera</p>
<p>(初稿完成于 02/25/2017)</p>
<h2 id="Pre-Requirements"><a href="#Pre-Requirements" class="headerlink" title="Pre-Requirements"></a>Pre-Requirements</h2><h3 id="Basic-Data-Structures"><a href="#Basic-Data-Structures" class="headerlink" title="Basic Data Structures"></a>Basic Data Structures</h3><ul>
<li><p>Queue: First-in First-out</p>
</li>
<li><p>Stack: First-in Last-out</p>
<h3 id="Process-A-Program-in-Action"><a href="#Process-A-Program-in-Action" class="headerlink" title="Process: A Program in Action"></a>Process: A Program in Action</h3><h3 id="Computer-Architecture-Simplified"><a href="#Computer-Architecture-Simplified" class="headerlink" title="Computer Architecture (Simplified)"></a>Computer Architecture (Simplified)</h3><p><img src="https://lh3.googleusercontent.com/GMfMsR3vkGyXLt45RnixisMvF_Ye2G23wlVecbaInkuFRZ3kBjQR6JgAdbllBIRzEBIPtrEWLBjVNfQ1jHR92PZ4TuSN9gz99H3P3GCPEiulcbjmTcsmJmlS5E8VPNnoKPnUtWvgJ8XNQPJ6l37_Ml6_jevJMrfOPSjM1dpYxKCLexbEUp80vtJG72QhcHlKVdrr6STCmlcBhz3I5oqnm89Yzyf2XWxvj3cguIL3Gw4XFE2z6oyps5lIu9ZhJycag2H1W1j9AYXwJYSPF-v3rjamBOK8pMuOYNSHEDyNc5lThL09dnp_D_nKFoUBQYinj67R0H33Sc3jsRaZi8f65sPcFu-DvL2tQ2A8FmWmQg4yoSkXtZJ3ilkmfZ4NkFErQXOWMJREyG1SZFI4zjTnS0_Ve22dlxoXPNmixIH59ZBLmEndkR65ET45fpvkuiHpyoDCuUaNW_eAeEkKSaoTZDMLxUGaksmm62K9XU_lWHEiR1YwVW24V_vDYXH-Shmhpnt_qzDnBYF9NJXb321wmNmIEatmQMoc6vNXHHkNqpvEtMUiXlXEWCwrpK3_AdyOI9sCRyXL47jswkxCCANfwW3MKHppX3kHJLRJd19qrQSh5RlJ11k8eYnbZCwopaDWVjM3pbgPoXog56JSLNEKALGsUu2fUW9hbzx_aCj3EQ=w792-h798-no" alt="Simplified Computer Architecture"></p>
</li>
<li><p>A program you write (C++/Java etc.) gets compiled to low-level machine instructions</p>
<ul>
<li>Stored in file system on disk</li>
</ul>
</li>
<li><p>CPU loads instructions in batches into memory(and cache, and registers)</p>
</li>
<li><p>As it executes each instruction, CPU loads data for instruction into memory (and cache, and registers)</p>
<ul>
<li>And does any necessary stores into memory</li>
</ul>
</li>
<li><p>Memory can also be flushed to disk</p>
<h3 id="Big-O-Notation"><a href="#Big-O-Notation" class="headerlink" title="Big O() Notation"></a>Big O() Notation</h3></li>
<li><p>One of the most basic ways of analyzing algorithms</p>
</li>
<li><p>Describes <strong><em>upper bound</em></strong> on behavior of algorithm as some variable is scaled(increased) to infinity</p>
</li>
<li><p>Analyzes run-time (or another performance metric)</p>
</li>
<li><p>Worst-case performance</p>
<h3 id="Basic-Probability"><a href="#Basic-Probability" class="headerlink" title="Basic Probability"></a>Basic Probability</h3><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3></li>
<li><p>Domain Name Service</p>
</li>
<li><p>Collection of servers, throughout the world</p>
</li>
<li><p>Input to DNS: a domain name, e.g., coursera.org</p>
</li>
<li><p>Output from DNS: IP address of a web server(that hosts that content)</p>
</li>
<li><p>IP address may refer to either</p>
<ul>
<li>Web server actually hosting that content, or</li>
<li>An indirect server, e.g., a CDN(content distribution network)server, e.g., from Akamai<h3 id="Graphs"><a href="#Graphs" class="headerlink" title="Graphs"></a>Graphs</h3></li>
</ul>
</li>
</ul>
<h2 id="Introduction-to-Clouds-MapReduce"><a href="#Introduction-to-Clouds-MapReduce" class="headerlink" title="Introduction to Clouds, MapReduce"></a>Introduction to Clouds, MapReduce</h2><h3 id="Introduction-to-Clouds"><a href="#Introduction-to-Clouds" class="headerlink" title="Introduction to Clouds"></a>Introduction to Clouds</h3><h4 id="Why-Cloud"><a href="#Why-Cloud" class="headerlink" title="Why Cloud?"></a>Why Cloud?</h4><p>Two Categories of Clouds</p>
<ul>
<li>Public Clouds: provides service to any paying customer<ul>
<li>Amazon S3(Simple Storage Service): store arbitrary datasets, pay per GB-month stored</li>
<li>Amazon EC2(Elastic Compute Cloud): upload and run arbitrary OS image, pay per CUP hour used</li>
<li>Google App Engine/Compute Engine: develop applications within their App Engine framework, upload data that will be imported into their format, and run</li>
</ul>
</li>
<li>Private Clouds: accessible only to company employees</li>
</ul>
<p>Customers save time and money by using clouds.</p>
<h4 id="What-is-a-Cloud"><a href="#What-is-a-Cloud" class="headerlink" title="What is a Cloud?"></a>What is a Cloud?</h4><p>Cloud = Lots of storage + compute cycles nearby</p>
<ul>
<li>A single-site cloud (aka “Datacenter”) consists of<ul>
<li>Compute nodes (grouped into racks)</li>
<li>Switches, connecting the racks</li>
<li>A network topology, e.g., hierarchical</li>
<li>Storage (backend) nodes connected to the network</li>
<li>Front-end for submitting jobs and receiving client requests</li>
<li>Software Services</li>
</ul>
</li>
<li>A geographically distributed cloud consists of<ul>
<li>Multiple such sites</li>
<li>Each site perhaps with a different structure and services</li>
</ul>
</li>
</ul>
<h4 id="Introduction-to-Clouds-History"><a href="#Introduction-to-Clouds-History" class="headerlink" title="Introduction to Clouds: History"></a>Introduction to Clouds: History</h4><p>Trends: Technology</p>
<ul>
<li>Doubling periods - storage: 12 months, bandwidth: 9 months（Moore’s law）</li>
<li>Then and Now<ul>
<li>Bandwidth<ul>
<li>1985: mostly 56Kbps links nationwide</li>
<li>2012: Tbps links widespread</li>
</ul>
</li>
</ul>
</li>
<li>Disk capacity<ul>
<li>Today’s PCs have TBs, far more than a 1990 super computer</li>
</ul>
</li>
<li>Biologists<ul>
<li>1990: were running small single-molecule simulations</li>
<li>2012: CERN’s Large Hadron Collider producing many PB/year</li>
</ul>
</li>
</ul>
<p>In 1965, MIT’s Fernando Corbato and the other designers of the Multics operating system envisioned a computer facility operating “like a power company or water company.”</p>
<p>Plug your thin client into the computing utility and play your favorite Intensive Compute &amp; Communicate Application</p>
<ul>
<li>Have today’s clouds brought us closer to this realty? ：）</li>
</ul>
<h4 id="Introduction-to-Clouds-What’s-New-in-Today’s-Clouds"><a href="#Introduction-to-Clouds-What’s-New-in-Today’s-Clouds" class="headerlink" title="Introduction to Clouds: What’s New in Today’s Clouds"></a>Introduction to Clouds: What’s New in Today’s Clouds</h4><p><img src="https://lh3.googleusercontent.com/_klWna3gomnU7K_kdB-ZgaVgvJVJ5Fd4GxFPO6RykM7Gci83sUHWyZx_u3q0hbAbLsRIOmJjQTmfiwirgvUdR2BB5GY1bt0BVmX8n4WYzTU9Q3oDGtT6RZW0WCtvxeckOclLu9_VGWcD_0oM7UARN0kYFWNBTS7lV5ego1jyvS6hKheFJMOEHawHPDv5JtqBnE-Zy4T5OaOTqSnGhMa30TxMgtDrt-AyIg_nM4lF39dVEbHRX3xI7k1U80KU3GUXe3p7kXjMgXNmXh9VJhf8ybmuckFivZp8AVbV1cc876SHIcOSwseFuLZkgX7A2zPgyF-r9h29pwTKZl6jAe82zXr5XLSbVr6l9m2axZTOd7dwRWG-3aGSxoQexEfw8x7l9JszreA8HQyfN0VhWNt3hEqUCP1fjpr5LUVcO-p0l82mHug3wT3gDI5q7CXpWwA6HbggJjUx79dedUHM9AcNWL14VtUo81X8Q3gWnxAF86HkyZMSeF6Q_SGz9EyTyv6gaJhs6koP0NsrTyVso8cVp2YN6X-M1nD6sVrjMxhfiiSpUhnAdl_tZTZ1f0POZVEk_path5pCMNjswTkn-A-u5JemaImNoT4Mxb3NdUj4p4N4HQwZ6sRPiIiUAK_YY9otUl_dzvtT0SmK3ZrnXPrWKCeTqMYT8e5vHT6xIUkkaw=w915-h516-no" alt="A Cloud History of Time(1)"></p>
<p><img src="https://lh3.googleusercontent.com/3qBz0i1ihRrboZWMiF0JXRt1OnW6G8sObd6p8n3v5fbTWQ7vgcuVNkCYXBWhxeGHvmG4ahd7VR_c_YnBpfDXjv5x_fflfzUCI9Um01TLRt0G_x6jPThN6drwTUHQGM88lsdxx3h28ef3fxrZTJUAzk-lKImn84ENuACf6Rh-Z8TEvyjDa1btfQzIONnSOGJJBiW52eQKmmZqfFgZpBqBZRd-0eRuK80h0kTNwgUJSe5xWDJf8D1tkfaeNCxM8I34QVY826nz58MRD3kmiQSnCht8QQdN92atO89h_uoyu8v8bMnvChVpn_KGGRNbGy99SGdulBcY5I8BquYMa4VBJsZ0vO5wrriIPmVS9Z0IkHQqER5fbWo7t95HLZmhzJhmFRsDylXuWHq22jBjIqUvutGRU_TYKivQ3mEmiaQbFZtO_xHC0V-omd49UTeRbWd2V1UbNhMTbMy9f8fpPwO_PvjHp3ENEMGFBjoNTbR4X2lWvlvF4qOsIE0F45dFZch-2SSkKX3jRH75BcnLVLZ1vYeUjYZM16JXV-2L6n8yWh7vDmbqjm_4bG70gYmIrAY_6Cd21IQvhZ9Qf5S48Es9WUv7P5xz9sFhEjSe7o9HUBXFS9XfjVnJnX5B01dfRd4G-FKDH9Sq9e3EOKvdXII-ibZbuKrth_etQWSWjAyjMA=w915-h428-no" alt="A Cloud History of Time(2)"></p>
<p>Four Features New in Today’s Clouds</p>
<ol>
<li><strong>Massive Scale</strong></li>
</ol>
<ul>
<li>Facebook servers[GigaOM, 2012]:<ul>
<li>30K in 2009 -&gt; 60K in 2010 -&gt; 180K in 2012</li>
</ul>
</li>
<li>Microsoft[NYTimes, 2008]:<ul>
<li>150K machines</li>
<li>Growth rate of 10K per month</li>
<li>80K total running Bing</li>
</ul>
</li>
<li>Yahoo![2009]:<ul>
<li>100K</li>
<li>Split into clusters of 4000</li>
</ul>
</li>
<li>AWS EC2[Randy Bias, 2009]<ul>
<li>40,000 machines</li>
<li>8 cores/machine</li>
</ul>
</li>
<li>eBay[2012]: 50K machines</li>
<li>HP[2012]: 380K in 180 DCs</li>
<li>Google: A lot</li>
</ul>
<ol start="2">
<li><strong>On-demand access</strong>: Pay-as-you-go, no upfront commitment</li>
</ol>
<ul>
<li>Anyone can access it</li>
</ul>
<ol start="3">
<li>Data-intensive Nature: What was MBs has now become TBs, PBs, and XBs.</li>
</ol>
<ul>
<li>Daily logs, forensics, Web data, etc.</li>
<li>Humans have data numbness: Wikipedia (large) compress is only about 10GB!</li>
</ul>
<ol start="4">
<li>New Cloud Programming Paradigms: MapReduce/Hadoop, NoSQL/Cassandra/MongoDB and many others</li>
</ol>
<ul>
<li>High in accessibility and ease of programmability</li>
<li>Lots of open-source</li>
</ul>
<h4 id="Introduction-to-Clouds-New-Aspects-of-Clouds"><a href="#Introduction-to-Clouds-New-Aspects-of-Clouds" class="headerlink" title="Introduction to Clouds: New Aspects of Clouds"></a>Introduction to Clouds: New Aspects of Clouds</h4><p><strong>On-Demand Access: *AAS Classification</strong></p>
<ul>
<li>On-demand: renting a cab vs (previously) renting a car, or buying one. E.g.:<ul>
<li>AWS Elastic Compute Cloud(EC2): a few cents to a few $ per CPU hour</li>
<li>AWS Simple Storage Servie (S3): a few cents to a few &amp; per GB-month</li>
</ul>
</li>
<li>HaaS: Hardware as a Service<ul>
<li>You get access to barebones hardware machines, do whatever you want with them, Ex: your own cluster</li>
<li>Not always a good idea because of security risks</li>
</ul>
</li>
<li>IaaS: Infrastructure as a Service<ul>
<li>You get access to flexible computing and storage infrastructure. Virtualization is one way of achieving this (what’s another way, e.g., using Linux). Often said to subsume HaaS.</li>
<li>Ex: Amazon Web Service (AWS: EC2 and S3), Eucalyptus, Rightscale, Microsoft Azure.</li>
</ul>
</li>
<li>PaaS: Platform as a Service<ul>
<li>You get access to flexible computing and storage infrastructure, coupled with a software platform(often tightly)</li>
<li>Ex: Google’s AppEngine (Python, Java, Go)</li>
</ul>
</li>
<li>SaaS: Software as a Service<ul>
<li>You get access to software services, when you need them. Often said to subsume SOA (Service Oriented Architectures)</li>
<li>Ex: Google docs, MS Office on demand</li>
</ul>
</li>
</ul>
<p><strong>Data-Intensive Computing</strong></p>
<ul>
<li>Computation-Intensive Computing<ul>
<li>Example areas: MPI-based, High-performance computing, Grids</li>
<li>Typically run on supercomputers(e.g., NCSA Blue Waters)</li>
</ul>
</li>
<li>Data-Intensive<ul>
<li>Typically store data at datacenters</li>
<li>Use compute nodes nearby</li>
<li>Compute nodes run computation services</li>
</ul>
</li>
<li>In data-intensive computing, the focus shifts from computation to the data: CPU utilization no longer the most important resource metric, instead I/O is (disk and/or network)</li>
</ul>
<p><strong>New Cloud Programming Paradigms</strong></p>
<ul>
<li>Easy to write and run highly parallel programs in new programming paradigms:<ul>
<li>Google: MapReduce and Sawzall</li>
<li>Amazon: Elastic MapReduce service(pay-as-you-go)</li>
<li>Google(MapReduce)<ul>
<li>Indexing: a chain of 24MapReduce jobs</li>
<li>~200K jobs processing 50PB/month (in 2006)</li>
</ul>
</li>
</ul>
</li>
<li>Yahoo!(Hadoop + Pig)<ul>
<li>WebMap: chain of 100 MapReduce jobs</li>
<li>280TB of data, 2500 nodes, 73 hours</li>
</ul>
</li>
<li>Facebook(Hadoop + Hive)<ul>
<li>~300TB total, adding 2TB/day(in 2008)</li>
<li>3K jobs processing 55TB/day</li>
</ul>
</li>
<li>Similar numbers from other companies, e.g., Yieldex, harmony.com, etc.</li>
<li>NoSQL: MySQL is an industry standard, but Cassandra is 2400 times faster!</li>
</ul>
<h4 id="Introduction-to-Clouds-Economics-of-Clouds"><a href="#Introduction-to-Clouds-Economics-of-Clouds" class="headerlink" title="Introduction to Clouds: Economics of Clouds"></a>Introduction to Clouds: Economics of Clouds</h4><ul>
<li><p>Two Categories of Clouds</p>
<ul>
<li>Private clouds are accessible only to company employees</li>
<li>Public clouds provide service to any paying customer</li>
</ul>
</li>
<li><p>Singe Site Cloud: To Outsource or Own?</p>
<ul>
<li>Medium-sized organization: wishes to run a service for M months<ul>
<li>Service requires 128 servers(1024 cores) and 524 TB</li>
<li>Same as UIUC CCT cloud site</li>
</ul>
</li>
</ul>
</li>
<li><p><code>Outsource</code> (e.g., via AWS): monthly cost</p>
<ul>
<li>S3 costs: $0.12 per GB month. EC2 costs: $0.10 per CPU hour (costs from 2009)</li>
<li>Storage = $0.12 x 524 x 1000 = $62 K</li>
<li>Total = Storage + CPUs = $62K + $0.10 x 1024 x 24 x 30 = $136 K</li>
</ul>
</li>
<li><p><code>Own</code>: monthly cost</p>
<ul>
<li>Storage ~ $349 K / M</li>
<li>Total ~ $1555K / M + 7.5K(includes 1 sysadmin / 100 nodes)<ul>
<li>Using 0.45:0.4:0.15 split for hardware:power:network and 3 year life time of hardware</li>
</ul>
</li>
</ul>
</li>
<li><p>Breakdown analysis: more preferable to own if:</p>
<ul>
<li>$349 K / M &lt; $62 K (storage)</li>
<li>$1555K / M + 7.5 K &lt; $136K (overall)</li>
</ul>
</li>
<li><p>Break even points</p>
<ul>
<li>M &gt; 5.55 months (storage)</li>
<li>M &gt; 12 months (overall)</li>
</ul>
</li>
<li><p>As a result</p>
<ul>
<li>Startups use clouds a lot</li>
<li>Cloud providers benefit monetarily most from storage</li>
</ul>
</li>
<li><p>Summary</p>
<ul>
<li>Clouds build on many previous generations of distributed systems</li>
<li>Especially the timesharing and data processing industry of the 1960-70s.</li>
<li>Need to identify unique aspects of a problem to classify it as a new cloud computing problem<ul>
<li>Scale, On-demand access, data-intensive, new programming</li>
</ul>
</li>
<li>Otherwise, the solutions to your problem may already exist!</li>
</ul>
</li>
</ul>
<h3 id="Clouds-are-Distributed-Systems"><a href="#Clouds-are-Distributed-Systems" class="headerlink" title="Clouds are Distributed Systems"></a>Clouds are Distributed Systems</h3><h4 id="A-cloud-is-a-Distributed-System"><a href="#A-cloud-is-a-Distributed-System" class="headerlink" title="A cloud is a Distributed System"></a>A cloud is a Distributed System</h4><ul>
<li>A cloud consists of<ul>
<li>Hundreds to thousands of machines in a datacenter (server side)</li>
<li>Thousands to millions of machines accessing these services (client side)</li>
</ul>
</li>
<li>Servers communicate amongst one another -&gt; Distributed System</li>
<li>Clients communicate with servers -&gt; Also a distributed system!</li>
<li>Clients also communicate with each other<ul>
<li>In peer-to-peer systems like BitTorrent</li>
<li>Also a distributed system!</li>
</ul>
</li>
</ul>
<p><strong>Four Features of Clouds = All Distributed Systems Features!</strong></p>
<ol>
<li>Massive Scale: many servers</li>
<li>On-demand nature: access (multiple) servers anywhere</li>
<li>Data-Intensive Nature: lots of data =&gt; need a cluster (multiple machines) to store</li>
<li>New Cloud Programming Paradigms: Hadoop/Mapreduce, NoSQL all need clusters</li>
</ol>
<p><strong>Cloud = A Fancy Word for a Distributed System</strong></p>
<ul>
<li>A “cloud” is the latest nickname for a distributed system</li>
<li>Previous nicknames for “distributed system” have included<ul>
<li>Peer-to-peer systems</li>
<li>Grids</li>
<li>Clusters</li>
<li>Timeshared computers (Data Processing Industry)</li>
</ul>
</li>
<li>Nicknames come and go, but the <code>core concepts</code> underlying distributed systems stay the same<ul>
<li>And they are used decide after decade<ul>
<li>E.g., Lamppost Timestamps were invented in the 1970s, and they are used in almost all distributed/cloud systems today</li>
</ul>
</li>
<li>This course is about these distributed systems concepts</li>
</ul>
</li>
<li>A few years from now, there may be a new nickname for distributed systems<ul>
<li>The core concepts will remain the same, and they will continue to be used in real systems</li>
</ul>
</li>
</ul>
<h4 id="What-is-a-Distributed-System"><a href="#What-is-a-Distributed-System" class="headerlink" title="What is a Distributed System?"></a>What is a Distributed System?</h4><p><em>A distributed system is a collection of entities, each of which is <code>autonomous</code>, <code>programmable</code>, <code>asynchronous</code> and <code>failure-prone</code>, and which communicate through an <code>unreliable</code> communication medium</em>.</p>
<p>Distributed System = Many Processes Sending and Receiving Messages through Unreliable Communication Network</p>
<p>A range of interesting problems for distributed system designers</p>
<ul>
<li>P2P systems [Gnutella, Kazaa, BitTorrent]</li>
<li>Cloud Infrastructures [AWS, Azure, Google Cloud]</li>
<li>Cloud Storage [Key-value stores, NoSQL, Cassandra]</li>
<li>Cloud Programming [MapReduce, Storm, Pregel]</li>
<li>Coordination [Paxos, Leader Election, Snapshots]</li>
<li>Managing Many Clients and Servers Concurrently [Concurrency Control, Replication Control]</li>
<li>(and many more that you’ll see in this course!)</li>
</ul>
<p>Challenges in solving these problems</p>
<ul>
<li><strong>Failure</strong>: no longer the exception, but rather a norm</li>
<li><strong>Scalability</strong>: 1000s of machines, Terabytes of data</li>
<li><strong>Asynchrony</strong>: clock skew and clock drift</li>
<li><strong>Concurrency</strong>: 1000s of machines interacting with each other accessing the same data</li>
</ul>
<h3 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h3><h4 id="MapReduce-Paradigm"><a href="#MapReduce-Paradigm" class="headerlink" title="MapReduce Paradigm"></a>MapReduce Paradigm</h4><ul>
<li>Terms are borrowed from Functional Language(e.g., Lisp)</li>
<li>Sample Application: <code>Wordcout</code></li>
<li>Map:<ul>
<li>Parallelly Process a large number of individual records to generate intermediate key/value pairs.</li>
</ul>
</li>
</ul>
<p><img src="https://lh3.googleusercontent.com/DfWUkmMQ79PNd6tZDsgblL-iHF3qVFJr1hKI5yBDiGP_1274BtvxE8RhZsR9oGrDe93rNP_fR2YexJtw6iWb4ZlX6DVNBoiqPmZNVrNa6WLYGNnDZuRBXDHX8bqtDdqJrJYD0j0IdHiDwZNDd9rV7fscbWLaaVg75RSDJSb9c5uTlwDrqsV-Zod4JALW5ePcGKvpthf_paxOeK9Ahk6-d-IZma2SELKmSBp_5H1c64WU_dI-D91x1ddBUE7tl36ZlrYyKOp-u-PQkIF3wWszZEq7tls7RKaJ0CONDsf0s9uuD4rikXoTqPECkelROgRat3Ott1iT0Q-F4blAuHkR67CrsnUmqcdhSQ0xB_u2UNXGLpwPmAB_5rHDlwq1hJDel4GeoMNcg00e2Z_iNSMMBer11Rxw5Ho5qPn2LYA_4t2etHNMvUgcDI0CZ6ZjUYeFFxTP5gDi4nJ78yPLlQD8KpsHtJffIU7pcRPJlRqNtdix26rBj4vpOhtsdUvo5X6yzUj_RZbYfc2CxPFX3Wxdx9GjIYvIrNCaRrXY37FEUsPdAN6mKr-Z3mJK1gv7_lP2NdHy_ICQwZPA_EkxdGq39tFied4C6gRn51ijaek0CP5xO-16rjTufMNXYky8vH8117P4cWJ9YbtwbyBeCFvFaeqb5oDiy_Ei2lANSPsbMQ=w515-h221-no" alt="Map Task"></p>
<p><img src="https://lh3.googleusercontent.com/Zzn05SvIEdGVi_2XrtRDz5y_znvh2fBbBUpif2gDg3-OiAW1f2kEBEgOBXon2j5zfYx44BIzMA-0-cfsQPQlBObbaguZp5HZnC5prLDDZ06U-JS-9kXT458I0SjNdRW_dvlTh8aV5Enlk1THmR9lyUlFcMomAL4UWhMiBVH9JdHvxYaPGSWkN2ZUH24NJXAf0ehDVtSTggcI_igtR9zJ2q4ktj5W12BxmTf6KAvpP8P37xKnO6NdubZDQbjQ7s5izpmXOMU3N8MY1BN3R6HEv6HkLW2Pw9CNhCDfQg21ETyPTTKMMZW5jEw6l_J1-K1U5OiW6ihns6zBSVogPslfkks2eVt68HegruksFs_0OUw6ZIYJ0ifwAF3Qegf4pMJgVduETukuFSv9yiVVskNR4QXDwQWfyyqsqQXIcyQ9QU2eoAHOUdbY6_dfa28oYz50XnnGsq74meNo7X0JovLI0t5bHya1Wo9gGuscMR2WBNdyvwS3zYMNOtBjoofuT4sVAI0-s1_BAlGlmoDrabZhMEIdV69QEVcLdA_-pGC1QwLRdw_T9YhMTNEUOeKnZ3MYzZQxGjiJY6wYHu1HUg_Y7ukj3mBZKW_xuJxlYtsClRR89WF6GPwwUX_-wtA1rq_2jc2APmzoMQ0rcFpP76oqv03kvyKe44Z42vC5wcQXzg=w550-h230-no" alt="Two Map Tasks"></p>
<p><img src="https://lh3.googleusercontent.com/oIFVIxsAc2O8FUBhHcM53R_CbBjDvh_SuUJ2G_w3UGK1Jw-7vs6GnDlSRzpfeDt-kIplYHviiWvk19FtIjbTUBRQVd0MNkQsk-uw_OwyFPNFHrn1LrsTaQtNSqaRJLj4WE2jWrXiesYd3JHdZp3ZuKFYammv2KnCFgtD2VpA_TyrqmsT76-x9qZ5RlkGDJesQABTCgTzxQx0vCkaBtvl2dBb8ReNI9BeU0f1XUNaadXmYXUxU6x8cxpQGPPXJGy9CG1IXvI8a3CJpaqy9hxqNwvK-qTK0c5WONNF7BVzkOwHxFZvq4qBC8V5gm9gxxmyKBMZoeeRjC-vuYkF77nuU30-0B9PfNSz92i1xaNz0QzcT6sipacAzFmyXdxz4dBdLHriaiX8pZ3VSsHrIBQj8YxRcUWgdxSeAcnfCFyCs5Sjo7WfodDSFoz_Ow_0f7e2NurgmCQUP2jFk7wIRrqUls8cNsFcAZnfxrpnLplgnk-97U7kWK9IThQKvav8ugcFLcgReslCD0dZTZZQjHm3BxcQG9Lg0tcnMGGC2bp3cPG-KX85UlCs0rU5hQZCh9wykDwG80WDTcZb9tUVKK4_o_NORSZR7FFA-mrsz9sW5xjxMWcWLbjmZnT3ds29fYSyECWpgnupHTKQoR6BQ21lQHFnjZnzHewc6tFn62_YXA=w554-h211-no" alt="Many Map Tasks"></p>
<ul>
<li>Reduce:<ul>
<li>Processes and merges all intermediate values associated per key</li>
<li>Each key assigned to one Reduce</li>
<li>Parallelly Processes and merges all intermediate values by partitioning keys</li>
<li>Popular: Hash partitioning, i.e., key is assigned to reduce #= hash(key)% number of reduce servers</li>
</ul>
</li>
</ul>
<p><img src="https://lh3.googleusercontent.com/mWsFpursi24LyePN_HIZ7LGSgLhYgwsDqyFV1-wVtAwszGvPCGs8f-oDjISRGMEqP_kzxM9SmTcB2wiC-gp5ThjbzuKi1a-kGZ5IBUogIMqfXUKqaRtd3XJOs8unXx10PoFCOGVhP4xgFtSqJ5xg5oGQl7cazW_Zn7sUhhnMoDK90sLKcE_ldYaXI9n_cIC3YxECaXVmRwWdPsro1m5ntflm0vth9-XnO8ILIUn-YgeC_jU1b9ucNY9t2pZAy6TpgTaf6ZU3y7LXpEyeJEtHVzYegqjfORaRVlri1_t9OL1O3Aft8AIgSK9w6cLcoQJAtiW6zizkke8OXkHrYuP-BDaJzzdiB_-NlNxZeGsHoIsGLkobJkLyLvJv6W9NQFdNTD3RN4dVpE0hcfDKWi1ofFo9FepvX_I0wZ6Ko0YZa8s8hpUDvJaqMiDKNGYJ1t_mmxwJyybSPBcKlnfIBENUjT2EUkZf27TH0qMHVoZfIWhpGSyz9ihN0pa6CYuEBIwjpMhDZY95vfnd_Qb-geNKFXkgeXvS5BcOK3Taw8Ah_Jy62ylqbWQ81gM726xQboMnuXaYW1ffGqRMB-wKkn9FIPWUXzurLfiwzOBHRaWLKLTvZQ0KaF6f9S9gLb3epaUbNQYzs7qXz8vQi2UBw_pGhVzLrx4ehrTX_M5nNC7zrA=w493-h214-no" alt="Reduce Task"></p>
<p><img src="https://lh3.googleusercontent.com/YO_-BhfPsNjjotY8XInGVzHyqEt-r5n4wIuERO2L4eX1D-5cKBJd1A0Uw-XDIh7PRBqwijyQXcN0gj8Y69Bdkh1RXfNTjL58qgez1yCakVbr6Im-1dhHHWK-ooI5HPflgKi2JCULU7RHRFSpZzzzEGLnFQFxck9Gs57-s-ClWQbwTXUIDcbtmoVY3eG28fISvvLYu2H0Ix3zYudDOqaeoZW9T8ulLu8UDnv6QBFfx8qdKx_9cKqEdzjyiWyJ8Ta6JdbEVLiXeSSv2AjpDQBbttNrrDVr4UYZW-J26wX18UrwIXLVR-8Kze0Co1uDYSf4ty7hJ3NbSafsujDNLx4i8xJFprRzXAZGmfjloC9TOsSgKJkcyMnAISLUQZR05sOcrEimTXcsmaGjykh-j05ifeKFPxNYYr_DXVdo0PkfqHoM8KnqVEFV85LelPJJMUlYHre-FO7A416WdYF2QmwcggA1bouufP-mIVmuFAUKeGLdevIw8ZnDb9KmRL03wQPeoIhA1atABp27YBB4i-BHzF8MQkrp9CK6tGFkuBiK41z4JEKPgL_j6lQZ0delBfTGFDHfCNWLNg0l-yYkwn8s2D6JOUQE9IR1Z2UEFxmBX3cfEfcu7LVLGoaiuZ0kaS8_RHSLbCVGuccUKnWDCB63iasqFvcHcc31_rrGLHR05Q=w526-h155-no" alt="Two Reduce Tasks"></p>
<h4 id="MapReduce-Examples"><a href="#MapReduce-Examples" class="headerlink" title="MapReduce Examples"></a>MapReduce Examples</h4><p>Distributed Grep</p>
<ul>
<li>Input: large set of files</li>
<li>Output: lines that match pattern</li>
<li>Map: Emits a line if it matches the supplied pattern</li>
<li>Reduce: Copies the intermediate data to output</li>
</ul>
<p>Reverse Web-Link Graph</p>
<ul>
<li>Input: Web graph: tuples(a, b) where (page a -&gt; pageb)</li>
<li>Output: For each page list of pages that link to it</li>
<li>Map: process web log and for each input &lt;source, target&gt;, it outputs &lt;target, source&gt;</li>
<li>Reduce: emits &lt;target, list<source>&gt;</li>
</ul>
<p>Count of URL access frequency</p>
<ul>
<li>Input: Log of accessed URLs, e.g., from proxy server</li>
<li>Output: For each URL, % of total accesses for that URL</li>
<li>Map: Process web log and outputs &lt;URL, 1&gt;</li>
<li>Multiple Reducers : Emits [URL, URL_count]<br>(So far, like Wordcount. But still need %)</li>
<li>Chain another MapReduce job after above one</li>
<li>Map: Process &lt;URL, URL_count&gt; and outputs &lt;1, (&lt;URL, URL_count&gt;)&gt;</li>
<li>1 Reducer: Sums up URL_count’s to calculate overall_count.<ul>
<li>Emits multiple &lt;URL, URL_count/overall_count&gt;</li>
</ul>
</li>
</ul>
<p>Sort<br>Map task’s output is sorted (e.g., quicksort)<br>Reduce task’s input is sorted (e.g., mergesort)</p>
<ul>
<li>Input: Series of (key, value) pairs</li>
<li>Output: Sorted <value>s</li>
<li>Map: &lt;key, value&gt; -&gt; &lt;value, _&gt; (identity)</li>
<li>Reducer: &lt;key, value&gt; -&gt; &lt;key, value&gt; (identity)</li>
<li>Partitioning function - partition keys across reducers based on ranges<ul>
<li>Take data distribution into account to balance reducer tasks</li>
</ul>
</li>
</ul>
<h4 id="MapReduce-Scheduling"><a href="#MapReduce-Scheduling" class="headerlink" title="MapReduce Scheduling"></a>MapReduce Scheduling</h4><p>Externally: For user</p>
<ul>
<li>Write a Map program (short), write a Reduce program(short)</li>
<li>Submit job, wait for result</li>
<li>Need to know nothing about parallel/distributed programming!</li>
</ul>
<p>Internally: For the Paradigm and Scheduler</p>
<ul>
<li>Parallelize Map</li>
<li>Transfer data from Map to Reduce</li>
<li>Parallelize Reduce</li>
<li>Implement Storage for Map input, Map output, Reduce input, and Reduce output</li>
</ul>
<p>(Ensure that no Reduce starts before all Maps are finished. That is, ensure the <strong><em>barrier</em></strong> between the Map phase and Reduce phase)</p>
<p>For the cloud:</p>
<ul>
<li>Parallelize Map: easy! each map task is independent of the other!<ul>
<li>All Map output records with same key assigned to same Reduce</li>
</ul>
</li>
<li>Transfer data from Map to Reduce<ul>
<li>All Map output records with same key assigned to same Reduce task</li>
<li>Use partitioning function, e.g., hash(key) % number of reducers</li>
</ul>
</li>
<li>Parallelize Reduce: easy! each reduce task is independent of the other!</li>
<li>Implement Storage for Map input, Map output, Reduce input, and Reduce output.<ul>
<li>Map input: from distributed file system</li>
<li>Map output: to local disk (at Map node); uses local file system</li>
<li>Reduce input: from (multiple) remote disks; uses local file systems</li>
<li>Reduce output: to distributed file system</li>
</ul>
</li>
</ul>
<ul>
<li>local file system = Linux FS, etc.</li>
<li>distributed file system = GFS (Google File System), HDFS (Hadoop Distributed File System)</li>
</ul>
<p>The YARN Scheduler</p>
<ul>
<li>Used in Hadoop 2.x +</li>
<li>YARN = Yet Another Resource Negotiator</li>
<li>Treats each server as a collection of <em>containers</em><ul>
<li>Container = some CPU + some memory</li>
</ul>
</li>
<li>Has 3 main components<ul>
<li>Global Resource Manager (RM)<ul>
<li>Scheduling</li>
</ul>
</li>
<li>Pre-server Node Manager(NM)<ul>
<li>Daemon and server-specific functions</li>
</ul>
</li>
<li>Per-application (job) Application Master (AM)<ul>
<li>Container negotiation with RM and NMs</li>
<li>Detecting task failures of that job</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://lh3.googleusercontent.com/_ggVQZTdJbYM9gypXn9lHrTL8ZuPSZc0m8XYAlwrZjwWzXjwXw3A2cfV11Zd3bFFHukHOyb2smo48yF6GLUBMB0O8FBIjJhvK4ewck6JXqj4t-7YtNPDwvYIygzwk_disv1n_cG0P-W8BmIk7Tl0R0nzrM6noBYVzV35P5MQ1LV_Wrml1ZUGnCWjs2Q0j-AZDSDEAGqEJMqj5jBQ8oQH0g0pdZGtZ_HrIt4zUxiUIwAJa4Hy2j78zydM_e6WB3bELNWwmYlU2EXqMPRaWz8luLejzmXoDB2wOFuTZD0M3-fgdMijGeHXBQWAc61oA1YlquU4ZHGruG9BLSRwYvdAufhJ0_x6BjTpsMcikGQGpUO8keVgGoEfxC6AssRIEp4wwEaqWTWk-OqKLuvuXzSXx4nhHMPYGYPHbR7WNtuY6ouEdBUWjOkD7h4xXJUVamO0tdCPhxdqgZOBIxsqPpEeqdoRE9N10_wx_7P3m8iSO3I7NK0od5IhYYrbUOOdsslQsZrDoWgB2se_cZywbKH6_UhOsb4EZKTxPOalb9l5AD0S3-9cs5wdR-i6trIRgbwWnIjU2MNFXcl4UBvd13bvkfvGMZk2aduRwmJJAnZk9gxNUgLSnA4vsN_9yreclNl8Ur2rp9XfqKEz7PkUX7I33LpVKd3de3FuD9p9ZbMNzg=w1237-h765-no" alt="How a Job Gets a Container"></p>
<h4 id="MapReduce-Fault-Tolerance"><a href="#MapReduce-Fault-Tolerance" class="headerlink" title="MapReduce Fault-Tolerance"></a>MapReduce Fault-Tolerance</h4><p>Fault Tolerance</p>
<ul>
<li>Server Failure<ul>
<li>NM heartbeats to RM<ul>
<li>If server fails, RM lets all affected Ams know, and Ams take action.</li>
</ul>
</li>
<li>NM keeps track of each task running at its server<ul>
<li>If task fails while in-progress, mark the task as idle and restart it</li>
</ul>
</li>
<li>AM heartbeats to RM<ul>
<li>On failure, RM restarts AM, which then syncs up with its running tasks</li>
</ul>
</li>
</ul>
</li>
<li>RM Failure<ul>
<li>Use old checkpoints and bring up secondary RM</li>
</ul>
</li>
<li>Heartbeats also used to piggyback container requests</li>
</ul>
<p>Stragglers (slow nodes)</p>
<ul>
<li>The slowest machine slows the entire job down (why?)</li>
<li>Due to Bad Disk, Network Bandwidth, CPU, or Memory</li>
<li>Keep track of “progress” of each task (%done)</li>
<li>Perform backup (replicated) execution of straggler task: task considered done when first replica completed. Called <code>Speculative Execution</code>.</li>
</ul>
<p>Locality</p>
<ul>
<li>Since cloud has hierarchical topology (e.g., racks)</li>
<li>GFS/HDFS stores 3 replicas of each of chins (e.g., 64 MB in size)<ul>
<li>Maybe on different racks, e.g., 2 on a rack, 1 on a different rack</li>
<li>Mapreduce attempts to schedule a map task on<ul>
<li>a machine that contains a replica of corresponding input data, or failing that.</li>
<li>on the same rack as a machine containing the input, or failing that.</li>
<li>Anywhere</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Summary</p>
<ul>
<li>Mapreduce uses parallelization + aggregation to schedule applications across clusters</li>
<li>Need to deal with failure</li>
<li>Plenty of ongoing research work in scheduling and fault-tolerance for Mapreduce and Hadoop</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2017/02/18/%E8%87%AA%E6%88%91%E6%88%90%E9%95%BF%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/18/%E8%87%AA%E6%88%91%E6%88%90%E9%95%BF%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F/" class="post-title-link" itemprop="url">自我成长的正确打开方式</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-18 15:36:07" itemprop="dateCreated datePublished" datetime="2017-02-18T15:36:07-08:00">2017-02-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-03-23 16:48:06" itemprop="dateModified" datetime="2017-03-23T16:48:06-07:00">2017-03-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近看了Susan Kuang的新书，还有渡边淳一的《钝感力》，感觉在对待自我成长上有了更深刻的认识，于是有了这篇文章，一方面是总结在书中所得到的领悟，另一方面这本身也是一个小小的自我成长过程。</p>
<h3 id="不快乐的事实"><a href="#不快乐的事实" class="headerlink" title="不快乐的事实"></a>不快乐的事实</h3><p>中国一直有句古话，叫作“吃得苦中苦，方为人上人。” 也就是说要实现凌驾于他人之上的人生目标，就得依靠比他人经历更多的痛苦来获得。不难注意到，这里无论是努力的过程还是最终要实现的结果，其实都是建立在与他人的对比之下。</p>
<p>从小时候开始，我们就开始被拿来和“别人家的孩子”做比较，到了中学，更是开始了拼分数、拼排名，进了大学，进而拼绩点、拼实习，开始工作后，又开始拼薪水、拼职位。当我们追求不再是优秀，而是比别人优秀时，我们开始习惯性地与他人攀比，并依赖外部环境的反馈作为自我评判的标准。这一定程度上激励了人们去努力奋斗，但同时也会让人过于在意外界的看法，引起一些消极的后果。</p>
<p>以我自己为例，在上大学之前一直是处于一个只要正常努力基本就能名列前茅的状态。结果刚进大学时，面对来自全国各地的优秀学生，突然间发现自己好像再怎么努力也无法做到出类拔萃，于是乎自信心受到打击，并且经常性地产生焦虑和自卑的负面情绪，总是觉得自己不够好，害怕失败以及别人异样的眼光。由于这样心态的存在，反而更加抑制了进步和成长的空间，如果不及时调整，很可能会陷入恶性循环。</p>
<p>这样的经历也许听起来并不陌生，不少人一定都会有类似的经历，那我们应该如何面对这样的问题呢？</p>
<h3 id="罪魁祸首"><a href="#罪魁祸首" class="headerlink" title="罪魁祸首"></a>罪魁祸首</h3><p>1967年，美国心理学家马丁·赛里格曼（Martin Seligman）在研究动物时，用狗做了一项经典实验。实验是这样的：把一条狗关在笼子里，只要蜂鸣器一响，就对狗施以难以承受的电击。狗因为躲避不了，于是就在笼子里狂奔，惊恐地哀嚎。多次实现之后，当蜂鸣器再次响起时，狗便不再狂奔或者寻找逃避机会了，而只是趴在地上无奈地哀叫。即便在实验的最后，实验者在电击前把笼门打开，狗也不选择逃跑，而是没等电击出现，就倒地呻吟和颤抖。</p>
<p>通过这个实验，马丁·赛里格曼提出了一个著名的心理学概念叫做习得性无助。习得性无助是指，在先前的经历中，发现自己努力了很久，却始终不能达到预期效果，于是便获得了一种“自己的行为无法改变结果”的感受，并因此变得消极被动，形成了一种对现实无望和无可奈何的心理状态，即使置身于可自主的新环境中，也不再选择尝试。</p>
<p>习得性无助很好地结识了包括过去的我在内的很多人的心理状态和行为模式。我们对于自我的认知很大程度上取决于外在世界给我们的反馈，当一个人获得的大部分反馈都是负面和消极的时，他也更容易变得被动消极，因此获得成就的可能性就会越低，这又会进一步强化了他的“我不行”的信念。</p>
<p>因此，对于我们个人来说，要想实现自我突破，获得自己想要的人生，我们就必须除掉那个限制我们的“罪魁祸首”，也就是我们消极被动的心态。</p>
<h3 id="根治之道：-钝感力"><a href="#根治之道：-钝感力" class="headerlink" title="根治之道： 钝感力"></a>根治之道： 钝感力</h3><p>日本作家渡边淳一写过一本书叫做《钝感力》(The Power of Insensitivity)，书里有这样一个例子。</p>
<p>有一个暂且可以成为小K的白领，在公司里既谈不上优秀，也不算差，属于表现平平的职员，又一次因为一时疏忽，他在工作上出了个差错。更倒霉的是刚好又碰上上司心情不爽，于是小K在众人面前被上司恨恨地责骂了一顿。当时在场的同事都对上司的怒骂感到非常震惊，他们十分同情小K，都觉得刚才那顿臭骂有些太过火了。甚至有人担心说，小K会不会情绪低落，明天不再来上班了。<br>可是和同事们的预料正好相反，第二天早上，小K和往常一样，按时出现在大家的面前，并且满面笑容地向众人道早安。似乎昨天挨骂的事他已经忘得一干二净了。此时此景，使同事们都觉得白白替他担心了一场。</p>
<p>往好处讲，被上司如此劈头盖脸臭骂一顿，小K却毫发无损，依然精神抖擞，他可以算得上内心强大的典型了。但话又说回来了，上司那么严厉的斥责，对小K都毫不起作用，他也真称得上是个“迟钝的家伙”，这也就是渡边淳一先生所认为的钝感力。</p>
<p>与小K相比，另一个白领小N,在同样被上司怒骂了一顿之后，他却不能像小K那样迅速改换心情，回到家之后，仍然没完没了地沉浸在个人的烦恼和思虑之中，不断自责甚至钻牛角尖。第二天，小N也许就不去上班了。接下来，他一直摆脱不了这件事的阴影，一而再，再而三地休息，这样拖延下去的结果，恐怕最后就会辞职。</p>
<p>把顿感的小K和敏感的小N放在一起对比，占绝对优势、值得信赖的还是钝感的一方。今后无论发生什么事情，若是小K的话，他都可以十分顽强地闯过难关，说不定将来还会成为公司的骨干。可是敏感的小N，在以后的生活中，就会连接不断地遇到挫折，他的朋友们也将渐渐地和疏远起来。</p>
<p>“钝感力”作为一种为人处世的态度及人生智慧，相比敏感和玻璃心而言，更容易在竞争激烈的现代社会中免遭习得性无助的困扰，因而也更容易取得成功，并同时求得自身内心的平衡及与他人和社会的和谐相处。</p>
<h3 id="两种思维模式"><a href="#两种思维模式" class="headerlink" title="两种思维模式"></a>两种思维模式</h3><p>斯坦福大学的心理学教授卡罗尔·德韦克（Carol Deck）在她的 《Mindset: The New Psychology of Success》（中文译本名：看见成长的自己）中，阐述了在人们的成长道路上相互对立的两种思维模式：僵固型思维模式（Fixed Mindset）和成长型思维模式（Growth Mindset）。</p>
<p>僵固型思维者的特点是，他们认为聪明才智是一个人固定不变的特质，因此他们永远处于一个要“证明自己”而非“发展自己”的心态中。僵固型思维者会过于在意别人的评价，为了获得赞扬和认可，他们会努力掩饰自己的缺陷和不足，并总是通过回避挑战来避免失败，以此维持自信。于此同时，若他们一旦觉得不如他人时，便可能会深深陷入自我怀疑和否定的消极情绪。</p>
<p>成长型思维者则恰恰相反，他们认为能力是通过学习不断发展而来的，因此他们的关注点不在于“证明自己”，而在于“发展自己”，他们不会因为失败或者负面评价而开始自我怀疑和否定，而总是勇敢、大方地承认自己的无知、不足和不完美，并且把它们看作自我提升的机会。即使面对自己不擅长的事情，他们也能全身心地投入和坚持，不会为了获得鲜花和掌声而有所遮掩，更不会把当前的不足与自我价值等同起来。因为他们相信人的能力是动态发展的，并且享受成长带来的快乐。</p>
<p>显而易见，成长型思维很好地突破了个人和周围环境带来的各种限制，可以让我们在不断挑战舒适区的过程中获得持续性自我成长。但不幸的是，社会上僵固型思维者的数量远远多于成长型思维者。这一方面可能与人的本能有关，但另一方面，现有的过于注重结果而非过程的教育体制和文化氛围毫无疑问进一步强化了人们的僵固型思维。因此，我们需要通过后天的不断努力来习得成长性思维。</p>
<h3 id="什么才是正确的奋斗目标？"><a href="#什么才是正确的奋斗目标？" class="headerlink" title="什么才是正确的奋斗目标？"></a>什么才是正确的奋斗目标？</h3><p>尽管那些急功近利的所谓成功学已经被诟病多年，但类似这样的标题，我们应该都不会陌生：《如何快速成为文案高手》、《21天学会手绘》、《一天看完20本书是怎样的体验》、《从月薪三千到月薪三万》、《普通人如何利用碎片化时间学5门语言还出一本书》。这类文章在我们的日常生活中比比皆是，虽然没有赤裸裸的用名利作为诱惑，也没有标榜哪个知名的成功人士，但其本质和成功学并没有什么区别，核心特点都是通过急功近利式的模仿，以迅速达到某个目标。尽管这些目标看上去和名利没有太大关系，实则不然，他们要么与金钱挂钩，要么通过给人一种与众不同和超越平凡人的感觉是虚荣心得到极大满足，有时甚至还能引来他人的追捧。</p>
<p>成功学背后有两个重要假设：第一，成功可以复制；第二，只要努力就能成功。它的逻辑是这样的：有人成功了，那么我按照他总结出来的成功方法，就一定能够成功。而事实上，很多成功的故事里其实包含了一种叫做“幸存者偏差”的现象，由于日常生活中更容易看到成功的案例，而不是失败的案例，你就会因此大大高估了成功的希望，我们看到的那些所谓的创业成功故事都是被筛选和过滤后的，并不能反映真实的世界，然而真实的情况是，它的成功概率非常小。正如薛蛮子曾经所说的那样：“创业失败是必然的，成功才是偶然的。”</p>
<p>这个世界上存在着由客观规律决定的必然，但也存在着大量的偶然，正是这些偶然使得整个世界充满了不确定性，也让未来变得不可预知。那些幸运的成功者们很难意识到自己的成功可能只不过是一种概率现象，即使知道，他们也不会把成功归结于运气。而对于普通人来说，迷恋于成功学不仅容易让人因错估成功概率而变得盲目自信，更会因为这种错觉而让人变得急功近利。</p>
<p>哈佛积极心理学教授泰勒·本-沙在他的《幸福的方法》一书中就详细解释了这一点。他在书中指出人重点在于要拥有目标，而能否实现则在其次。目标能够给我们以方向感，不至于在人生的路途中感到迷失，并且不要把关注点放在当下，目标是意义而不是结局。心理学家大卫·沃森在他的积极情感作用的研究中，也强调只有追求目标，而不是达到目标，才是带来幸福和积极情感的要素。</p>
<p>因此，在选择目标时，以自我成长为主的内在目标会给人带来更多的幸福感和意义感，如果你的目标仅仅是要得到年薪100万元，或者每年读100本书，每天写1000个字，然后出一本书，那么它们给你带来的可能是更多的焦虑和难以熄灭的欲望，而非幸福；但如果你可以把这些外在的目标转化成内在的目标，例如让自己的能力达到年薪100万元的程度，通过读书来增长自己的知识和智慧，或者通过写文字和出书来分享自己的思想与价值观，那么它们便能让你在追求目标的过程中享受成长的快乐。</p>
<p>周国平在他的一次演讲中提到，年轻人在为自己设立人生目标时，应该把优秀当成第一目标，成功最多只是第二目标。他认为优秀是我们自己能够把握的，因此可以通过努力获得，而成功取决于很多外部因素。一个明智和理性的人应该把经理放在那些自己可以控制的事情上、那些真正可以给我们带来幸福的目标上。</p>
<h3 id="自我提升永远不晚"><a href="#自我提升永远不晚" class="headerlink" title="自我提升永远不晚"></a>自我提升永远不晚</h3><p>关于自我提升，我们总是会听到这样的疑问：“从现在才开始是不是已经晚了？” 实际上，这是一个毫无意义的问题，因为无论答案是什么，我们面临的选择都只有两种：开始提升和不提升。诚然，提早开始也许更好，但我们没有办法回到过去，我们拥有的只是现在，如果现在开始改变，那么不久的将来我们很可能会获得回报，生活或许也会变得因此不同，但如果不开始自我提升，那么我们就永远在原地踏步。因此，自我提升永远都不晚，关键在于行动和持之以恒的积累。</p>
<p>台湾有一位全民级偶像叫赵慕鹤，66岁退休，本到了安享晚年的时候，而他却开启了全新的逆生长模式。75岁那年决定出去走走，在不会外语，存款可怜的情况下独自穷游欧洲，86岁那年和孙子一起考大学，首年落榜，次年再战考上空中大学文化系。在91岁那年成为全班第一个顺利毕业的学生。 几年后，为了鼓励年轻人学习，96岁的赵慕鹤又来劲了，冲刺三个月顺利考上南华大学哲学所，两年后以一篇关于中国书法“鸟虫体”研究的论文获得硕士学位，并也因此创下了吉尼斯世界纪录，成为世界上年龄最大的研究生。而如今105岁的他正准备再报个博士班。年龄，对他来说从来就只是一个数字，因为从来不把“老”当回事儿，这位老先生做出了很多同龄人都不敢想，甚至让年轻人都自叹不如的事情。</p>
<p>我们还那么年轻，怎么可能太晚了呢？</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2049855-418028387b87bbad.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自我成长的正确打开方式.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/12/17/soft-abilities-reading-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/17/soft-abilities-reading-notes/" class="post-title-link" itemprop="url">《软技能：代码之外的生存指南》读书笔记</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-17 14:54:38" itemprop="dateCreated datePublished" datetime="2016-12-17T14:54:38-08:00">2016-12-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-03-12 15:15:56" itemprop="dateModified" datetime="2017-03-12T15:15:56-07:00">2017-03-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/readings/" itemprop="url" rel="index"><span itemprop="name">readings</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>对于优秀的软件开发者来说，埋头写代码绝并不应该是工作的全部。这本书给出了很多非常好的建议，不仅仅“码农”们可以从中获益，还可以推而广之到很多其他的行业。</p>
<h3 id="I-职业"><a href="#I-职业" class="headerlink" title="I. 职业"></a>I. 职业</h3><h4 id="人际交往能力：远比你想象的重要"><a href="#人际交往能力：远比你想象的重要" class="headerlink" title="人际交往能力：远比你想象的重要"></a>人际交往能力：远比你想象的重要</h4><ul>
<li>如果你还是觉得自己的工作就是写写代码，那你最好要三思。作为一个软件开发人员，你的工作就是与人打交道（其实几乎所有的职业都是这样）。</li>
<li>如何学会与人打交道？<ul>
<li>每个人都希望感到自己很重要；</li>
<li>永远不要批评，用表扬代替批评</li>
<li>换位思考</li>
<li>避免争吵</li>
</ul>
</li>
</ul>
<h4 id="破解面试之道"><a href="#破解面试之道" class="headerlink" title="破解面试之道"></a>破解面试之道</h4><ul>
<li>通过面试的最快捷的方式是让面试官对你怀有好感，达成该目标有很多方法，其中大多数可以在面试之前完成。如了解面试官，之前就想办法和公司的人建立联系，如有自己的知名品牌/博客等。</li>
<li>别忘了时间，即便你现在对换新工作毫无兴趣，为了获得面试经验，你也要去面试。练习得越多，你在真正面试时也就越游刃有余。</li>
</ul>
<h4 id="职业选择"><a href="#职业选择" class="headerlink" title="职业选择"></a>职业选择</h4><ul>
<li><p>雇员：</p>
<ul>
<li>Pros: 稳定，从业之路比较轻松，带薪假期。</li>
<li>Cons: 缺少自由，收入封顶。</li>
</ul>
</li>
<li><p>独立咨询师</p>
<ul>
<li>Pros: 更大的自由度，可以持续做新项目， 赚钱潜力。</li>
<li>Cons: 但需要自己寻找业务，打理一切事物的开销，从“为一个老板服务”变成了“为许多老板服务”。</li>
</ul>
</li>
<li><p>创业者：</p>
<ul>
<li>Pros: 完全自由，巨大赚钱能力，做你想要的工作，没有老板</li>
<li>Cons: 风险很大，完全依靠自己，需要很多技能，可能需要长时间工作</li>
</ul>
</li>
<li><p>进化之路：雇员（学徒思维） –&gt; 独立咨询师/创业者</p>
</li>
</ul>
<h4 id="专业VS通才"><a href="#专业VS通才" class="headerlink" title="专业VS通才"></a>专业VS通才</h4><ul>
<li>在一个专业方向上拥有专长尽管选择面窄了，但其实往往更容易获得极好的机会。</li>
<li>走“专业化”道路与具备广泛的技能并不矛盾。</li>
</ul>
<h4 id="请勿陷入对技术的狂热中"><a href="#请勿陷入对技术的狂热中" class="headerlink" title="请勿陷入对技术的狂热中"></a>请勿陷入对技术的狂热中</h4><p>不拘一格是要点所在，没有理由去强烈坚持自己选择的技术就是最好的，而轻视甚至无视其他技术。保持开放的心态，你会发现更多机会为你敞开大门。</p>
<h3 id="II-自我营销"><a href="#II-自我营销" class="headerlink" title="II. 自我营销"></a>II. 自我营销</h3><h4 id="创建大获成功的博客"><a href="#创建大获成功的博客" class="headerlink" title="创建大获成功的博客"></a>创建大获成功的博客</h4><ul>
<li>打造成功博客的最大秘诀有且仅有一个: <strong>持之以恒</strong></li>
<li>如果每天写一篇博客且坚持好几年，想不成功都难。</li>
<li>强烈建议至少以每周一篇的速度更新博客。</li>
<li>除了持之以恒之外还应该确保你写的都是高质量内容。</li>
<li>别担心，不需要一开始就追求完美，起步的时候可能会很糟糕，但随着不断尝试贡献出优秀的内容（不是将自己脑子里的东西随意丢到网页上，不考虑格式和结构，且还有一大堆拼写错误），你的博客品质会越来越高。</li>
</ul>
<h4 id="博客写什么的终极问题？"><a href="#博客写什么的终极问题？" class="headerlink" title="博客写什么的终极问题？"></a>博客写什么的终极问题？</h4><ul>
<li>解决这个问题的最好办法是提前头脑风暴出各种不同的想法，随时更新可能的博客主题的清单，这样你总是保持一堆话题可供选择。</li>
<li>同时，不要太担心文笔如何，不要太在意别人的想法。有时候你只是要写一篇博客让自己的博客有内容，仅此而已。</li>
</ul>
<h4 id="核心目标：为他人提供价值"><a href="#核心目标：为他人提供价值" class="headerlink" title="核心目标：为他人提供价值"></a>核心目标：为他人提供价值</h4><ul>
<li>“如果你能帮助足够多的人们得到他们想要的东西，你就会得到自己想要的东西。”</li>
<li>如果你表达的和传递的信息不能帮到其他人，那么每个人都将会无视你。</li>
<li>把你的工作成果的90%都做成免费的，当你免费给人们提供实际价值时，回报更大。</li>
</ul>
<h4 id="善于运用社交媒体"><a href="#善于运用社交媒体" class="headerlink" title="善于运用社交媒体"></a>善于运用社交媒体</h4><ul>
<li>聚焦于构建稳定的受众群体，并逐步提升活跃度。</li>
<li>持续不断地在自己的社交媒体上给别人分享和提供有价值的内容，那你必定会赢得尊重和声誉。</li>
<li>使用诸如Buffer的社交媒体管理工具高效管理所有社交账号。</li>
</ul>
<h4 id="演讲，报告和培训"><a href="#演讲，报告和培训" class="headerlink" title="演讲，报告和培训"></a>演讲，报告和培训</h4><ul>
<li>公司内的机会</li>
<li>Code Camp/Meet up等相关团体的主题分享</li>
<li>进阶：开发者大会，做培训， YouTube, Udemy等</li>
</ul>
<h4 id="著书立说，吸引追随者"><a href="#著书立说，吸引追随者" class="headerlink" title="著书立说，吸引追随者"></a>著书立说，吸引追随者</h4><p>在有了足够的基础之后的进一步追求。一个人通过写书可以收获极大的信赖，如果你也想被看做业界值得信赖的人，你也应该写本书。</p>
<h4 id="百折不挠，越挫越勇"><a href="#百折不挠，越挫越勇" class="headerlink" title="百折不挠，越挫越勇"></a>百折不挠，越挫越勇</h4><p>收起自己脆弱的自尊心，勇敢走出去，你必须学会如何无惧自己被别人看做傻瓜，别害怕让自己出丑。</p>
<h3 id="III-学习"><a href="#III-学习" class="headerlink" title="III. 学习"></a>III. 学习</h3><p>如果你想学习一些东西，最好的方法就是付诸于实践。</p>
<h4 id="十步学习法"><a href="#十步学习法" class="headerlink" title="十步学习法"></a>十步学习法</h4><p><strong>1 ~ 6 是第一模块，只需做一次</strong></p>
<ol>
<li>了解全局： 这样你才能弄清自己到底要学什么，找出最好的学习方式。</li>
<li>确定范围： 将宏大主题缩小并聚焦到一个特定范围内，尽可能保持专注。</li>
<li>定义目标： 目标要具体化，比如可以利用C#语言的主要功能写出一个小的应用程序，我可以用HTML5 在网上为我自己创建一个主页，展示我的简历和我的代表工作。而不是”学习C#语言基础知识“，或者”知道如何使用HTML去构建一个网页“</li>
<li>寻找资源： 尝试收集到多种多样的资源帮助你学习，这在当下的互联网时代很容易做到。</li>
<li>创建学习计划： 比如可以参考在第4步中找来的图书的目录，循序渐进。</li>
<li>筛选资源： 浏览找到的全部资源，刷选出品质最高的。</li>
</ol>
<p><strong>7 ~ 10 是第二模块，需要循环往复</strong><br>7. 开始学习，浅尝辄止：既不要在知之不多的情况下就盲目开始，也不要在行动之前准备过多，行动太晚<br>8. 动手操作，边玩边学：无需了解全部内容，不用担心结果，勇敢探索吧！<br>9. 全面掌握，学以致用：在8的过程中积累了问题，再带着问题进一步深入理解主题。<br>10. 乐为人师，融会贯通：把知识交给别人，是唯一检验你确实掌握了知识的办法，同时也是查缺补漏的好方法。</p>
<h4 id="发现自己的知识短板"><a href="#发现自己的知识短板" class="headerlink" title="发现自己的知识短板"></a>发现自己的知识短板</h4><p>工作上遇到短板时，人会本能地倾向于掩饰自己的短板，而且我们又总是太忙，忙到无暇去填补他们，于是短板一直都在。长期下去往往导致为了掩饰短板我们反而花费了更多的时间和精力。<br>要学会及时找出自己的短板，并且刻意地通过努力消除短板。</p>
<h3 id="IV-生产力"><a href="#IV-生产力" class="headerlink" title="IV. 生产力"></a>IV. 生产力</h3><h4 id="一切始于专注"><a href="#一切始于专注" class="headerlink" title="一切始于专注"></a>一切始于专注</h4><p>缺乏专注，任务会被拖延很长一段时间。<br>在开始一项任务之前，确保你已经做好一切可以让自己免受干扰的措施，不管是内部干扰还是外部干扰。</p>
<h4 id="生产力提升计划"><a href="#生产力提升计划" class="headerlink" title="生产力提升计划"></a>生产力提升计划</h4><p>找到适合自己的方式制定季度计划，月计划，周计划和日计划，可以使用诸如Trello类似的软件。合理地安排休息和休假也是必不可少的。</p>
<h4 id="番茄工作法"><a href="#番茄工作法" class="headerlink" title="番茄工作法"></a>番茄工作法</h4><p>严格使用这一方法，高效地追踪自己一天内完成了多少个番茄钟，并未每天完成的番茄钟的数量设定目标，这样才能真正发挥番茄工作法的魔力。</p>
<h4 id="定额工作法"><a href="#定额工作法" class="headerlink" title="定额工作法"></a>定额工作法</h4><p>例如：</p>
<ul>
<li>每周跑步3次，</li>
<li>每周发布一篇博客，</li>
<li>每周完成50个番茄钟的工作。<br>一旦做出”承诺“，就必须不遗余力地完成自己设定的任务，除非身体丧失工作能力，否则没有任何情况可以阻止你去完成任务，这也是”定额工作法“的核心。</li>
</ul>
<h4 id="多任务并行"><a href="#多任务并行" class="headerlink" title="多任务并行"></a>多任务并行</h4><ul>
<li>为什么多任务并行一般都很糟糕？因为多任务并行时很容易打破专注力，而不在专注模式下时，很容易会拖延时间，结果反而降低了效率；</li>
<li>批量回复邮件，微信，短信，电话效率更高。</li>
<li>真正的多任务并行：将一项不费脑经的任务和需要精神专注才能完成的任务结合起来，如听着音乐打字，体育运动或开车时听Podcast。</li>
</ul>
<h4 id="时间是怎么被浪费掉的"><a href="#时间是怎么被浪费掉的" class="headerlink" title="时间是怎么被浪费掉的"></a>时间是怎么被浪费掉的</h4><ul>
<li>戒掉电视。</li>
<li>每天批量处理邮件和社交媒体活动。</li>
</ul>
<h4 id="分解任务：如何吃掉一头大象？"><a href="#分解任务：如何吃掉一头大象？" class="headerlink" title="分解任务：如何吃掉一头大象？"></a>分解任务：如何吃掉一头大象？</h4><ul>
<li>“要吃掉一头大象，每次吃一口。”</li>
<li>每个大型任务都可以分解成不计其数的更简单更小型的任务。比如写书时，无非就是把每篇拆分成很多小的章，每章也就1000 ~ 2000字。</li>
<li>同理，写一个大型的程序，无论多么庞大和复杂，都可以被分成一行行的代码，因此只要能写好单行代码，你就能写好任何应用程序。</li>
</ul>
<h4 id="努力工作的价值"><a href="#努力工作的价值" class="headerlink" title="努力工作的价值"></a>努力工作的价值</h4><p>如果真想富有成效，你就不得不学会工作的时候既聪明又努力。光有聪明是不够的，在所有的情况下，我们面对的现实就是，没有一件事情是轻而易举的，如果真想要成为成功人士，你就不得不在有些时候通宵达旦。 要想实现目标，要想发挥出自己的全部潜力，唯一的途径就是自愿咬紧牙关、硬着头皮、开始工作。</p>
<h4 id="任何行动都比不采取行动好"><a href="#任何行动都比不采取行动好" class="headerlink" title="任何行动都比不采取行动好"></a>任何行动都比不采取行动好</h4><p>还是那句话，”Done is better than perfect.“</p>
<h3 id="V-理财"><a href="#V-理财" class="headerlink" title="V. 理财"></a>V. 理财</h3><ul>
<li>要想在财务上获得成功，就必须学会如何投资，别无选择。</li>
<li>房地产市场是一个长期来说稳定且回报率较高的投资方向，值得好好研究。可以从较小的，低售价的公寓开始。</li>
<li>在同等收入的情况下，尽可能地减少开支，其实就相当于增加了收入。</li>
<li>在保证白天工作的同时尽可能地去寻找更多的实现被动收入的机会，早日实现更多的被动收入现金流。</li>
</ul>
<h3 id="VI-健身"><a href="#VI-健身" class="headerlink" title="VI. 健身"></a>VI. 健身</h3><h3 id="VII-精神"><a href="#VII-精神" class="headerlink" title="VII. 精神"></a>VII. 精神</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/10/09/reservoir-sampling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/10/09/reservoir-sampling/" class="post-title-link" itemprop="url">Data Structure & Algorithms Notes: Reservoir Sampling</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-10-09 00:34:55 / Modified: 00:37:39" itemprop="dateCreated datePublished" datetime="2016-10-09T00:34:55-07:00">2016-10-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在一个给定长度的数组中随机等概率抽取一个数据很容易，但如果面对的是长度未知的海量数据流呢？蓄水池采样(Reservoir Sampling)算法就是来解决这个问题的, 它在分析一些大数据集的时候非常有用。</p>
<h2 id="1-算法描述"><a href="#1-算法描述" class="headerlink" title="1. 算法描述"></a>1. 算法描述</h2><ol>
<li>先选取数据流中的前k个元素，保存在集合A中；</li>
<li>从第j（k + 1 &lt;= j &lt;= n）个元素开始，每次先以概率p = k/j选择是否让第j个元素留下。若j被选中，则从A中随机选择一个元素并用该元素j替换它；否则直接淘汰该元素；</li>
<li>重复步骤2直到结束，最后集合A中剩下的就是保证随机抽取的k个元素。</li>
</ol>
<h2 id="2-算法证明"><a href="#2-算法证明" class="headerlink" title="2. 算法证明"></a>2. 算法证明</h2><p>算法的证明可以参照: <a href="http://sobuhu.com/algorithm/2012/11/01/reservoir.html" target="_blank" rel="noopener">蓄水池抽样算法证明</a></p>
<h2 id="3-LeetCode例题"><a href="#3-LeetCode例题" class="headerlink" title="3. LeetCode例题"></a>3. LeetCode例题</h2><h3 id="3-1-Linked-List-Random-Node"><a href="#3-1-Linked-List-Random-Node" class="headerlink" title="3.1. Linked List Random Node"></a>3.1. Linked List Random Node</h3><p>Given a singly linked list, return a random node’s value from the linked list. Each node must have the same probability of being chosen.</p>
<p><strong>Follow up:</strong><br>What if the linked list is extremely large and its length is unknown to you? Could you solve this efficiently without using extra space?</p>
<p><strong>Example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Init a singly linked list [1,2,3].</span><br><span class="line">ListNode head &#x3D; new ListNode(1);</span><br><span class="line">head.next &#x3D; new ListNode(2);</span><br><span class="line">head.next.next &#x3D; new ListNode(3);</span><br><span class="line">Solution solution &#x3D; new Solution(head);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; getRandom() should return either 1, 2, or 3 randomly. Each element should have equal probability of returning.</span><br><span class="line">solution.getRandom();</span><br></pre></td></tr></table></figure>
<p>利用蓄水池采样原理，无需事先计算list长度即可求解，具体代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    Random r;</span><br><span class="line">    ListNode head;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Solution</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.r = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">this</span>.head = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRandom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">        ListNode nodeVal = head;</span><br><span class="line">        ListNode curr = head;</span><br><span class="line">        <span class="keyword">while</span> (curr != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r.nextInt(count++) == <span class="number">0</span>) &#123;</span><br><span class="line">                nodeVal = curr;</span><br><span class="line">            &#125;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nodeVal.val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-2-Random-Pick-Index"><a href="#3-2-Random-Pick-Index" class="headerlink" title="3.2. Random Pick Index"></a>3.2. Random Pick Index</h3><p>Given an array of integers with possible duplicates, randomly output the index of a given target number. You can assume that the given target number must exist in the array.</p>
<p><strong>Note:</strong><br>The array size can be very large. Solution that uses too much extra space will not pass the judge.</p>
<p><strong>Example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int[] nums &#x3D; new int[] &#123;1,2,3,3,3&#125;;</span><br><span class="line">Solution solution &#x3D; new Solution(nums);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; pick(3) should return either index 2, 3, or 4 randomly. Each index should have equal probability of returning.</span><br><span class="line">solution.pick(3);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; pick(1) should return 0. Since in the array only nums[0] is equal to 1.</span><br><span class="line">solution.pick(1);</span><br></pre></td></tr></table></figure>
<p>若采用常规算法，我们需要用HashMap把对应的数值及所处的位置一一关联，这样则违背了题目的空间限制。使用蓄水池采样则避免了这个问题。具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] nums;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Solution</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nums = nums;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pick</span><span class="params">(<span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] == target) &#123;</span><br><span class="line">                <span class="keyword">if</span> (random.nextInt(count++) == <span class="number">0</span>) &#123;</span><br><span class="line">                    index = i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/08/30/RxJavaIntro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/30/RxJavaIntro/" class="post-title-link" itemprop="url">RxJava极简入门</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-08-30 01:02:51 / Modified: 01:11:26" itemprop="dateCreated datePublished" datetime="2016-08-30T01:02:51-07:00">2016-08-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>RxJava是在Android开发者中非常热门的函数库。刚上手会感觉比较难理解，但一旦理解了它，你会感觉开启了一扇全新的大门。网上关于RxJava的文章很多，这里也只是略窥门径，对其有个最最基本的概念。</p>
<h3 id="1-RxJava是什么"><a href="#1-RxJava是什么" class="headerlink" title="1. RxJava是什么?"></a>1. RxJava是什么?</h3><p>先来看看别的开发者怎么说的：</p>
<blockquote>
<p>“RxJava is a library of code used to handle data using a push and pull mechanism. Just like a notification on your phone, some data will be pushed to a receiver of that data. It’s a different way to think about existing coding patterns you know.” </p>
</blockquote>
<p>RxJava官网上的定义:</p>
<blockquote>
<p>A library for composing asynchronous and event-based programs using observable sequences for the Java VM.</p>
</blockquote>
<h3 id="2-RxJava基本模型"><a href="#2-RxJava基本模型" class="headerlink" title="2. RxJava基本模型"></a>2. RxJava基本模型</h3><p>RxJava最核心的两个东西是Observables（被观察者，事件源）和Subscribers（观察者）。Observables发出一系列事件，Subscribers处理这些事件。这里的事件可以是任何你感兴趣的东西，如触摸事件，web接口调用返回的数据等等。<br>这里我们以一个简单的Todo List的app为例来解释RxJava的基本工作原理。<br>首先假设我们有一个todo list：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toDoList = &#123;<span class="string">"Sweep"</span>, <span class="string">"Mop"</span>, <span class="string">"Vacuum"</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>第一步先创建一个Observable: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(todoList)</span><br></pre></td></tr></table></figure>
<p>这里用了just方法创建了一个Observable，表示了Observable 每次会发(emit)出todoList中的一项。</p>
<p>接下来是subscribe Observer, 代码和注释如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Subscription s = Observable.just(todoList)</span><br><span class="line">.subscribe(<span class="keyword">new</span> Observer&lt;Todo&gt;() &#123; <span class="comment">//Type is the data type being emitted</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Todo t)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//onNext is called for each item emitted.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//onCompleted is called when the Observable has no more items to admit</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//onError is called if an error occurs.</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//It is important to note that onCompleted and onError are only ever called once.</span></span><br><span class="line">    <span class="comment">//And after they are called, onNext will not be called again.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>调用subscribe方法会返回一个Subscription的对象, 有了它我们可以在关闭app的时候unsubscribe, 比如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    s.unsubscribe();</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>以上就是RxJava的基本模型。</p>
<p>RxJava中包含了一些非常有用的类，可以使得在特定情况下代码写起来更简单。<br>比如说有时候我们并不需要onCompleted和onError的callback，只想知道Observable是否发出了item。这种情况下我们只需要在subscribe方法中传入一个Action1对象即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(todoList)</span><br><span class="line">.subscribe(<span class="keyword">new</span> Action1&lt;Todo&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Todo todo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Get called for each item emitted.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><ul>
<li><a href="https://github.com/ReactiveX/RxJava/wiki" target="_blank" rel="noopener">RxJava Home</a></li>
<li><a href="http://rxmarbles.com" target="_blank" rel="noopener">RxMarbles</a></li>
<li><a href="http://blog.danlew.net/2014/09/15/grokking-rxjava-part-1/" target="_blank" rel="noopener">Grokking RxJava, Part 1: The Basics</a></li>
<li><a href="http://blog.danlew.net/2014/09/22/grokking-rxjava-part-2/" target="_blank" rel="noopener">Grokking RxJava, Part 2: Operator, Operator</a></li>
<li><a href="http://blog.danlew.net/2014/09/30/grokking-rxjava-part-3/" target="_blank" rel="noopener">Grokking RxJava, Part 3: Reactive with Benefits</a></li>
<li><a href="http://blog.danlew.net/2014/10/08/grokking-rxjava-part-4/" target="_blank" rel="noopener">Grokking RxJava, Part 4: Reactive Android</a></li>
<li><a href="https://www.gitbook.com/book/asce1885/android-rd-senior-advanced/details" target="_blank" rel="noopener">更上一层楼－Android研发工程师高级进阶</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/08/25/androidThreads/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/25/androidThreads/" class="post-title-link" itemprop="url">Android中的Threads的实现</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-08-25 00:33:19 / Modified: 00:38:46" itemprop="dateCreated datePublished" datetime="2016-08-25T00:33:19-07:00">2016-08-25</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在Android想要创建后台任务时该怎么做呢？最简单粗暴的方法就是通过创建一个background thread来实现，这里我们以后台下载音乐为例。</p>
<p>首先建立一个Playlist的类，添加需要下载的曲目:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Playlist</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] songs = &#123;<span class="string">"He’s the Greatest Dancer"</span>, <span class="string">"Cut the Cake"</span>, <span class="string">"The Groove Line"</span>, <span class="string">"Stayin’ Alive"</span>, <span class="string">"Give Up the Funk"</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="1-通过Runnable实现"><a href="#1-通过Runnable实现" class="headerlink" title="1. 通过Runnable实现"></a>1. 通过Runnable实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mDownloadButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                downloadSong();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(runnable);</span><br><span class="line">        thread.setName(<span class="string">"DownloadThread"</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="2-通过继承Thread实现"><a href="#2-通过继承Thread实现" class="headerlink" title="2. 通过继承Thread实现"></a>2. 通过继承Thread实现</h3><p>首先创建一个DownloadThread如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        downloadSong();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再创建一个新的DownloadThread实例，调用start()方法即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mDownloadButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        DownloadThread thread = <span class="keyword">new</span> DownloadThread();</span><br><span class="line">        thread.setName(<span class="string">"DownloadThread"</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>通过以上两种形式，我们成功实现了在background thread下载歌曲。然而新的潜在问题是，若开始下载后Playlist中的曲目被误改，则很可能错误的曲目会被下载下来。那么如何避免这种情况呢？</p>
<h3 id="3-Handler-Looper和Message"><a href="#3-Handler-Looper和Message" class="headerlink" title="3. Handler, Looper和Message"></a>3. Handler, Looper和Message</h3><p>首先创建一个DownloadHandler类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">DownloadHandler</span> <span class="params">()</span> extends Handler </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        downloadSong(msg.obj.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downloadSong</span><span class="params">(String song)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis() + <span class="number">10</span> * <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">while</span> (System.currentTimeMillis() &lt; endTime) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Log.d(TAG, song + <span class="string">" downloaded!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其次修改DownloadThread中的run 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Looper;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> DownloadHandler mHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Looper.prepare();</span><br><span class="line">        mHandler = <span class="keyword">new</span> DownloadHandler();</span><br><span class="line">        Looper.loop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后在点击Button时把要下载的曲目通过Message的形式送到DownloadThread的handler中即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DownloadThread thread = <span class="keyword">new</span> DownloadThread();</span><br><span class="line">thread.setName(<span class="string">"DownloadThread"</span>);</span><br><span class="line">thread.start();</span><br><span class="line">mDownloadButton = (Button) findViewById(R.id.downloadButton);</span><br><span class="line">mDownloadButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String song : Playlist.songs) &#123;</span><br><span class="line">            Message message = Message.obtain();</span><br><span class="line">            message.obj = song;</span><br><span class="line">            thread.mHandler.sendMessage(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当app被关掉之后，我们创建的DownloadThread也就同时被kill了。但如果我们想要在app被关闭之还能在后台继续下载歌曲怎么办呢？这就要引入Android Service了，且看下回分解。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/08/15/androidTestSummary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/15/androidTestSummary/" class="post-title-link" itemprop="url">Android 测试专题笔记</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-15 00:11:49" itemprop="dateCreated datePublished" datetime="2016-08-15T00:11:49-07:00">2016-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-08-25 00:35:53" itemprop="dateModified" datetime="2016-08-25T00:35:53-07:00">2016-08-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>敢为常语谈何易，百炼工纯始自然。在软件开发中，完备的测试是防御软件缺陷的第一道也是最好的一道防线。</p>
<h2 id="1-Test-Types"><a href="#1-Test-Types" class="headerlink" title="1. Test Types"></a>1. Test Types</h2><h3 id="1-1-Based-on-Running-Platform"><a href="#1-1-Based-on-Running-Platform" class="headerlink" title="1.1. Based on Running Platform"></a>1.1. Based on Running Platform</h3><h4 id="1-1-1-Local-Unit-Tests"><a href="#1-1-1-Local-Unit-Tests" class="headerlink" title="1.1.1. Local Unit Tests"></a>1.1.1. Local Unit Tests</h4><p>Located at <code>module-name/src/test/java/</code><br>These tests run on the local JVM and do not have access to functional Android framework APIs.</p>
<h4 id="1-1-2-Instrumented-Tests"><a href="#1-1-2-Instrumented-Tests" class="headerlink" title="1.1.2. Instrumented Tests"></a>1.1.2. Instrumented Tests</h4><p>Located at <code>module-name/src/androidTest/java/</code><br>These are all tests that must run on an Android hardware device or an Android emulator.</p>
<ul>
<li><strong>Instrumented Unit Test:</strong> Build complex unit tests with Android dependencies that cannot be satisfied with mock objects.</li>
<li><strong>User Interface Tests:</strong> Create tests to verify that the user interface behaves correctly for user interactions within a single app or for interactions across multiple apps.</li>
<li><strong>App Component Integrations Test:</strong> Verify the behavior of components that users do not directly interact with, such as a Service or a Content Provider.</li>
</ul>
<h3 id="1-2-Based-on-Real-Testing-Types"><a href="#1-2-Based-on-Real-Testing-Types" class="headerlink" title="1.2. Based on Real Testing Types"></a>1.2. Based on Real Testing Types</h3><h4 id="1-2-1-Unit-Tests"><a href="#1-2-1-Unit-Tests" class="headerlink" title="1.2.1. Unit Tests"></a>1.2.1. Unit Tests</h4><ul>
<li><strong>Local Unit Tests:</strong>  Unit tests that run locally on the Java Virtual Machine (JVM). Use these tests to minimize execution time when your tests have no Android framework dependencies or when you can mock the Android framework dependencies.</li>
<li><strong>Instrumented Unit Tests:</strong> Unit tests that run on an Android device or emulator. These tests have access to Instrumentation information, such as the Context of the app you are testing. Use these tests when your tests have Android dependencies that mock objects cannot satisfy.</li>
</ul>
<h4 id="1-2-2-Integration-Tests"><a href="#1-2-2-Integration-Tests" class="headerlink" title="1.2.2. Integration Tests"></a>1.2.2. Integration Tests</h4><ul>
<li><strong>Components within your app only:</strong> This type of test verifies that the target app behaves as expected when a user performs a specific action or enters a specific input in its activities. Supported by <a href="https://developer.android.com/tools/testing-support-library/index.html#Espresso" target="_blank" rel="noopener">Espresso</a>.</li>
<li><strong>Cross-app Components:</strong> This type of test verifies the correct behavior of interactions between different user apps or between user apps and system apps. Supported by <a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#UIAutomator" target="_blank" rel="noopener">UI Automator</a>.</li>
</ul>
<h2 id="2-Set-Up-Testing-Environment"><a href="#2-Set-Up-Testing-Environment" class="headerlink" title="2. Set Up Testing Environment"></a>2. Set Up Testing Environment</h2><h3 id="2-1-Local-Unit-Tests"><a href="#2-1-Local-Unit-Tests" class="headerlink" title="2.1. Local Unit Tests"></a>2.1. Local Unit Tests</h3><p>In your app’s top-level <code>build.gradle</code> file, you need to specify theres libraries as dependencies:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    &#x2F;&#x2F; Required -- JUnit 4 framework</span><br><span class="line">    testCompile &#39;junit:junit:4.12&#39;</span><br><span class="line">    &#x2F;&#x2F; Optional -- Mockito framework</span><br><span class="line">    testCompile &#39;org.mockito:mockito-core:1.10.19&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Instrumented-Tests"><a href="#2-2-Instrumented-Tests" class="headerlink" title="2.2. Instrumented Tests"></a>2.2. Instrumented Tests</h3><p>In your app’s top-level build.gradle file, you need to specify these libraries as dependencies:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    androidTestCompile &#39;com.android.support:support-annotations:24.0.0&#39;</span><br><span class="line">    androidTestCompile &#39;com.android.support.test:runner:0.5&#39;</span><br><span class="line">    androidTestCompile &#39;com.android.support.test:rules:0.5&#39;</span><br><span class="line">    &#x2F;&#x2F; Optional -- Hamcrest library</span><br><span class="line">    androidTestCompile &#39;org.hamcrest:hamcrest-library:1.3&#39;</span><br><span class="line">    &#x2F;&#x2F; Optional -- UI testing with Espresso</span><br><span class="line">    androidTestCompile &#39;com.android.support.test.espresso:espresso-core:2.2.2&#39;</span><br><span class="line">    &#x2F;&#x2F; Optional -- UI testing with UI Automator</span><br><span class="line">    androidTestCompile &#39;com.android.support.test.uiautomator:uiautomator-v18:2.1.2&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To use JUnit 4 test classes, make sure to specify AndroidJUnitRunner as the default test instrumentation runner in your project by including the following setting in your app’s module-level build.gradle file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Create-Test-Casese"><a href="#3-Create-Test-Casese" class="headerlink" title="3. Create Test Casese"></a>3. Create Test Casese</h2><h3 id="3-1-Local-Unit-Test-Class"><a href="#3-1-Local-Unit-Test-Class" class="headerlink" title="3.1. Local Unit Test Class"></a>3.1. Local Unit Test Class</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import java.util.regex.Pattern;</span><br><span class="line">import static org.junit.Assert.assertFalse;</span><br><span class="line">import static org.junit.Assert.assertTrue;</span><br><span class="line"></span><br><span class="line">public class EmailValidatorTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void emailValidator_CorrectEmailSimple_ReturnsTrue() &#123;</span><br><span class="line">        assertThat(EmailValidator.isValidEmail(&quot;name@email.com&quot;), is(true));</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To test that components in your app return the expected results, use the junit.Assert methods to perform validation checks (or assertions) to compare the state of the component under test against some expected value. To make tests more readable, you can use Hamcrest matchers (such as the is() and equalTo() methods) to match the returned result against the expected result.</p>
<p><strong>Mock Android dependencies</strong><br>You can use a mocking framework to stub out external dependencies in your code, to easily test that your component interacts with a dependency in an expected way. By substituting Android dependencies with mock objects, you can isolate your unit test from the rest of the Android system while verifying that the correct methods in those dependencies are called. </p>
<p>The <a href="https://github.com/mockito/mockito" target="_blank" rel="noopener">Mockito</a> mocking framework for Java (version 1.9.5 and higher) offers compatibility with Android unit testing. With Mockito, you can configure mock objects to return some specific value when invoked.</p>
<p>Steps to add a mock object to your local unit test:</p>
<ol>
<li>Include the Mockito library dependency in your build.gradle file, as described in Section 2.1.</li>
<li>At the beginning of your unit test class definition, add the <code>@RunWith(MockitoJUnitRunner.class)</code> annotation. This annotation tells the Mockito test runner to validate that your usage of the framework is correct and simplifies the initialization of your mock objects.</li>
<li>To create a mock object for an Android dependency, add the <code>@Mock</code> annotation before the field declaration.</li>
<li>To stub the behavior of the dependency, you can specify a condition and return value when the condition is met by using the <code>when()</code> and <code>thenReturn()</code> methods.</li>
</ol>
<p><strong><em>Code Example:</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(MockitoJUnitRunner.class)</span><br><span class="line">public class UnitTestSample &#123;</span><br><span class="line"></span><br><span class="line">    private static final String FAKE_STRING &#x3D; &quot;HELLO WORLD&quot;;</span><br><span class="line"></span><br><span class="line">    @Mock</span><br><span class="line">    Context mMockContext;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void readStringFromContext_LocalizedString() &#123;</span><br><span class="line">        &#x2F;&#x2F; Given a mocked Context injected into the object under test...</span><br><span class="line">        when(mMockContext.getString(R.string.hello_word))</span><br><span class="line">                .thenReturn(FAKE_STRING);</span><br><span class="line">        ClassUnderTest myObjectUnderTest &#x3D; new ClassUnderTest(mMockContext);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; ...when the string is returned from the object under test...</span><br><span class="line">        String result &#x3D; myObjectUnderTest.getHelloWorldString();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; ...then the result should be the expected one.</span><br><span class="line">        assertThat(result, is(FAKE_STRING));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-Instrumented-Unit-Test-Class"><a href="#3-2-Instrumented-Unit-Test-Class" class="headerlink" title="3.2.  Instrumented Unit Test Class"></a>3.2.  Instrumented Unit Test Class</h3><p>To create an instrumented JUnit 4 test class, add the <code>@RunWith(AndroidJUnit4.class)</code> annotation at the beginning of your test class definition. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import android.os.Parcel;</span><br><span class="line">import android.support.test.runner.AndroidJUnit4;</span><br><span class="line">import android.util.Pair;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import java.util.List;</span><br><span class="line">import static org.hamcrest.Matchers.is;</span><br><span class="line">import static org.junit.Assert.assertThat;</span><br><span class="line"></span><br><span class="line">@RunWith(AndroidJUnit4.class)</span><br><span class="line">@SmallTest</span><br><span class="line">public class LogHistoryAndroidUnitTest &#123;</span><br><span class="line"></span><br><span class="line">    public static final String TEST_STRING &#x3D; &quot;This is a string&quot;;</span><br><span class="line">    public static final long TEST_LONG &#x3D; 12345678L;</span><br><span class="line">    private LogHistory mLogHistory;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void createLogHistory() &#123;</span><br><span class="line">        mLogHistory &#x3D; new LogHistory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void logHistory_ParcelableWriteRead() &#123;</span><br><span class="line">        &#x2F;&#x2F; Set up the Parcelable object to send and receive.</span><br><span class="line">        mLogHistory.addEntry(TEST_STRING, TEST_LONG);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Write the data.</span><br><span class="line">        Parcel parcel &#x3D; Parcel.obtain();</span><br><span class="line">        mLogHistory.writeToParcel(parcel, mLogHistory.describeContents());</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; After you&#39;re done with writing, you need to reset the parcel for reading.</span><br><span class="line">        parcel.setDataPosition(0);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Read the data.</span><br><span class="line">        LogHistory createdFromParcel &#x3D; LogHistory.CREATOR.createFromParcel(parcel);</span><br><span class="line">        List&lt;Pair&lt;String, Long&gt;&gt; createdFromParcelData &#x3D; createdFromParcel.getData();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Verify that the received data is correct.</span><br><span class="line">        assertThat(createdFromParcelData.size(), is(1));</span><br><span class="line">        assertThat(createdFromParcelData.get(0).first, is(TEST_STRING));</span><br><span class="line">        assertThat(createdFromParcelData.get(0).second, is(TEST_LONG));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-Create-an-Espresso-Test-Class"><a href="#3-3-Create-an-Espresso-Test-Class" class="headerlink" title="3.3.  Create an Espresso Test Class"></a>3.3.  Create an Espresso Test Class</h3><p>The following code snippet shows how your test class might invoke this basic workflow:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onView(withId(R.id.my_view))            &#x2F;&#x2F; withId(R.id.my_view) is a ViewMatcher</span><br><span class="line">        .perform(click())               &#x2F;&#x2F; click() is a ViewAction</span><br><span class="line">        .check(matches(isDisplayed())); &#x2F;&#x2F; matches(isDisplayed()) is a ViewAssertion</span><br></pre></td></tr></table></figure>
<h4 id="Using-Espresso-with-ActivityTestRule"><a href="#Using-Espresso-with-ActivityTestRule" class="headerlink" title="Using Espresso with ActivityTestRule"></a>Using Espresso with ActivityTestRule</h4><p>By using ActivityTestRule, the testing framework launches the activity under test before each test method annotated with @Test and before any method annotated with @Before. The framework handles shutting down the activity after the test finishes and all methods annotated with @After are run.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">@RunWith(AndroidJUnit4.class)</span><br><span class="line">@LargeTest</span><br><span class="line">public class ChangeTextBehaviorTest &#123;</span><br><span class="line">    public static final String STRING_TO_BE_TYPED &#x3D; &quot;Espresso&quot;;</span><br><span class="line">    @Rule</span><br><span class="line">    public ActivityTestRule&lt;MainActivity&gt; mActivityRule &#x3D; new ActivityTestRule&lt;&gt;(</span><br><span class="line">            MainActivity.class);</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void changeText_sameActivity() &#123;</span><br><span class="line">        &#x2F;&#x2F; Type text and then press the button.</span><br><span class="line">        onView(withId(R.id.editTextUserInput))</span><br><span class="line">                .perform(typeText(STRING_TO_BE_TYPED), closeSoftKeyboard());</span><br><span class="line">        onView(withId(R.id.changeTextBt)).perform(click());</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Check that the text was changed.</span><br><span class="line">        onView(withId(R.id.textToBeChanged)).check(matches(withText(STRING_TO_BE_TYPED)));</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-Create-an-UI-Automator-Test-Class"><a href="#3-4-Create-an-UI-Automator-Test-Class" class="headerlink" title="3.4. Create an UI Automator Test Class"></a>3.4. Create an UI Automator Test Class</h3><p>… …</p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><ul>
<li><a href="https://developer.android.com/training/testing/start/index.html" target="_blank" rel="noopener">Getting Started with Testing | Android Developers</a></li>
<li><a href="https://developer.android.com/training/testing/unit-testing/index.html" target="_blank" rel="noopener">Building Effective Unit Tests | Android Developers</a></li>
<li><a href="https://developer.android.com/training/testing/ui-testing/index.html" target="_blank" rel="noopener">Automating User Interface Tests | Android Developers</a></li>
<li><a href="https://www.youtube.com/playlist?list=PLWz5rJ2EKKc-6HWg_jyP0U1zrVLHn65b2" target="_blank" rel="noopener">Android Testing Patterns  - YouTube</a></li>
<li><a href="https://google.github.io/android-testing-support-library/docs/index.html" target="_blank" rel="noopener">Espresso Documentation</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/08/14/%E7%8F%8D%E6%83%9C%E5%BD%93%E4%B8%8B%EF%BC%8C%E8%8E%AB%E8%B4%9F%E9%9F%B6%E5%8D%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/14/%E7%8F%8D%E6%83%9C%E5%BD%93%E4%B8%8B%EF%BC%8C%E8%8E%AB%E8%B4%9F%E9%9F%B6%E5%8D%8E/" class="post-title-link" itemprop="url">珍惜当下，莫负韶华</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-08-14 00:53:24 / Modified: 00:56:36" itemprop="dateCreated datePublished" datetime="2016-08-14T00:53:24-07:00">2016-08-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>“魏延政，毕业于北大计算机系，前华为高管，2010年结婚，11年诊断出绝症，同时老婆怀孕，在与病魔对抗五年后，于2016年8月8日逝世，享年41岁。”</p>
<p>年轻时，总是觉得有大把的时间，可以肆意的挥霍，人生长路漫漫，终点那么遥不可及。</p>
<p>但你永远不知道在未来的某一个时间节点，一个不经意的命运转折就能瞬间摧毁你。</p>
<p>你以为的未来是岁月静好安享百年，可事实也许就是英年早逝红颜薄命。在游戏里大侠还可以重新来过，可在真实的世界里，你就直接Game Over 万劫不复。</p>
<p>生命太脆弱，可这也更显其弥足珍贵。</p>
<p>珍惜当下，莫负韶华。</p>
<p><img src="/content/images/2016/lifeIsABitch.jpg" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/07/30/Techmon-Go-Union-Find/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/30/Techmon-Go-Union-Find/" class="post-title-link" itemprop="url">Data Structure & Algorithms Notes: Union Find</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-07-30 13:37:32 / Modified: 14:23:56" itemprop="dateCreated datePublished" datetime="2016-07-30T13:37:32-07:00">2016-07-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-Union-Find-Definition"><a href="#1-Union-Find-Definition" class="headerlink" title="1. Union Find Definition"></a>1. Union Find Definition</h2><p>In computer science, a disjoint-set data structure, also called a union–find data structure or merge–find set, is a data structure that keeps track of a set of elements partitioned into a number of disjoint (nonoverlapping) subsets. It supports two useful operations:</p>
<ul>
<li>Find: Determine which subset a particular element is in. Find typically returns an item from this set that serves as its “representative”; by comparing the result of two Find operations, one can determine whether two elements are in the same subset.</li>
<li>Union: Join two subsets into a single subset.<br><img src="/content/images/2016/unionFindAbstractions.png" alt="Union Find Abstractions"></li>
</ul>
<p><img src="/content/images/2016/unionFindRepresentation.png" alt="Union Find Representation"></p>
<h2 id="2-Union-Find-Implementation"><a href="#2-Union-Find-Implementation" class="headerlink" title="2. Union Find Implementation"></a>2. Union Find Implementation</h2><h3 id="2-1-Quick-find-apporach"><a href="#2-1-Quick-find-apporach" class="headerlink" title="2. 1. Quick-find apporach"></a>2. 1. Quick-find apporach</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickFindUF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id; <span class="comment">// id[i] is component id for object i</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QuickFindUF</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">            id[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id[p] == id[q];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pid = id[p];</span><br><span class="line">        <span class="keyword">int</span> qid = id[q];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; id.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (id[i] == pid) id[i] = qid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Time Complexity:</p>
<ul>
<li>Find: O(1)</li>
<li>Unite: O(N)</li>
</ul>
<p><code>Quick-find algorithm is too slow, it may take ~MN steps to process M union commands on N objects.</code></p>
<h3 id="2-2-Quick-union-approach"><a href="#2-2-Quick-union-approach" class="headerlink" title="2.2. Quick-union approach"></a>2.2. Quick-union approach</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickUnionUF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id; <span class="comment">// id[i] is parent of i</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QuickUnionUF</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">            id[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">root</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (i != id[i]) &#123;</span><br><span class="line">            <span class="comment">//id[i] = id[id[i]];</span></span><br><span class="line">            i = id[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root(p) == root(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = root(p);</span><br><span class="line">        <span class="keyword">int</span> j = root(q);</span><br><span class="line">        id[i] = j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Quick-find defect</p>
<ul>
<li>Union too expensive (N steps)</li>
<li>Trees are flat, but too expensive to keep then flat</li>
</ul>
<p>Quick-union defect</p>
<ul>
<li>Trees can get tall</li>
<li>Find too expensive (could be N steps)</li>
<li>Need to do find to do union</li>
</ul>
<p><code>Quick-union is also too slow</code></p>
<h3 id="2-3-Weighted-quick-union-with-path-compression"><a href="#2-3-Weighted-quick-union-with-path-compression" class="headerlink" title="2.3. Weighted quick-union with path compression"></a>2.3. Weighted quick-union with path compression</h3><p>Improvement 1: Weighting</p>
<ul>
<li>Modify quick-union to avoid tall trees.</li>
<li>Keep track of size of each component.</li>
<li>Balance by linking small tree below larget one.</li>
</ul>
<p>Analysis:</p>
<ul>
<li>Find: takes time proportional to depth of p and q.</li>
<li>Union: takes constant time, given roots.</li>
<li>Fact: depth is at most lg N. [needs proof, remember it here.]</li>
</ul>
<p>Improvement 2: Path compression</p>
<ul>
<li>Just after computing the root of i, set the id of each examined node to root(i).</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id;</span><br><span class="line">    <span class="keyword">int</span> size[];</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UF</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">            id[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">root</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (i != id[i]) &#123;</span><br><span class="line">            id[i] = id[id[i]];</span><br><span class="line">            i = id[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i; h</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root(p) == root(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = root(p);</span><br><span class="line">        <span class="keyword">int</span> j = root(q);</span><br><span class="line">        <span class="keyword">if</span> (size[i] &lt; size[j]) &#123;</span><br><span class="line">            id[i] = j;</span><br><span class="line">            size[j] += size[i];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            id[j] = i;</span><br><span class="line">            size[i] += size[j];</span><br><span class="line">        &#125;</span><br><span class="line">        id[i] = j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Union-Find-Problems"><a href="#3-Union-Find-Problems" class="headerlink" title="3. Union Find Problems"></a>3. Union Find Problems</h2><h3 id="3-1-Number-of-Islands"><a href="#3-1-Number-of-Islands" class="headerlink" title="3.1. Number of Islands"></a>3.1. Number of Islands</h3><p>Given a 2d grid map of ‘1’s (land) and ‘0’s (water), count the number of islands. An island is surrounded by water and is formed by connecting adjacent lands horizontally or vertically. You may assume all four edges of the grid are all surrounded by water.</p>
<p><strong><em>Example 1:</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">11110</span><br><span class="line">11010</span><br><span class="line">11000</span><br><span class="line">00000</span><br></pre></td></tr></table></figure>
<p>Answer: 1</p>
<p><strong><em>Example 2:</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">11000</span><br><span class="line">11000</span><br><span class="line">00100</span><br><span class="line">00011</span><br></pre></td></tr></table></figure>
<p>Answer: 3</p>
<p><strong>Solution 1: Depth First Search</strong><br>This problem can be solved with both depth-frist search and breath-first search, the following code is an example of depth-first search.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numIslands</span><span class="params">(<span class="keyword">char</span>[][] grid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (grid == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> height = grid.length;</span><br><span class="line">        <span class="keyword">if</span> (height == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> len = grid[<span class="number">0</span>].length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (len == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; height; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (grid[i][j] == <span class="string">'1'</span>) &#123;</span><br><span class="line">                    sum++;</span><br><span class="line">                    helper(grid, i, j, height, len);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">helper</span><span class="params">(<span class="keyword">char</span>[][] grid, <span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> height, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        grid[i][j] = <span class="string">'x'</span>;</span><br><span class="line">        <span class="keyword">if</span> (i - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; grid[i - <span class="number">1</span>][j] == <span class="string">'1'</span>) &#123;</span><br><span class="line">            helper(grid, i - <span class="number">1</span>, j, height, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">1</span> &lt; height &amp;&amp; grid[i + <span class="number">1</span>][j] == <span class="string">'1'</span>) &#123;</span><br><span class="line">            helper(grid, i + <span class="number">1</span>, j, height, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (j - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; grid[i][j - <span class="number">1</span>] == <span class="string">'1'</span>) &#123;</span><br><span class="line">            helper(grid, i, j - <span class="number">1</span>, height, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (j + <span class="number">1</span> &lt; len &amp;&amp; grid[i][j + <span class="number">1</span>] == <span class="string">'1'</span>) &#123;</span><br><span class="line">            helper(grid, i, j + <span class="number">1</span>, height, len);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Solution 2: Union Find</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numIslands</span><span class="params">(<span class="keyword">char</span>[][] grid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (grid == <span class="keyword">null</span> || grid.length == <span class="number">0</span> || grid[<span class="number">0</span>].length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> m = grid.length, n = grid[<span class="number">0</span>].length;</span><br><span class="line">        UF uf = <span class="keyword">new</span> UF(m, n, grid);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (grid[i][j] == <span class="string">'0'</span>) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">int</span> p = i * n + j;</span><br><span class="line">                <span class="keyword">int</span> q;</span><br><span class="line">                <span class="comment">// check up</span></span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; grid[i - <span class="number">1</span>][j] == <span class="string">'1'</span>) &#123;</span><br><span class="line">                    q = p - n;</span><br><span class="line">                    uf.union(p, q);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// check down</span></span><br><span class="line">                <span class="keyword">if</span> (i &lt; m - <span class="number">1</span> &amp;&amp; grid[i + <span class="number">1</span>][j] == <span class="string">'1'</span>) &#123;</span><br><span class="line">                    q = p + n;</span><br><span class="line">                    uf.union(p, q);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// check left</span></span><br><span class="line">                <span class="keyword">if</span> (j &gt; <span class="number">0</span> &amp;&amp; grid[i][j - <span class="number">1</span>] == <span class="string">'1'</span>) &#123;</span><br><span class="line">                    q = p - <span class="number">1</span>;</span><br><span class="line">                    uf.union(p, q);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// check right</span></span><br><span class="line">                <span class="keyword">if</span> (j &lt; n - <span class="number">1</span> &amp;&amp; grid[i][j + <span class="number">1</span>] == <span class="string">'1'</span>) &#123;</span><br><span class="line">                    q = p + <span class="number">1</span>;</span><br><span class="line">                    uf.union(p, q);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uf.count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">UF</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] id;</span><br><span class="line">        <span class="keyword">int</span>[] sz;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">UF</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n, <span class="keyword">char</span>[][] grid)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                    <span class="comment">// When creating the UF object, count the number of '1's.</span></span><br><span class="line">                    <span class="keyword">if</span> (grid[i][j] == <span class="string">'1'</span>) count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            id = <span class="keyword">new</span> <span class="keyword">int</span>[m * n];</span><br><span class="line">            sz = <span class="keyword">new</span> <span class="keyword">int</span>[m * n];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m * n; i++) &#123;</span><br><span class="line">                id[i] = i;</span><br><span class="line">                sz[i] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">root</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (id[k] != k) &#123;</span><br><span class="line">                id[k] = id[id[k]];</span><br><span class="line">                k = id[k];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">connected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> root(p) == root(q);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> x = root(p);</span><br><span class="line">            <span class="keyword">int</span> y = root(q);</span><br><span class="line">            <span class="keyword">if</span> (x == y) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span> (sz[x] &lt; sz[y]) &#123;</span><br><span class="line">                id[x] = y;</span><br><span class="line">                sz[y] += sz[x];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                id[y] = x;</span><br><span class="line">                sz[x] += sz[y];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Whenever do a union, reduce count by 1.</span></span><br><span class="line">            count--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h3 id="3-2-Number-of-Islands-II"><a href="#3-2-Number-of-Islands-II" class="headerlink" title="3.2. Number of Islands II"></a>3.2. Number of Islands II</h3><p>A 2d grid map of m rows and n columns is initially filled with water. We may perform an addLand operation which turns the water at position (row, col) into a land. Given a list of positions to operate, count the number of islands after each addLand operation. An island is surrounded by water and is formed by connecting adjacent lands horizontally or vertically. You may assume all four edges of the grid are all surrounded by water.</p>
<p><strong><em>Example:</em></strong><br>Given m = 3, n = 3, positions = [[0,0], [0,1], [1,2], [2,1]].<br>Initially, the 2d grid grid is filled with water. (Assume 0 represents water and 1 represents land).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0 0 0</span><br><span class="line">0 0 0</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure>
<p>Operation #1: addLand(0, 0) turns the water at grid[0][0] into a land.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 0 0</span><br><span class="line">0 0 0   Number of islands &#x3D; 1</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure>
<p>Operation #2: addLand(0, 1) turns the water at grid[0][1] into a land.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 1 0</span><br><span class="line">0 0 0   Number of islands &#x3D; 1</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure>
<p>Operation #3: addLand(1, 2) turns the water at grid[1][2] into a land.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 1 0</span><br><span class="line">0 0 1   Number of islands &#x3D; 2</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure>
<p>Operation #4: addLand(2, 1) turns the water at grid[2][1] into a land.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 1 0</span><br><span class="line">0 0 1   Number of islands &#x3D; 3</span><br><span class="line">0 1 0</span><br></pre></td></tr></table></figure>
<p>We return the result as an array: [1, 1, 2, 3]</p>
<p><strong>Challenge</strong><br>Can you do it in time complexity O(k log mn), where k is the length of the positions?</p>
<p><strong>Solution</strong><br>The most straightforward solution is to put all positions into the map, and use the same approach as the <strong>3.1. Number of Islands</strong>. However, since it requires solving the problem in O(k logmn) time complexity, the union find approach becomes the only option.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">numIslands2</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n, <span class="keyword">int</span>[][] positions)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">if</span> (m &lt;= <span class="number">0</span> || n &lt;= <span class="number">0</span> || positions == <span class="keyword">null</span> || positions.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span>[][] grid = <span class="keyword">new</span> <span class="keyword">int</span>[m][n];</span><br><span class="line">        UF uf = <span class="keyword">new</span> UF(m, n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; positions.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span>[] position = positions[i];</span><br><span class="line">            <span class="keyword">int</span> x = position[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">int</span> y = position[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (grid[x][y] == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            grid[x][y] = <span class="number">1</span>;</span><br><span class="line">            uf.count++;</span><br><span class="line">            <span class="keyword">if</span> (x &gt; <span class="number">0</span> &amp;&amp; grid[x - <span class="number">1</span>][y] == <span class="number">1</span>) &#123;</span><br><span class="line">                uf.union((x - <span class="number">1</span>) * n + y, x * n + y);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (x &lt; m - <span class="number">1</span> &amp;&amp; grid[x + <span class="number">1</span>][y] == <span class="number">1</span>) &#123;</span><br><span class="line">                uf.union((x + <span class="number">1</span>) * n + y, x * n + y);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (y &gt; <span class="number">0</span> &amp;&amp; grid[x][y - <span class="number">1</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">                uf.union(x * n + y - <span class="number">1</span>, x * n + y);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (y &lt; n - <span class="number">1</span> &amp;&amp; grid[x][y + <span class="number">1</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">                uf.union(x * n + y + <span class="number">1</span>, x * n + y);</span><br><span class="line">            &#125;</span><br><span class="line">            res.add(uf.count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UF</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] ids;</span><br><span class="line">        <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">UF</span> <span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">            ids = <span class="keyword">new</span> <span class="keyword">int</span>[m * n];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m * n; i++) &#123;</span><br><span class="line">                ids[i] = i;</span><br><span class="line">            &#125;</span><br><span class="line">            count = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">root</span> <span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (p != ids[p]) &#123;</span><br><span class="line">                ids[p] = ids[ids[p]];</span><br><span class="line">                p = ids[p];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> pParent = root(p);</span><br><span class="line">            <span class="keyword">int</span> qParent = root(q);</span><br><span class="line">            <span class="keyword">if</span> (pParent == qParent) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ids[qParent] = pParent;</span><br><span class="line">            count--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-Surrounded-Regions"><a href="#3-3-Surrounded-Regions" class="headerlink" title="3.3. Surrounded Regions"></a>3.3. Surrounded Regions</h3><p>Given a 2D board containing ‘X’ and ‘O’ (the letter O), capture all regions surrounded by ‘X’.<br>A region is captured by flipping all ‘O’s into ‘X’s in that surrounded region.<br>For example,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">X X X X</span><br><span class="line">X O O X</span><br><span class="line">X X O X</span><br><span class="line">X O X X</span><br></pre></td></tr></table></figure>
<p>After running your function, the board should be:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">X X X X</span><br><span class="line">X X X X</span><br><span class="line">X X X X</span><br><span class="line">X O X X</span><br></pre></td></tr></table></figure>

<p><strong>Solution1: Breath First Search</strong><br>Use BFS to find all ‘O’ positions that are not surrounded by ‘X’, and change them to ‘.’ from ‘O’, then replace all remaing ‘O’ to ‘X’, and ‘.’ to ‘O’</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">char</span>[][] board)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (board == <span class="keyword">null</span> || board.length &lt;= <span class="number">2</span> || board[<span class="number">0</span>].length &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Step1: change all invalid 'O's to '.';</span></span><br><span class="line">        <span class="keyword">int</span> rows = board.length;</span><br><span class="line">        <span class="keyword">int</span> cols = board[<span class="number">0</span>].length;</span><br><span class="line">        Queue&lt;Integer&gt; queue = <span class="keyword">new</span> LinkedList&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (board[i][<span class="number">0</span>] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[i][<span class="number">0</span>] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer(i * cols);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (board[i][cols - <span class="number">1</span>] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[i][cols - <span class="number">1</span>] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer(i * cols + cols - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; cols - <span class="number">1</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (board[<span class="number">0</span>][j] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[<span class="number">0</span>][j] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer(j);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (board[rows - <span class="number">1</span>][j] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[rows - <span class="number">1</span>][j] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer((rows - <span class="number">1</span>) * cols + j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> num = queue.poll();</span><br><span class="line">            <span class="keyword">int</span> row = num / cols;</span><br><span class="line">            <span class="keyword">int</span> col = num % cols;</span><br><span class="line">            <span class="keyword">if</span> (row &lt; rows - <span class="number">1</span> &amp;&amp; board[row + <span class="number">1</span>][col] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[row + <span class="number">1</span>][col] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer((row + <span class="number">1</span>) * cols + col);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (row &gt; <span class="number">0</span> &amp;&amp; board[row - <span class="number">1</span>][col] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[row - <span class="number">1</span>][col] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer((row - <span class="number">1</span>) * cols + col);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (col &lt; cols - <span class="number">1</span> &amp;&amp; board[row][col + <span class="number">1</span>] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[row][col + <span class="number">1</span>] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer(row * cols + col + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (col &gt; <span class="number">0</span> &amp;&amp; board[row][col - <span class="number">1</span>] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[row][col - <span class="number">1</span>] = <span class="string">'.'</span>;</span><br><span class="line">                queue.offer(row * cols + col - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step2: Change all 'O' to 'X', and '.' to 'O';</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; cols; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == <span class="string">'.'</span>) &#123;</span><br><span class="line">                    board[i][j] = <span class="string">'O'</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (board[i][j] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                    board[i][j] = <span class="string">'X'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Solution2: Union Find</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] id;</span><br><span class="line">    <span class="keyword">boolean</span>[] hasEdge;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">char</span>[][] board)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (board == <span class="keyword">null</span> || board.length &lt;= <span class="number">2</span> || board[<span class="number">0</span>].length &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> m = board.length, n = board[<span class="number">0</span>].length;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[m * n];</span><br><span class="line">        hasEdge = <span class="keyword">new</span> <span class="keyword">boolean</span>[m * n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m * n; i++) &#123;</span><br><span class="line">            id[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// check the O in boundary</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m * n; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = i / n, y = i % n;</span><br><span class="line">            hasEdge[i] = (board[x][y] == <span class="string">'O'</span> &amp;&amp; (x == <span class="number">0</span> || x == m - <span class="number">1</span> || y == <span class="number">0</span> || y == n - <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//union all the Os</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m * n; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = i / n, y = i % n, up = x - <span class="number">1</span>, left = y - <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// union itself with up if possible</span></span><br><span class="line">            <span class="keyword">if</span> (up &gt;= <span class="number">0</span> &amp;&amp; board[x][y] == <span class="string">'O'</span> &amp;&amp; board[up][y] == <span class="string">'O'</span>) union( i - n, i);</span><br><span class="line">            <span class="comment">// union itself with left if possible</span></span><br><span class="line">            <span class="keyword">if</span> (left &gt;= <span class="number">0</span> &amp;&amp; board[x][y] == <span class="string">'O'</span> &amp;&amp; board[x][left] == <span class="string">'O'</span>) union(i - <span class="number">1</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; id.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = i / n, y = i % n;</span><br><span class="line">            <span class="keyword">int</span> root_i = root(i);</span><br><span class="line">            <span class="keyword">if</span> (!hasEdge[root_i] &amp;&amp; board[x][y] == <span class="string">'O'</span>) &#123;</span><br><span class="line">                board[x][y] = <span class="string">'X'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = root(i);</span><br><span class="line">        <span class="keyword">int</span> y = root(j);</span><br><span class="line">        id[y] = x;</span><br><span class="line">        hasEdge[x] = hasEdge[x] || hasEdge[y];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">root</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (id[i] != i) &#123;</span><br><span class="line">            id[i] = id[id[i]];</span><br><span class="line">            i = id[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-Graph-Valid-Tree"><a href="#3-4-Graph-Valid-Tree" class="headerlink" title="3.4. Graph Valid Tree"></a>3.4. Graph Valid Tree</h3><p>Given n nodes labeled from 0 to n - 1 and a list of undirected edges (each edge is a pair of nodes), write a function to check whether these edges make up a valid tree.<br>For example:</p>
<p>Given n = 5 and edges = [[0, 1], [0, 2], [0, 3], [1, 4]], return true.<br>Given n = 5 and edges = [[0, 1], [1, 2], [2, 3], [1, 3], [1, 4]], return false.</p>
<p><strong>Solution: Union Find</strong><br>Union the two nodes if they are connected by edge,  the tree is invalid if a new edge comes to connect two nodes that are already connected.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">validTree</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span>[][] edges)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> n == <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span>[] roots = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; roots.length; i++) &#123;</span><br><span class="line">            roots[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] edge : edges) &#123;</span><br><span class="line">            <span class="keyword">int</span> root0 = findRoot(edge[<span class="number">0</span>], roots);</span><br><span class="line">            <span class="keyword">int</span> root1 = findRoot(edge[<span class="number">1</span>], roots);</span><br><span class="line">            <span class="keyword">if</span> (root0 != root1) &#123;</span><br><span class="line">                roots[root0] = roots[root1];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> edges.length == n-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">findRoot</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span>[] roots)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (roots[index] != index) &#123;</span><br><span class="line">            roots[index] = roots[roots[index]];</span><br><span class="line">            index = roots[index];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Question:</strong> can union find be applied to solving graph issue? Like finding circle in graph.</p>
<h3 id="3-5-Number-of-Connected-Components-in-an-Undirected-Graph"><a href="#3-5-Number-of-Connected-Components-in-an-Undirected-Graph" class="headerlink" title="3.5. Number of Connected Components in an Undirected Graph"></a>3.5. Number of Connected Components in an Undirected Graph</h3><p>Given n nodes labeled from 0 to n - 1 and a list of undirected edges (each edge is a pair of nodes), write a function to find the number of connected components in an undirected graph.<br><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0          3</span><br><span class="line">|          |</span><br><span class="line">1 --- 2    4</span><br></pre></td></tr></table></figure>
<p>Given n = 5 and edges = [[0, 1], [1, 2], [3, 4]], return 2.</p>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0           4</span><br><span class="line">|           |</span><br><span class="line">1 --- 2 --- 3</span><br></pre></td></tr></table></figure>
<p>Given n = 5 and edges = [[0, 1], [1, 2], [2, 3], [3, 4]], return 1.</p>
<p><strong>Solution:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countComponents</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span>[][] edges)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] roots = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; roots.length; i++) &#123;</span><br><span class="line">            roots[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] edge : edges) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = findRoot(edge[<span class="number">0</span>], roots);</span><br><span class="line">            <span class="keyword">int</span> y = findRoot(edge[<span class="number">1</span>], roots);</span><br><span class="line">            <span class="keyword">if</span> (x != y) &#123;</span><br><span class="line">                roots[x] = y;</span><br><span class="line">                n--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">findRoot</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span>[] roots)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (i != roots[i]) &#123;</span><br><span class="line">            roots[i] = roots[roots[i]];</span><br><span class="line">            i = roots[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-References"><a href="#4-References" class="headerlink" title="4. References"></a>4. References</h2><ul>
<li><a href="https://www.cs.princeton.edu/~rs/AlgsDS07/01UnionFind.pdf" target="_blank" rel="noopener">Princeton Algorithms: Union Find</a></li>
<li><a href="https://www.youtube.com/watch?v=ID00PMy0-vE" target="_blank" rel="noopener">Tushar Roy’s Video: Disjoint Sets using union by rank and path compression Graph Algorithm</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://dannyzhang.run/2016/07/17/Techmon-Go-3-Segment-Tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Danny Zhang">
      <meta itemprop="description" content="Blogger/Software Engineer/Fitness Enthusiast">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="D.Z. Notes (Beta)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/17/Techmon-Go-3-Segment-Tree/" class="post-title-link" itemprop="url">Data Structure & Algorithms Notes: Segment Tree</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-17 23:21:47" itemprop="dateCreated datePublished" datetime="2016-07-17T23:21:47-07:00">2016-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-07-30 14:23:56" itemprop="dateModified" datetime="2016-07-30T14:23:56-07:00">2016-07-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-Segment-Tree-Definition"><a href="#1-Segment-Tree-Definition" class="headerlink" title="1. Segment Tree Definition"></a>1. Segment Tree Definition</h2><p>In computer science, a segment tree is a tree data structure for storing intervals, or segments. It allows querying which of the stored segments contain a given point.</p>
<p><img src="/content/images/2016/illustrationOfSegmentTree.png" alt="Illustration of Segment tree"></p>
<p>Segment tree could be implemented using either an array or a tree. For an array implementation, if the element at index i is not a leaf, its left and right child are stored at index 2i and 2i+1 respectively. </p>
<h2 id="2-Segment-Tree-Problems"><a href="#2-Segment-Tree-Problems" class="headerlink" title="2. Segment Tree Problems"></a>2. Segment Tree Problems</h2><h3 id="2-1-Range-Sum-Query-Mutable"><a href="#2-1-Range-Sum-Query-Mutable" class="headerlink" title="2.1. Range Sum Query  - Mutable"></a>2.1. Range Sum Query  - Mutable</h3><p>Given an integer array nums, find the sum of the elements between indices i and j (i ≤ j), inclusive.</p>
<p>The update(i, val) function modifies nums by updating the element at index i to val.</p>
<p><strong>Example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Given nums &#x3D; [1, 3, 5]</span><br><span class="line">sumRange(0, 2) -&gt; 9</span><br><span class="line">update(1, 2)</span><br><span class="line">sumRange(0, 2) -&gt; 8</span><br></pre></td></tr></table></figure>

<p>This is a classic segment tree problem, and we can break it down to the three following steps:</p>
<ol>
<li>Build the segment tree;</li>
<li>Update the segment tree when an element is modified;</li>
<li>Calculate the range sum query using the segment tree.</li>
</ol>
<h4 id="2-1-1-Build-segment-tree"><a href="#2-1-1-Build-segment-tree" class="headerlink" title="2.1.1. Build segment tree"></a>2.1.1. Build segment tree</h4><p>Here, we use array implementation as example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] tree;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NumArray</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (nums.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        n = nums.length;</span><br><span class="line">        tree = <span class="keyword">new</span> <span class="keyword">int</span>[n * <span class="number">2</span>];</span><br><span class="line">        buildTree(nums);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n, j = <span class="number">0</span>;  i &lt; <span class="number">2</span> * n; i++,  j++)</span><br><span class="line">        tree[i] = nums[j]; <span class="comment">//Give values for the leaf nodes.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt; <span class="number">0</span>; --i)</span><br><span class="line">        tree[i] = tree[i * <span class="number">2</span>] + tree[i * <span class="number">2</span> + <span class="number">1</span>]; <span class="comment">//Update the parents' value with a bottom-up approach.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Complexity Analysis:</strong><br>The total amount of nodes is:<br>n + n/2 + n/4 + n/8 + … + 1 ~= 2n</p>
<ul>
<li>Time complexity: O(n)</li>
<li>Space complexity: O(n)</li>
</ul>
<h4 id="2-1-2-Update-segment-tree"><a href="#2-1-2-Update-segment-tree" class="headerlink" title="2.1.2. Update segment tree"></a>2.1.2. Update segment tree</h4><p>When updating the array at i, we need to rebuild the segment tree as well. Here, we use a bottom-up approach. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    pos += n;</span><br><span class="line">    tree[pos] = val;</span><br><span class="line">    <span class="keyword">while</span> (pos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> left = pos;</span><br><span class="line">        <span class="keyword">int</span> right = pos;</span><br><span class="line">        <span class="keyword">if</span> (pos % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">// pos tands for left node.</span></span><br><span class="line">            right = pos + <span class="number">1</span>; </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// pos stands for right node.</span></span><br><span class="line">            left = pos - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// parent is updated after child is updated</span></span><br><span class="line">        tree[pos / <span class="number">2</span>] = tree[left] + tree[right];</span><br><span class="line">        pos /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Complexity Analysis</strong></p>
<ul>
<li>Time Complexity: O(log n);</li>
<li>Space complexity: O(1);</li>
</ul>
<h4 id="2-1-3-Range-Sum-Query"><a href="#2-1-3-Range-Sum-Query" class="headerlink" title="2.1.3. Range Sum Query"></a>2.1.3. Range Sum Query</h4><ul>
<li>Loop till l &lt;= r<ul>
<li>Check if l is right child of its parent P<ul>
<li>l is right child of P. Then P contains sum of range of l and another child which is outside the range and we dont’t need parent P sum. Add l to sum without its parent and set l to the next node on the same level.</li>
<li>l is not right child of P. Then parent P contains sum of range which lies in [l, r]. Add P to sum and set l to point to the parent of P</li>
</ul>
</li>
<li>Check if r is left child of its parent P<ul>
<li>r is left child of P: Then P contains sum of range of r and another child which is out side the range and we don’t need parent P sum. Add r to sum without its parent and set r to the previous node on the same level</li>
<li>r is not left child of P. Then parent P contains sum of range which lies in [l, r]. Add P to sum and set r to point to the parent of P.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Drawing a graph by yourself will help a lot!</strong></p>
<p>Here’s the code.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sumRange</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// get leaf with value 'l'</span></span><br><span class="line">    l += n;</span><br><span class="line">    <span class="comment">// get leaf with value 'r'</span></span><br><span class="line">    r += n;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((l % <span class="number">2</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">           sum += tree[l];</span><br><span class="line">           l++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((r % <span class="number">2</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">           sum += tree[r];</span><br><span class="line">           r--;</span><br><span class="line">        &#125;</span><br><span class="line">        l /= <span class="number">2</span>;</span><br><span class="line">        r /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Complexity Analysis</strong></p>
<ul>
<li>Time complexity: O(log n)</li>
<li>Space complexity: O(1)</li>
</ul>
<h3 id="2-2-Range-Sum-Query-2D"><a href="#2-2-Range-Sum-Query-2D" class="headerlink" title="2.2. Range Sum Query 2D"></a>2.2. Range Sum Query 2D</h3><p><code>TODO</code></p>
<h3 id="2-3-The-Skyline-Problem"><a href="#2-3-The-Skyline-Problem" class="headerlink" title="2.3. The Skyline Problem"></a>2.3. The Skyline Problem</h3><p>Suppose you are given the locations and height of all the buildings as shown on a cityscape photo (Figure A), write a program to output the skyline formed by these buildings collectively (Figure B).<br><img src="/content/images/2016/skylineProblem.png" alt="Illustration of the Skyline Problem "></p>
<p>For instance, the dimensions of all buildings in Figure A are recorded as:<br> <code>[[2 9 10], [3 7 15], [5 12 12], [15 20 10], [19 24 8]]</code></p>
<p>The skyline in Figure B should be represented as:<br><code>[[2 10], [3 15], [7 12], [12 0], [15 10], [20 8], [24, 0]]</code>.</p>
<h4 id="2-3-1-Solution-without-segment-tree"><a href="#2-3-1-Solution-without-segment-tree" class="headerlink" title="2.3.1. Solution without segment tree"></a>2.3.1. Solution without segment tree</h4><p>The idea is very straightforward and can be divided into the following 4 steps:</p>
<ol>
<li>Create a list of all the nodes that sorted by the position in x axis;</li>
<li>Create a height array with the size of all nodes, and map the position in x axis to the array index;</li>
<li>Iterate all the buildings and update the height values in array.</li>
<li>Iterate the array and generate the final result.</li>
</ol>
<p>Here’s the complet code.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="keyword">int</span>[]&gt; getSkyline(<span class="keyword">int</span>[][] buildings) &#123;</span><br><span class="line">        List&lt;<span class="keyword">int</span>[]&gt; res = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">int</span>[]&gt;();</span><br><span class="line">        <span class="keyword">if</span> (buildings == <span class="keyword">null</span> || buildings.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step1: create a list of all nodes;</span></span><br><span class="line">        Set&lt;Integer&gt; nodesSet = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] building : buildings) &#123;</span><br><span class="line">            nodesSet.add(building[<span class="number">0</span>]);</span><br><span class="line">            nodesSet.add(building[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; nodes = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(nodesSet);</span><br><span class="line">        Collections.sort(nodes);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step2: put all nodes into an array, and build hashmap to map the x axis position to the index in array.</span></span><br><span class="line">        <span class="keyword">int</span> nodesLen = nodes.size();</span><br><span class="line">        <span class="keyword">int</span>[] nodesHeight = <span class="keyword">new</span> <span class="keyword">int</span> [nodesLen];</span><br><span class="line">        Map&lt;Integer, Integer&gt; nodesMap = <span class="keyword">new</span> HashMap&lt;Integer, Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodesLen; i++) &#123;</span><br><span class="line">            nodesMap.put(nodes.get(i), i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step3: update the array</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] building : buildings) &#123;</span><br><span class="line">            <span class="keyword">int</span> startIndex = nodesMap.get(building[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">int</span> endIndex = nodesMap.get(building[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">int</span> height = building[<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = startIndex; j &lt; endIndex; j++) &#123;</span><br><span class="line">                nodesHeight[j] = Math.max(nodesHeight[j], height);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Step4: generate the result.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodesLen ; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nodesHeight[i] == nodesHeight[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span>[] r = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">            r[<span class="number">0</span>] = nodes.get(i);</span><br><span class="line">            r[<span class="number">1</span>] = nodesHeight[i];</span><br><span class="line">            res.add(r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-3-2-Solution-with-segment-tree"><a href="#2-3-2-Solution-with-segment-tree" class="headerlink" title="2.3.2 Solution with segment tree"></a>2.3.2 Solution with segment tree</h4><p>Do we have better solution? Yes! Now we are going to use the segment tree approach to solve it.</p>
<p>In this case, since more than one value needs to be saved for each node: height, start and end, so it’s better to use the tree node implementation instead of the array implementation.</p>
<p>Comparing wiht the solution without segment tree, when we update the nodes’ height values, if we reach a tree node with an equal or higher height values, we can just ignore this building and continue to the next one. This makes the solution more efficient.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> start; <span class="comment">//Inclusive</span></span><br><span class="line">        <span class="keyword">int</span> end; <span class="comment">//Exclusive</span></span><br><span class="line">        <span class="keyword">int</span> height;</span><br><span class="line">        TreeNode left;</span><br><span class="line">        TreeNode right;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TreeNode</span> <span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.start = start;</span><br><span class="line">            <span class="keyword">this</span>.end = end;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="keyword">int</span>[]&gt; getSkyline(<span class="keyword">int</span>[][] buildings) &#123;</span><br><span class="line">        List&lt;<span class="keyword">int</span>[]&gt; res = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">int</span>[]&gt;();</span><br><span class="line">        <span class="keyword">if</span> (buildings == <span class="keyword">null</span> || buildings.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step1: create a list of all nodes;</span></span><br><span class="line">        Set&lt;Integer&gt; nodesSet = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] building : buildings) &#123;</span><br><span class="line">            nodesSet.add(building[<span class="number">0</span>]);</span><br><span class="line">            nodesSet.add(building[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; nodes = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(nodesSet);</span><br><span class="line">        Collections.sort(nodes);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step2: put all nodes into an array, and build hashmap to map the(x position, index in array</span></span><br><span class="line">        <span class="keyword">int</span> nodesLen = nodes.size();</span><br><span class="line">        Map&lt;Integer, Integer&gt; nodesMap = <span class="keyword">new</span> HashMap&lt;Integer, Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodesLen; i++) &#123;</span><br><span class="line">            nodesMap.put(nodes.get(i), i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step3: build the segment tree</span></span><br><span class="line">        TreeNode root = buildTree(<span class="number">0</span>, nodesLen - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step4: update the height value</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] building : buildings) &#123;</span><br><span class="line">            <span class="keyword">int</span> startIndex = nodesMap.get(building[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">int</span> endIndex = nodesMap.get(building[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">int</span> height = building[<span class="number">2</span>];</span><br><span class="line">            updateHeight(startIndex, endIndex, height, root);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Step5: generate the result.</span></span><br><span class="line">        generateResult(res, root, nodes);</span><br><span class="line">        <span class="keyword">if</span> (nodes.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span>[] last = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">            last[<span class="number">0</span>] = nodes.get(nodes.size() - <span class="number">1</span>);</span><br><span class="line">            last[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            res.add(last);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TreeNode <span class="title">buildTree</span> <span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (start &gt;= end) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        TreeNode node = <span class="keyword">new</span> TreeNode (start, end);</span><br><span class="line">        <span class="keyword">if</span> (start + <span class="number">1</span> &lt; end) &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = start + (end - start) / <span class="number">2</span>;</span><br><span class="line">            node.left = buildTree(start, mid);</span><br><span class="line">            node.right = buildTree(mid, end);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateHeight</span> <span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end, <span class="keyword">int</span> height, TreeNode node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span> || start &gt;= node.end || end &lt;= node.start || height &lt;= node.height) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (node.left == <span class="keyword">null</span> &amp;&amp; node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">            node.height = height;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//We don't need to change the start and end value, just the same.</span></span><br><span class="line">            updateHeight (start, end, height, node.left);</span><br><span class="line">            updateHeight (start, end, height, node.right);</span><br><span class="line">            <span class="keyword">int</span> leftHeight = (node.left == <span class="keyword">null</span>) ? <span class="number">0</span> : node.left.height;</span><br><span class="line">            <span class="keyword">int</span> rightHeight = (node.right == <span class="keyword">null</span>) ? <span class="number">0</span> : node.right.height;</span><br><span class="line">            node.height = Math.min(leftHeight, rightHeight);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">generateResult</span> <span class="params">(List&lt;<span class="keyword">int</span>[]&gt; res, TreeNode root, List&lt;Integer&gt; nodes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//We only need the value from the leaf nodes</span></span><br><span class="line">        <span class="keyword">if</span> (root.left == <span class="keyword">null</span> &amp;&amp; root.right == <span class="keyword">null</span> &amp;&amp; (res.size() == <span class="number">0</span> || res.get(res.size() - <span class="number">1</span>)[<span class="number">1</span>] !=  root.height)) &#123;</span><br><span class="line">            <span class="keyword">int</span>[] r = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">            r[<span class="number">0</span>] = nodes.get(root.start);</span><br><span class="line">            r[<span class="number">1</span>] = root.height;</span><br><span class="line">            res.add(r);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            generateResult(res, root.left, nodes);</span><br><span class="line">            generateResult(res, root.right, nodes);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Count-of-Smaller-Numbers-After-Self"><a href="#2-4-Count-of-Smaller-Numbers-After-Self" class="headerlink" title="2.4. Count of Smaller Numbers After Self"></a>2.4. Count of Smaller Numbers After Self</h3><p><code>TODO</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Danny Zhang</p>
  <div class="site-description" itemprop="description">Blogger/Software Engineer/Fitness Enthusiast</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags">
          
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Danny Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.2
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
